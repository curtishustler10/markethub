exports.id=641,exports.ids=[641],exports.modules={95504:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},93014:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},49471:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.GeminiAiAdapter=void 0,function(e){var t,r;(t=e.HarmCategory||(e.HarmCategory={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",(r=e.HarmBlockThreshold||(e.HarmBlockThreshold={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE",r.OFF="OFF"}(r||(t.GeminiAiAdapter=r={}))},23467:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},31939:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(95504),t),s(r(49471),t),s(r(56109),t),s(r(93014),t),s(r(23467),t)},56109:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},84376:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.envKeys=t.processEnv=t.allProcessEnv=void 0,t.allProcessEnv=()=>{try{if(process.env)return process.env}catch(e){}try{let e=Deno.env.toObject();if(e)return e}catch(e){}try{let e=Netlify.env.toObject();if(e)return e}catch(e){}return{}},t.processEnv=e=>(0,t.allProcessEnv)()[e],function(e){e.OpenAiApiKey="OPENAI_API_KEY",e.GeminiApiKey="GEMINI_API_KEY",e.AnthropicApiKey="ANTHROPIC_API_KEY",e.DeepSeekApiKey="DEEPSEEK_API_KEY",e.GrokApiKey="XAI_API_KEY",e.AzureOpenAiApiKey="AZURE_OPENAI_API_KEY"}(r||(t.envKeys=r={}))},98395:function(e,t,r){"use strict";var n,s=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)},o=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),a=0;a<r.length;a++)"default"!==r[a]&&s(t,e,r[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.models=void 0,a(r(31939),t),a(r(29479),t),t.models=o(r(29479))},38246:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.anthropic=void 0;let n=r(84376);t.anthropic=e=>{var t,r;let s=e.apiKey||(0,n.processEnv)(n.envKeys.AnthropicApiKey)||"",i=e.baseUrl||"https://api.anthropic.com/v1/";i.endsWith("/")||(i+="/");let a=new URL("messages",i),o={"anthropic-version":"2023-06-01"};return((null===(t=e.betaHeaders)||void 0===t?void 0:t.length)||0)>0&&(o["anthropic-beta"]=(null===(r=e.betaHeaders)||void 0===r?void 0:r.join(","))||""),{url:a.href,authKey:s,format:"anthropic",onCall(t,r){Object.assign(r,e.defaultParameters),r.model||(r.model=e.model)},headers:o,options:e}}},77867:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.azureOpenai=void 0;let n=r(84376),s=r(47016);t.azureOpenai=e=>{if(!e.endpoint)throw Error("Azure OpenAI endpoint is required");let t=e.apiKey||(0,n.processEnv)(n.envKeys.AzureOpenAiApiKey)||"",r=(0,s.openai)({model:e.model,apiKey:t,baseUrl:e.endpoint,defaultParameters:e.defaultParameters}),i=new URL(`openai/deployments/${e.deployment}/chat/completions`,e.endpoint);return i.searchParams.set("api-version",e.apiVersion),Object.assign(Object.assign({},r),{url:i.href,format:"azure-openai",onCall(t,r){Object.assign(r,e.defaultParameters),r.model||(r.model=e.model)},headers:{"api-key":r.authKey,"Content-Type":"application/json"},options:e})}},3801:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deepseek=void 0;let n=r(84376);t.deepseek=e=>{let t=e.apiKey||(0,n.processEnv)(n.envKeys.DeepSeekApiKey)||"",r=e.baseUrl||"https://api.deepseek.com/v1/";return r.endsWith("/")||(r+="/"),{url:new URL("chat/completions",r).href,authKey:t,format:"openai-chat",onCall(t,r){Object.assign(r,e.defaultParameters),r.model||(r.model=e.model)},options:e}}},91455:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gemini=void 0;let n=r(84376);t.gemini=e=>{let t=e.apiKey||(0,n.processEnv)(n.envKeys.GeminiApiKey)||"",r=e.baseUrl||"https://generativelanguage.googleapis.com/v1beta/";return r.endsWith("/")||(r+="/"),{url:new URL(`models/${e.model}:generateContent?key=${t}`,r).href,authKey:t,format:"gemini",onCall(t,r){Object.assign(r,e.defaultParameters)},headers:{},options:e}}},45575:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.grok=void 0;let n=r(84376),s=r(47016);t.grok=e=>{let t=e.apiKey||(0,n.processEnv)(n.envKeys.GrokApiKey),r=e.baseUrl||"https://api.x.ai/v1",i=e.model,a=(0,s.openai)(Object.assign(Object.assign({},e),{apiKey:t,baseUrl:r,model:i}));return a.format="grok",a}},29479:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(38246),t),s(r(91455),t),s(r(47016),t),s(r(77867),t),s(r(3801),t),s(r(45575),t)},47016:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openai=void 0;let n=r(84376);t.openai=e=>{let t=e.apiKey||(0,n.processEnv)(n.envKeys.OpenAiApiKey)||"",r=e.baseUrl||"https://api.openai.com/v1/";return r.endsWith("/")||(r+="/"),{url:new URL("chat/completions",r).href,authKey:t,format:"openai-chat",onCall(t,r){Object.assign(r,e.defaultParameters),r.model||(r.model=e.model)},options:e}}},80978:e=>{"use strict";e.exports=({onlyFirst:e=!1}={})=>RegExp("[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)|(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))",e?void 0:"g")},33143:(e,t,r)=>{"use strict";let n;e=r.nmd(e);let s=(e,t)=>(...r)=>{let n=e(...r);return`\u001B[${n+t}m`},i=(e,t)=>(...r)=>{let n=e(...r);return`\u001B[${38+t};5;${n}m`},a=(e,t)=>(...r)=>{let n=e(...r);return`\u001B[${38+t};2;${n[0]};${n[1]};${n[2]}m`},o=e=>e,l=(e,t,r)=>[e,t,r],u=(e,t,r)=>{Object.defineProperty(e,t,{get:()=>{let n=r();return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0}),n},enumerable:!0,configurable:!0})},d=(e,t,s,i)=>{void 0===n&&(n=r(9354));let a=i?10:0,o={};for(let[r,i]of Object.entries(n)){let n="ansi16"===r?"ansi":r;r===t?o[n]=e(s,a):"object"==typeof i&&(o[n]=e(i[t],a))}return o};Object.defineProperty(e,"exports",{enumerable:!0,get:function(){let e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};for(let[r,n]of(t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright,Object.entries(t))){for(let[r,s]of Object.entries(n))t[r]={open:`\u001B[${s[0]}m`,close:`\u001B[${s[1]}m`},n[r]=t[r],e.set(s[0],s[1]);Object.defineProperty(t,r,{value:n,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",u(t.color,"ansi",()=>d(s,"ansi16",o,!1)),u(t.color,"ansi256",()=>d(i,"ansi256",o,!1)),u(t.color,"ansi16m",()=>d(a,"rgb",l,!1)),u(t.bgColor,"ansi",()=>d(s,"ansi16",o,!0)),u(t.bgColor,"ansi256",()=>d(i,"ansi256",o,!0)),u(t.bgColor,"ansi16m",()=>d(a,"rgb",l,!0)),t}})},8075:e=>{"use strict";e.exports=function e(t){return null===t||"object"!=typeof t||null!=t.toJSON?JSON.stringify(t):Array.isArray(t)?"["+t.reduce((t,r,n)=>t+(0===n?"":",")+e(void 0===r||"symbol"==typeof r?null:r),"")+"]":"{"+Object.keys(t).sort().reduce((r,n,s)=>{if(void 0===t[n]||"symbol"==typeof t[n])return r;let i=0===r.length?"":",";return r+i+e(n)+":"+e(t[n])},"")+"}"}},37192:(e,t,r)=>{let n=r(86203),s={};for(let e of Object.keys(n))s[n[e]]=e;let i={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(let t of(e.exports=i,Object.keys(i))){if(!("channels"in i[t]))throw Error("missing channels property: "+t);if(!("labels"in i[t]))throw Error("missing channel labels property: "+t);if(i[t].labels.length!==i[t].channels)throw Error("channel and label counts mismatch: "+t);let{channels:e,labels:r}=i[t];delete i[t].channels,delete i[t].labels,Object.defineProperty(i[t],"channels",{value:e}),Object.defineProperty(i[t],"labels",{value:r})}i.rgb.hsl=function(e){let t;let r=e[0]/255,n=e[1]/255,s=e[2]/255,i=Math.min(r,n,s),a=Math.max(r,n,s),o=a-i;a===i?t=0:r===a?t=(n-s)/o:n===a?t=2+(s-r)/o:s===a&&(t=4+(r-n)/o),(t=Math.min(60*t,360))<0&&(t+=360);let l=(i+a)/2;return[t,100*(a===i?0:l<=.5?o/(a+i):o/(2-a-i)),100*l]},i.rgb.hsv=function(e){let t,r,n,s,i;let a=e[0]/255,o=e[1]/255,l=e[2]/255,u=Math.max(a,o,l),d=u-Math.min(a,o,l),c=function(e){return(u-e)/6/d+.5};return 0===d?(s=0,i=0):(i=d/u,t=c(a),r=c(o),n=c(l),a===u?s=n-r:o===u?s=1/3+t-n:l===u&&(s=2/3+r-t),s<0?s+=1:s>1&&(s-=1)),[360*s,100*i,100*u]},i.rgb.hwb=function(e){let t=e[0],r=e[1],n=e[2];return[i.rgb.hsl(e)[0],1/255*Math.min(t,Math.min(r,n))*100,100*(n=1-1/255*Math.max(t,Math.max(r,n)))]},i.rgb.cmyk=function(e){let t=e[0]/255,r=e[1]/255,n=e[2]/255,s=Math.min(1-t,1-r,1-n);return[100*((1-t-s)/(1-s)||0),100*((1-r-s)/(1-s)||0),100*((1-n-s)/(1-s)||0),100*s]},i.rgb.keyword=function(e){let t;let r=s[e];if(r)return r;let i=1/0;for(let r of Object.keys(n)){let s=n[r],a=(e[0]-s[0])**2+(e[1]-s[1])**2+(e[2]-s[2])**2;a<i&&(i=a,t=r)}return t},i.keyword.rgb=function(e){return n[e]},i.rgb.xyz=function(e){let t=e[0]/255,r=e[1]/255,n=e[2]/255;return[100*(.4124*(t=t>.04045?((t+.055)/1.055)**2.4:t/12.92)+.3576*(r=r>.04045?((r+.055)/1.055)**2.4:r/12.92)+.1805*(n=n>.04045?((n+.055)/1.055)**2.4:n/12.92)),100*(.2126*t+.7152*r+.0722*n),100*(.0193*t+.1192*r+.9505*n)]},i.rgb.lab=function(e){let t=i.rgb.xyz(e),r=t[0],n=t[1],s=t[2];return r/=95.047,n/=100,s/=108.883,[116*(n=n>.008856?n**(1/3):7.787*n+16/116)-16,500*((r=r>.008856?r**(1/3):7.787*r+16/116)-n),200*(n-(s=s>.008856?s**(1/3):7.787*s+16/116))]},i.hsl.rgb=function(e){let t,r,n;let s=e[0]/360,i=e[1]/100,a=e[2]/100;if(0===i)return[n=255*a,n,n];t=a<.5?a*(1+i):a+i-a*i;let o=2*a-t,l=[0,0,0];for(let e=0;e<3;e++)(r=s+-(1/3*(e-1)))<0&&r++,r>1&&r--,n=6*r<1?o+(t-o)*6*r:2*r<1?t:3*r<2?o+(t-o)*(2/3-r)*6:o,l[e]=255*n;return l},i.hsl.hsv=function(e){let t=e[0],r=e[1]/100,n=e[2]/100,s=r,i=Math.max(n,.01);n*=2,r*=n<=1?n:2-n,s*=i<=1?i:2-i;let a=(n+r)/2;return[t,100*(0===n?2*s/(i+s):2*r/(n+r)),100*a]},i.hsv.rgb=function(e){let t=e[0]/60,r=e[1]/100,n=e[2]/100,s=t-Math.floor(t),i=255*n*(1-r),a=255*n*(1-r*s),o=255*n*(1-r*(1-s));switch(n*=255,Math.floor(t)%6){case 0:return[n,o,i];case 1:return[a,n,i];case 2:return[i,n,o];case 3:return[i,a,n];case 4:return[o,i,n];case 5:return[n,i,a]}},i.hsv.hsl=function(e){let t,r;let n=e[0],s=e[1]/100,i=e[2]/100,a=Math.max(i,.01);r=(2-s)*i;let o=(2-s)*a;return[n,100*(s*a/(o<=1?o:2-o)||0),100*(r/=2)]},i.hwb.rgb=function(e){let t,r,n,s;let i=e[0]/360,a=e[1]/100,o=e[2]/100,l=a+o;l>1&&(a/=l,o/=l);let u=Math.floor(6*i),d=1-o;t=6*i-u,(1&u)!=0&&(t=1-t);let c=a+t*(d-a);switch(u){default:case 6:case 0:r=d,n=c,s=a;break;case 1:r=c,n=d,s=a;break;case 2:r=a,n=d,s=c;break;case 3:r=a,n=c,s=d;break;case 4:r=c,n=a,s=d;break;case 5:r=d,n=a,s=c}return[255*r,255*n,255*s]},i.cmyk.rgb=function(e){let t=e[0]/100,r=e[1]/100,n=e[2]/100,s=e[3]/100;return[255*(1-Math.min(1,t*(1-s)+s)),255*(1-Math.min(1,r*(1-s)+s)),255*(1-Math.min(1,n*(1-s)+s))]},i.xyz.rgb=function(e){let t,r,n;let s=e[0]/100,i=e[1]/100,a=e[2]/100;return t=(t=3.2406*s+-1.5372*i+-.4986*a)>.0031308?1.055*t**(1/2.4)-.055:12.92*t,r=(r=-.9689*s+1.8758*i+.0415*a)>.0031308?1.055*r**(1/2.4)-.055:12.92*r,n=(n=.0557*s+-.204*i+1.057*a)>.0031308?1.055*n**(1/2.4)-.055:12.92*n,[255*(t=Math.min(Math.max(0,t),1)),255*(r=Math.min(Math.max(0,r),1)),255*(n=Math.min(Math.max(0,n),1))]},i.xyz.lab=function(e){let t=e[0],r=e[1],n=e[2];return t/=95.047,r/=100,n/=108.883,[116*(r=r>.008856?r**(1/3):7.787*r+16/116)-16,500*((t=t>.008856?t**(1/3):7.787*t+16/116)-r),200*(r-(n=n>.008856?n**(1/3):7.787*n+16/116))]},i.lab.xyz=function(e){let t,r,n;let s=e[0],i=e[1],a=e[2];t=i/500+(r=(s+16)/116),n=r-a/200;let o=r**3,l=t**3,u=n**3;return r=(o>.008856?o:(r-16/116)/7.787)*100,[t=(l>.008856?l:(t-16/116)/7.787)*95.047,r,n=(u>.008856?u:(n-16/116)/7.787)*108.883]},i.lab.lch=function(e){let t;let r=e[0],n=e[1],s=e[2];return(t=360*Math.atan2(s,n)/2/Math.PI)<0&&(t+=360),[r,Math.sqrt(n*n+s*s),t]},i.lch.lab=function(e){let t=e[0],r=e[1],n=e[2]/360*2*Math.PI;return[t,r*Math.cos(n),r*Math.sin(n)]},i.rgb.ansi16=function(e,t=null){let[r,n,s]=e,a=null===t?i.rgb.hsv(e)[2]:t;if(0===(a=Math.round(a/50)))return 30;let o=30+(Math.round(s/255)<<2|Math.round(n/255)<<1|Math.round(r/255));return 2===a&&(o+=60),o},i.hsv.ansi16=function(e){return i.rgb.ansi16(i.hsv.rgb(e),e[2])},i.rgb.ansi256=function(e){let t=e[0],r=e[1],n=e[2];return t===r&&r===n?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(r/255*5)+Math.round(n/255*5)},i.ansi16.rgb=function(e){let t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),[t=t/10.5*255,t,t];let r=(~~(e>50)+1)*.5;return[(1&t)*r*255,(t>>1&1)*r*255,(t>>2&1)*r*255]},i.ansi256.rgb=function(e){let t;if(e>=232){let t=(e-232)*10+8;return[t,t,t]}return[Math.floor((e-=16)/36)/5*255,Math.floor((t=e%36)/6)/5*255,t%6/5*255]},i.rgb.hex=function(e){let t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},i.hex.rgb=function(e){let t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];let r=t[0];3===t[0].length&&(r=r.split("").map(e=>e+e).join(""));let n=parseInt(r,16);return[n>>16&255,n>>8&255,255&n]},i.rgb.hcg=function(e){let t;let r=e[0]/255,n=e[1]/255,s=e[2]/255,i=Math.max(Math.max(r,n),s),a=Math.min(Math.min(r,n),s),o=i-a;return t=o<1?a/(1-o):0,[(o<=0?0:i===r?(n-s)/o%6:i===n?2+(s-r)/o:4+(r-n)/o)/6%1*360,100*o,100*t]},i.hsl.hcg=function(e){let t=e[1]/100,r=e[2]/100,n=r<.5?2*t*r:2*t*(1-r),s=0;return n<1&&(s=(r-.5*n)/(1-n)),[e[0],100*n,100*s]},i.hsv.hcg=function(e){let t=e[1]/100,r=e[2]/100,n=t*r,s=0;return n<1&&(s=(r-n)/(1-n)),[e[0],100*n,100*s]},i.hcg.rgb=function(e){let t=e[0]/360,r=e[1]/100,n=e[2]/100;if(0===r)return[255*n,255*n,255*n];let s=[0,0,0],i=t%1*6,a=i%1,o=1-a,l=0;switch(Math.floor(i)){case 0:s[0]=1,s[1]=a,s[2]=0;break;case 1:s[0]=o,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=a;break;case 3:s[0]=0,s[1]=o,s[2]=1;break;case 4:s[0]=a,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=o}return l=(1-r)*n,[(r*s[0]+l)*255,(r*s[1]+l)*255,(r*s[2]+l)*255]},i.hcg.hsv=function(e){let t=e[1]/100,r=t+e[2]/100*(1-t),n=0;return r>0&&(n=t/r),[e[0],100*n,100*r]},i.hcg.hsl=function(e){let t=e[1]/100,r=e[2]/100*(1-t)+.5*t,n=0;return r>0&&r<.5?n=t/(2*r):r>=.5&&r<1&&(n=t/(2*(1-r))),[e[0],100*n,100*r]},i.hcg.hwb=function(e){let t=e[1]/100,r=t+e[2]/100*(1-t);return[e[0],(r-t)*100,(1-r)*100]},i.hwb.hcg=function(e){let t=e[1]/100,r=1-e[2]/100,n=r-t,s=0;return n<1&&(s=(r-n)/(1-n)),[e[0],100*n,100*s]},i.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},i.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},i.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},i.gray.hsl=function(e){return[0,0,e[0]]},i.gray.hsv=i.gray.hsl,i.gray.hwb=function(e){return[0,100,e[0]]},i.gray.cmyk=function(e){return[0,0,0,e[0]]},i.gray.lab=function(e){return[e[0],0,0]},i.gray.hex=function(e){let t=255&Math.round(e[0]/100*255),r=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(r.length)+r},i.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},9354:(e,t,r)=>{let n=r(37192),s=r(13060),i={};Object.keys(n).forEach(e=>{i[e]={},Object.defineProperty(i[e],"channels",{value:n[e].channels}),Object.defineProperty(i[e],"labels",{value:n[e].labels});let t=s(e);Object.keys(t).forEach(r=>{let n=t[r];i[e][r]=function(e){let t=function(...t){let r=t[0];if(null==r)return r;r.length>1&&(t=r);let n=e(t);if("object"==typeof n)for(let e=n.length,t=0;t<e;t++)n[t]=Math.round(n[t]);return n};return"conversion"in e&&(t.conversion=e.conversion),t}(n),i[e][r].raw=function(e){let t=function(...t){let r=t[0];return null==r?r:(r.length>1&&(t=r),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}(n)})}),e.exports=i},13060:(e,t,r)=>{let n=r(37192);e.exports=function(e){let t=function(e){let t=function(){let e={},t=Object.keys(n);for(let r=t.length,n=0;n<r;n++)e[t[n]]={distance:-1,parent:null};return e}(),r=[e];for(t[e].distance=0;r.length;){let e=r.pop(),s=Object.keys(n[e]);for(let n=s.length,i=0;i<n;i++){let n=s[i],a=t[n];-1===a.distance&&(a.distance=t[e].distance+1,a.parent=e,r.unshift(n))}}return t}(e),r={},s=Object.keys(t);for(let e=s.length,i=0;i<e;i++){let e=s[i];null!==t[e].parent&&(r[e]=function(e,t){let r=[t[e].parent,e],s=n[t[e].parent][e],i=t[e].parent;for(;t[i].parent;)r.unshift(t[i].parent),s=function(e,t){return function(r){return t(e(r))}}(n[t[i].parent][i],s),i=t[i].parent;return s.conversion=r,s}(e,t))}return r}},86203:e=>{"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},62845:(e,t,r)=>{let n=r(84025),s=n.default||n,i=function(e,t){return/^\/\//.test(e)&&(e="https:"+e),s.call(this,e,t)};i.ponyfill=!0,e.exports=t=i,t.fetch=i,t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response,t.default=i},36225:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(s=n))}),t.splice(s,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){let e;return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(39546)(t);let{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},39546:(e,t,r)=>{e.exports=function(e){function t(e){let r,s,i;let a=null;function o(...e){if(!o.enabled)return;let n=Number(new Date),s=n-(r||n);o.diff=s,o.prev=r,o.curr=n,r=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,n)=>{if("%%"===r)return"%";i++;let s=t.formatters[n];if("function"==typeof s){let t=e[i];r=s.call(o,t),e.splice(i,1),i--}return r}),t.formatArgs.call(o,e),(o.log||t.log).apply(o,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=n,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(s!==t.namespaces&&(s=t.namespaces,i=t.enabled(e)),i),set:e=>{a=e}}),"function"==typeof t.init&&t.init(o),o}function n(e,r){let n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function s(e,t){let r=0,n=0,s=-1,i=0;for(;r<e.length;)if(n<t.length&&(t[n]===e[r]||"*"===t[n]))"*"===t[n]?(s=n,i=r):r++,n++;else{if(-1===s)return!1;n=s+1,r=++i}for(;n<t.length&&"*"===t[n];)n++;return n===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){let e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){for(let r of(t.save(e),t.namespaces=e,t.names=[],t.skips=[],("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean)))"-"===r[0]?t.skips.push(r.slice(1)):t.names.push(r)},t.enabled=function(e){for(let r of t.skips)if(s(e,r))return!1;for(let r of t.names)if(s(e,r))return!0;return!1},t.humanize=r(48939),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(r=>{t[r]=e[r]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},57034:(e,t,r)=>{"undefined"==typeof process||"renderer"===process.type||process.__nwjs?e.exports=r(36225):e.exports=r(70412)},70412:(e,t,r)=>{let n=r(76224),s=r(73837);t.init=function(e){e.inspectOpts={};let r=Object.keys(t.inspectOpts);for(let n=0;n<r.length;n++)e.inspectOpts[r[n]]=t.inspectOpts[r[n]]},t.log=function(...e){return process.stderr.write(s.formatWithOptions(t.inspectOpts,...e)+"\n")},t.formatArgs=function(r){let{namespace:n,useColors:s}=this;if(s){let t=this.color,s="\x1b[3"+(t<8?t:"8;5;"+t),i=`  ${s};1m${n} \u001B[0m`;r[0]=i+r[0].split("\n").join("\n"+i),r.push(s+"m+"+e.exports.humanize(this.diff)+"\x1b[0m")}else r[0]=(t.inspectOpts.hideDate?"":new Date().toISOString()+" ")+n+" "+r[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?!!t.inspectOpts.colors:n.isatty(process.stderr.fd)},t.destroy=s.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{let e=r(84764);e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{let r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(e,t)=>t.toUpperCase()),n=process.env[t];return n=!!/^(yes|on|true|enabled)$/i.test(n)||!/^(no|off|false|disabled)$/i.test(n)&&("null"===n?null:Number(n)),e[r]=n,e},{}),e.exports=r(39546)(t);let{formatters:i}=e.exports;i.o=function(e){return this.inspectOpts.colors=this.useColors,s.inspect(e,this.inspectOpts).split("\n").map(e=>e.trim()).join(" ")},i.O=function(e){return this.inspectOpts.colors=this.useColors,s.inspect(e,this.inspectOpts)}},88913:e=>{"use strict";e.exports=(e,t=process.argv)=>{let r=e.startsWith("-")?"":1===e.length?"-":"--",n=t.indexOf(r+e),s=t.indexOf("--");return -1!==n&&(-1===s||n<s)}},18566:(e,t,r)=>{t.utils=r(29501),t.common=r(24781),t.sha=r(21265),t.ripemd=r(33475),t.hmac=r(29665),t.sha1=t.sha.sha1,t.sha256=t.sha.sha256,t.sha224=t.sha.sha224,t.sha384=t.sha.sha384,t.sha512=t.sha.sha512,t.ripemd160=t.ripemd.ripemd160},24781:(e,t,r)=>{"use strict";var n=r(29501),s=r(71460);function i(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}t.BlockHash=i,i.prototype.update=function(e,t){if(e=n.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){var r=(e=this.pending).length%this._delta8;this.pending=e.slice(e.length-r,e.length),0===this.pending.length&&(this.pending=null),e=n.join32(e,0,e.length-r,this.endian);for(var s=0;s<e.length;s+=this._delta32)this._update(e,s,s+this._delta32)}return this},i.prototype.digest=function(e){return this.update(this._pad()),s(null===this.pending),this._digest(e)},i.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,r=t-(e+this.padLength)%t,n=Array(r+this.padLength);n[0]=128;for(var s=1;s<r;s++)n[s]=0;if(e<<=3,"big"===this.endian){for(var i=8;i<this.padLength;i++)n[s++]=0;n[s++]=0,n[s++]=0,n[s++]=0,n[s++]=0,n[s++]=e>>>24&255,n[s++]=e>>>16&255,n[s++]=e>>>8&255,n[s++]=255&e}else for(i=8,n[s++]=255&e,n[s++]=e>>>8&255,n[s++]=e>>>16&255,n[s++]=e>>>24&255,n[s++]=0,n[s++]=0,n[s++]=0,n[s++]=0;i<this.padLength;i++)n[s++]=0;return n}},29665:(e,t,r)=>{"use strict";var n=r(29501),s=r(71460);function i(e,t,r){if(!(this instanceof i))return new i(e,t,r);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(n.toArray(t,r))}e.exports=i,i.prototype._init=function(e){e.length>this.blockSize&&(e=new this.Hash().update(e).digest()),s(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(t=0,this.inner=new this.Hash().update(e);t<e.length;t++)e[t]^=106;this.outer=new this.Hash().update(e)},i.prototype.update=function(e,t){return this.inner.update(e,t),this},i.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)}},33475:(e,t,r)=>{"use strict";var n=r(29501),s=r(24781),i=n.rotl32,a=n.sum32,o=n.sum32_3,l=n.sum32_4,u=s.BlockHash;function d(){if(!(this instanceof d))return new d;u.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}function c(e,t,r,n){return e<=15?t^r^n:e<=31?t&r|~t&n:e<=47?(t|~r)^n:e<=63?t&n|r&~n:t^(r|~n)}n.inherits(d,u),t.ripemd160=d,d.blockSize=512,d.outSize=160,d.hmacStrength=192,d.padLength=64,d.prototype._update=function(e,t){for(var r=this.h[0],n=this.h[1],s=this.h[2],u=this.h[3],d=this.h[4],y=r,m=n,v=s,b=u,_=d,w=0;w<80;w++){var O,E,S=a(i(l(r,c(w,n,s,u),e[h[w]+t],(O=w)<=15?0:O<=31?1518500249:O<=47?1859775393:O<=63?2400959708:2840853838),f[w]),d);r=d,d=u,u=i(s,10),s=n,n=S,S=a(i(l(y,c(79-w,m,v,b),e[p[w]+t],(E=w)<=15?1352829926:E<=31?1548603684:E<=47?1836072691:E<=63?2053994217:0),g[w]),_),y=_,_=b,b=i(v,10),v=m,m=S}S=o(this.h[1],s,b),this.h[1]=o(this.h[2],u,_),this.h[2]=o(this.h[3],d,y),this.h[3]=o(this.h[4],r,m),this.h[4]=o(this.h[0],n,v),this.h[0]=S},d.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"little"):n.split32(this.h,"little")};var h=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],p=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],f=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],g=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},21265:(e,t,r)=>{"use strict";t.sha1=r(33250),t.sha224=r(59825),t.sha256=r(57266),t.sha384=r(73226),t.sha512=r(19920)},33250:(e,t,r)=>{"use strict";var n=r(29501),s=r(24781),i=r(87903),a=n.rotl32,o=n.sum32,l=n.sum32_5,u=i.ft_1,d=s.BlockHash,c=[1518500249,1859775393,2400959708,3395469782];function h(){if(!(this instanceof h))return new h;d.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=Array(80)}n.inherits(h,d),e.exports=h,h.blockSize=512,h.outSize=160,h.hmacStrength=80,h.padLength=64,h.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=a(r[n-3]^r[n-8]^r[n-14]^r[n-16],1);var s=this.h[0],i=this.h[1],d=this.h[2],h=this.h[3],p=this.h[4];for(n=0;n<r.length;n++){var f=~~(n/20),g=l(a(s,5),u(f,i,d,h),p,r[n],c[f]);p=h,h=d,d=a(i,30),i=s,s=g}this.h[0]=o(this.h[0],s),this.h[1]=o(this.h[1],i),this.h[2]=o(this.h[2],d),this.h[3]=o(this.h[3],h),this.h[4]=o(this.h[4],p)},h.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},59825:(e,t,r)=>{"use strict";var n=r(29501),s=r(57266);function i(){if(!(this instanceof i))return new i;s.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}n.inherits(i,s),e.exports=i,i.blockSize=512,i.outSize=224,i.hmacStrength=192,i.padLength=64,i.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h.slice(0,7),"big"):n.split32(this.h.slice(0,7),"big")}},57266:(e,t,r)=>{"use strict";var n=r(29501),s=r(24781),i=r(87903),a=r(71460),o=n.sum32,l=n.sum32_4,u=n.sum32_5,d=i.ch32,c=i.maj32,h=i.s0_256,p=i.s1_256,f=i.g0_256,g=i.g1_256,y=s.BlockHash,m=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function v(){if(!(this instanceof v))return new v;y.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=m,this.W=Array(64)}n.inherits(v,y),e.exports=v,v.blockSize=512,v.outSize=256,v.hmacStrength=192,v.padLength=64,v.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=l(g(r[n-2]),r[n-7],f(r[n-15]),r[n-16]);var s=this.h[0],i=this.h[1],y=this.h[2],m=this.h[3],v=this.h[4],b=this.h[5],_=this.h[6],w=this.h[7];for(a(this.k.length===r.length),n=0;n<r.length;n++){var O=u(w,p(v),d(v,b,_),this.k[n],r[n]),E=o(h(s),c(s,i,y));w=_,_=b,b=v,v=o(m,O),m=y,y=i,i=s,s=o(O,E)}this.h[0]=o(this.h[0],s),this.h[1]=o(this.h[1],i),this.h[2]=o(this.h[2],y),this.h[3]=o(this.h[3],m),this.h[4]=o(this.h[4],v),this.h[5]=o(this.h[5],b),this.h[6]=o(this.h[6],_),this.h[7]=o(this.h[7],w)},v.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},73226:(e,t,r)=>{"use strict";var n=r(29501),s=r(19920);function i(){if(!(this instanceof i))return new i;s.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}n.inherits(i,s),e.exports=i,i.blockSize=1024,i.outSize=384,i.hmacStrength=192,i.padLength=128,i.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h.slice(0,12),"big"):n.split32(this.h.slice(0,12),"big")}},19920:(e,t,r)=>{"use strict";var n=r(29501),s=r(24781),i=r(71460),a=n.rotr64_hi,o=n.rotr64_lo,l=n.shr64_hi,u=n.shr64_lo,d=n.sum64,c=n.sum64_hi,h=n.sum64_lo,p=n.sum64_4_hi,f=n.sum64_4_lo,g=n.sum64_5_hi,y=n.sum64_5_lo,m=s.BlockHash,v=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function b(){if(!(this instanceof b))return new b;m.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=v,this.W=Array(160)}n.inherits(b,m),e.exports=b,b.blockSize=1024,b.outSize=512,b.hmacStrength=192,b.padLength=128,b.prototype._prepareBlock=function(e,t){for(var r=this.W,n=0;n<32;n++)r[n]=e[t+n];for(;n<r.length;n+=2){var s=function(e,t){var r=a(e,t,19)^a(t,e,29)^l(e,t,6);return r<0&&(r+=4294967296),r}(r[n-4],r[n-3]),i=function(e,t){var r=o(e,t,19)^o(t,e,29)^u(e,t,6);return r<0&&(r+=4294967296),r}(r[n-4],r[n-3]),d=r[n-14],c=r[n-13],h=function(e,t){var r=a(e,t,1)^a(e,t,8)^l(e,t,7);return r<0&&(r+=4294967296),r}(r[n-30],r[n-29]),g=function(e,t){var r=o(e,t,1)^o(e,t,8)^u(e,t,7);return r<0&&(r+=4294967296),r}(r[n-30],r[n-29]),y=r[n-32],m=r[n-31];r[n]=p(s,i,d,c,h,g,y,m),r[n+1]=f(s,i,d,c,h,g,y,m)}},b.prototype._update=function(e,t){this._prepareBlock(e,t);var r=this.W,n=this.h[0],s=this.h[1],l=this.h[2],u=this.h[3],p=this.h[4],f=this.h[5],m=this.h[6],v=this.h[7],b=this.h[8],_=this.h[9],w=this.h[10],O=this.h[11],E=this.h[12],S=this.h[13],I=this.h[14],x=this.h[15];i(this.k.length===r.length);for(var k=0;k<r.length;k+=2){var j=I,C=x,T=function(e,t){var r=a(e,t,14)^a(e,t,18)^a(t,e,9);return r<0&&(r+=4294967296),r}(b,_),P=function(e,t){var r=o(e,t,14)^o(e,t,18)^o(t,e,9);return r<0&&(r+=4294967296),r}(b,_),A=function(e,t,r,n,s){var i=e&r^~e&s;return i<0&&(i+=4294967296),i}(b,0,w,0,E,S),N=function(e,t,r,n,s,i){var a=t&n^~t&i;return a<0&&(a+=4294967296),a}(0,_,0,O,0,S),R=this.k[k],Z=this.k[k+1],F=r[k],z=r[k+1],M=g(j,C,T,P,A,N,R,Z,F,z),K=y(j,C,T,P,A,N,R,Z,F,z);j=function(e,t){var r=a(e,t,28)^a(t,e,2)^a(t,e,7);return r<0&&(r+=4294967296),r}(n,s);var U=c(j,C=function(e,t){var r=o(e,t,28)^o(t,e,2)^o(t,e,7);return r<0&&(r+=4294967296),r}(n,s),T=function(e,t,r,n,s){var i=e&r^e&s^r&s;return i<0&&(i+=4294967296),i}(n,0,l,0,p,f),P=function(e,t,r,n,s,i){var a=t&n^t&i^n&i;return a<0&&(a+=4294967296),a}(0,s,0,u,0,f)),D=h(j,C,T,P);I=E,x=S,E=w,S=O,w=b,O=_,b=c(m,v,M,K),_=h(v,v,M,K),m=p,v=f,p=l,f=u,l=n,u=s,n=c(M,K,U,D),s=h(M,K,U,D)}d(this.h,0,n,s),d(this.h,2,l,u),d(this.h,4,p,f),d(this.h,6,m,v),d(this.h,8,b,_),d(this.h,10,w,O),d(this.h,12,E,S),d(this.h,14,I,x)},b.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},87903:(e,t,r)=>{"use strict";var n=r(29501).rotr32;function s(e,t,r){return e&t^e&r^t&r}t.ft_1=function(e,t,r,n){return 0===e?t&r^~t&n:1===e||3===e?t^r^n:2===e?s(t,r,n):void 0},t.ch32=function(e,t,r){return e&t^~e&r},t.maj32=s,t.p32=function(e,t,r){return e^t^r},t.s0_256=function(e){return n(e,2)^n(e,13)^n(e,22)},t.s1_256=function(e){return n(e,6)^n(e,11)^n(e,25)},t.g0_256=function(e){return n(e,7)^n(e,18)^e>>>3},t.g1_256=function(e){return n(e,17)^n(e,19)^e>>>10}},29501:(e,t,r)=>{"use strict";var n=r(71460),s=r(54420);function i(e){return(e>>>24|e>>>8&65280|e<<8&16711680|(255&e)<<24)>>>0}function a(e){return 1===e.length?"0"+e:e}function o(e){if(7===e.length)return"0"+e;if(6===e.length)return"00"+e;if(5===e.length)return"000"+e;if(4===e.length)return"0000"+e;if(3===e.length)return"00000"+e;if(2===e.length)return"000000"+e;if(1===e.length)return"0000000"+e;else return e}t.inherits=s,t.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"==typeof e){if(t){if("hex"===t)for((e=e.replace(/[^a-z0-9]+/ig,"")).length%2!=0&&(e="0"+e),s=0;s<e.length;s+=2)r.push(parseInt(e[s]+e[s+1],16))}else for(var n=0,s=0;s<e.length;s++){var i,a,o=e.charCodeAt(s);o<128?r[n++]=o:(o<2048?r[n++]=o>>6|192:((i=e,a=s,(64512&i.charCodeAt(a))!=55296||a<0||a+1>=i.length?1:(64512&i.charCodeAt(a+1))!=56320)?r[n++]=o>>12|224:(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++s)),r[n++]=o>>18|240,r[n++]=o>>12&63|128),r[n++]=o>>6&63|128),r[n++]=63&o|128)}}else for(s=0;s<e.length;s++)r[s]=0|e[s];return r},t.toHex=function(e){for(var t="",r=0;r<e.length;r++)t+=a(e[r].toString(16));return t},t.htonl=i,t.toHex32=function(e,t){for(var r="",n=0;n<e.length;n++){var s=e[n];"little"===t&&(s=i(s)),r+=o(s.toString(16))}return r},t.zero2=a,t.zero8=o,t.join32=function(e,t,r,s){var i,a=r-t;n(a%4==0);for(var o=Array(a/4),l=0,u=t;l<o.length;l++,u+=4)i="big"===s?e[u]<<24|e[u+1]<<16|e[u+2]<<8|e[u+3]:e[u+3]<<24|e[u+2]<<16|e[u+1]<<8|e[u],o[l]=i>>>0;return o},t.split32=function(e,t){for(var r=Array(4*e.length),n=0,s=0;n<e.length;n++,s+=4){var i=e[n];"big"===t?(r[s]=i>>>24,r[s+1]=i>>>16&255,r[s+2]=i>>>8&255,r[s+3]=255&i):(r[s+3]=i>>>24,r[s+2]=i>>>16&255,r[s+1]=i>>>8&255,r[s]=255&i)}return r},t.rotr32=function(e,t){return e>>>t|e<<32-t},t.rotl32=function(e,t){return e<<t|e>>>32-t},t.sum32=function(e,t){return e+t>>>0},t.sum32_3=function(e,t,r){return e+t+r>>>0},t.sum32_4=function(e,t,r,n){return e+t+r+n>>>0},t.sum32_5=function(e,t,r,n,s){return e+t+r+n+s>>>0},t.sum64=function(e,t,r,n){var s=e[t],i=n+e[t+1]>>>0;e[t]=(i<n?1:0)+r+s>>>0,e[t+1]=i},t.sum64_hi=function(e,t,r,n){return(t+n>>>0<t?1:0)+e+r>>>0},t.sum64_lo=function(e,t,r,n){return t+n>>>0},t.sum64_4_hi=function(e,t,r,n,s,i,a,o){var l,u=t;return e+r+s+a+(0+((u=u+n>>>0)<t?1:0)+((u=u+i>>>0)<i?1:0)+((u=u+o>>>0)<o?1:0))>>>0},t.sum64_4_lo=function(e,t,r,n,s,i,a,o){return t+n+i+o>>>0},t.sum64_5_hi=function(e,t,r,n,s,i,a,o,l,u){var d,c=t;return e+r+s+a+l+(0+((c=c+n>>>0)<t?1:0)+((c=c+i>>>0)<i?1:0)+((c=c+o>>>0)<o?1:0)+((c=c+u>>>0)<u?1:0))>>>0},t.sum64_5_lo=function(e,t,r,n,s,i,a,o,l,u){return t+n+i+o+u>>>0},t.rotr64_hi=function(e,t,r){return(t<<32-r|e>>>r)>>>0},t.rotr64_lo=function(e,t,r){return(e<<32-r|t>>>r)>>>0},t.shr64_hi=function(e,t,r){return e>>>r},t.shr64_lo=function(e,t,r){return(e<<32-r|t>>>r)>>>0}},54420:(e,t,r)=>{try{var n=r(73837);if("function"!=typeof n.inherits)throw"";e.exports=n.inherits}catch(t){e.exports=r(46238)}},46238:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},61778:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InngestApi=void 0;let n=r(27353),s=r(84728),i=r(52889),a=r(31861),o=r(81374),l=r(59121),u=r(34557),d=r(36991),c=n.z.object({jwt:n.z.string()}),h=n.z.object({data:n.z.object({run_id:n.z.string().min(1)})});class p{constructor({baseUrl:e,signingKey:t,signingKeyFallback:r,fetch:n,mode:s}){this.apiBaseUrl=e,this.signingKey=t,this.signingKeyFallback=r,this.fetch=n,this.mode=s}get hashedKey(){return(0,l.hashSigningKey)(this.signingKey)}get hashedFallbackKey(){if(this.signingKeyFallback)return(0,l.hashSigningKey)(this.signingKeyFallback)}setSigningKey(e){"string"==typeof e&&""===this.signingKey&&(this.signingKey=e)}setSigningKeyFallback(e){"string"!=typeof e||this.signingKeyFallback||(this.signingKeyFallback=e)}async getTargetUrl(e){if(this.apiBaseUrl)return new URL(e,this.apiBaseUrl);let t=new URL(e,s.defaultInngestApiBaseUrl);return this.mode.isDev&&this.mode.isInferred&&!this.apiBaseUrl&&await (0,i.devServerAvailable)(s.defaultDevServerHost,this.fetch)&&(t=new URL(e,s.defaultDevServerHost)),t}async getRunSteps(e,t){return(0,o.fetchWithAuthFallback)({authToken:this.hashedKey,authTokenFallback:this.hashedFallbackKey,fetch:this.fetch,url:await this.getTargetUrl(`/v0/runs/${e}/actions`)}).then(async e=>{let r=await e.json();return e.ok?(0,u.ok)(d.stepsSchemas[t].parse(r)):(0,u.err)(d.errorSchema.parse(r))}).catch(e=>(0,u.err)({error:(0,a.getErrorMessage)(e,"Unknown error retrieving step data"),status:500}))}async getRunBatch(e){return(0,o.fetchWithAuthFallback)({authToken:this.hashedKey,authTokenFallback:this.hashedFallbackKey,fetch:this.fetch,url:await this.getTargetUrl(`/v0/runs/${e}/batch`)}).then(async e=>{let t=await e.json();return e.ok?(0,u.ok)(d.batchSchema.parse(t)):(0,u.err)(d.errorSchema.parse(t))}).catch(e=>(0,u.err)({error:(0,a.getErrorMessage)(e,"Unknown error retrieving event batch"),status:500}))}async publish(e,t){let r=t instanceof ReadableStream,n=await this.getTargetUrl("/v1/realtime/publish");return n.searchParams.set("channel",e.channel||""),e.runId&&n.searchParams.set("run_id",e.runId),e.topics.forEach(e=>{n.searchParams.append("topic",e)}),(0,o.fetchWithAuthFallback)({authToken:this.hashedKey,authTokenFallback:this.hashedFallbackKey,fetch:this.fetch,url:n,options:Object.assign({method:"POST",body:r?t:"string"==typeof t?t:JSON.stringify(t),headers:{"Content-Type":r?"text/stream":"application/json"}},r?{duplex:"half"}:{})}).then(e=>{if(!e.ok)throw Error(`Failed to publish event: ${e.status} ${e.statusText}`);return(0,u.ok)(void 0)}).catch(e=>(0,u.err)({error:(0,a.getErrorMessage)(e,"Unknown error publishing event"),status:500}))}async sendSignal(e,t){let r=await this.getTargetUrl("/v1/signals"),n={signal:e.signal,data:e.data};return(0,o.fetchWithAuthFallback)({authToken:this.hashedKey,authTokenFallback:this.hashedFallbackKey,fetch:this.fetch,url:r,options:{method:"POST",body:JSON.stringify(n),headers:Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers)}}).then(async e=>{let t;if(404===e.status)return(0,u.ok)({runId:void 0});let r=e.clone();try{t=await e.json()}catch(t){return(0,u.err)({error:`Failed to send signal: ${e.status} ${e.statusText} - ${await r.text()}`,status:e.status})}if(!e.ok)try{return(0,u.err)(d.errorSchema.parse(t))}catch(t){return(0,u.err)({error:`Failed to send signal: ${e.status} ${e.statusText} - ${await e.text()}`,status:e.status})}let n=h.safeParse(t);return n.success?(0,u.ok)({runId:n.data.data.run_id}):(0,u.err)({error:`Successfully sent signal, but response parsing failed: ${e.status} ${e.statusText} - ${await r.text()}`,status:e.status})}).catch(e=>(0,u.err)({error:(0,a.getErrorMessage)(e,"Unknown error sending signal"),status:500}))}async getSubscriptionToken(e,t){let r=await this.getTargetUrl("/v1/realtime/token"),n=t.map(t=>({channel:e,name:t,kind:"run"}));return(0,o.fetchWithAuthFallback)({authToken:this.hashedKey,authTokenFallback:this.hashedFallbackKey,fetch:this.fetch,url:r,options:{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}}).then(async e=>{if(!e.ok)throw Error(`Failed to get subscription token: ${e.status} ${e.statusText} - ${await e.text()}`);return c.parse(await e.json()).jwt}).catch(e=>{throw Error((0,a.getErrorMessage)(e,"Unknown error getting subscription token"))})}}t.InngestApi=p},36991:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.batchSchema=t.stepsSchemas=t.errorSchema=void 0;let n=r(27353),s=r(95486),i=r(34557);t.errorSchema=n.z.object({error:n.z.string(),status:n.z.number()});let a=n.z.record(n.z.any().refine(e=>void 0!==e,{message:"Values in steps must be defined"})).optional().nullable(),o=n.z.record(n.z.object({type:n.z.literal("data").optional().default("data"),data:n.z.any().refine(e=>void 0!==e,{message:"Data in steps must be defined"})}).strict().or(n.z.object({type:n.z.literal("error").optional().default("error"),error:i.jsonErrorSchema}).strict()).or(n.z.object({type:n.z.literal("input").optional().default("input"),input:n.z.any().refine(e=>void 0!==e,{message:"If input is present it must not be `undefined`"})}).strict()).or(n.z.any().transform(e=>({type:"data",data:e})))).default({});t.stepsSchemas={[s.ExecutionVersion.V0]:a,[s.ExecutionVersion.V1]:o,[s.ExecutionVersion.V2]:o},t.batchSchema=n.z.array(n.z.record(n.z.any()).transform(e=>e))},97888:function(e,t){"use strict";var r=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)0>t.indexOf(n[s])&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r};Object.defineProperty(t,"__esModule",{value:!0}),t.EventSchemas=void 0;class n{constructor(){this.runtimeSchemas={}}addRuntimeSchemas(e){this.runtimeSchemas=Object.assign(Object.assign({},this.runtimeSchemas),e)}fromGenerated(){return this}fromRecord(...e){return this}fromUnion(){return this}fromZod(e){let t;return t=Array.isArray(e)?e.reduce((e,t)=>{let n=t.shape,{name:{value:s}}=n,i=r(n,["name"]);return Object.assign(Object.assign({},e),{[s]:i})},{}):e,this.addRuntimeSchemas(t),this}}t.EventSchemas=n},97177:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.fetch=void 0;let s=n(r(57034)),i=r(98340),a=r(24968),o=globalThis.fetch,l=(0,s.default)("inngest:fetch");t.fetch=(()=>{let e;let t={fallback:o};return e=Object.assign(async(t,r)=>{let n=await (0,i.getAsyncCtx)();if(!n){if(!e.fallback)throw Error("step.fetch() called outside of a function and had no fallback set");return l("step.fetch() called outside of a function; falling back to global fetch"),e.fallback(t,r)}if(n.executingStep){if(!e.fallback)throw Error(`step.fetch() called inside step "${n.executingStep.id}" and had no fallback set`);return l(`step.fetch() called inside step "${n.executingStep.id}"; falling back to global fetch`),e.fallback(t,r)}let s=new URL(t instanceof Request?t.url:t.toString());l("step.fetch() shimming request to",s.hostname);let o=await n.ctx.step[a.gatewaySymbol](`step.fetch: ${s.hostname}`,t,r);return new Response(o.body,{headers:o.headers,status:o.status})},Object.assign({config:r=>(Object.assign(t,r),Object.assign(e,t),e)},t))})()},11346:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.builtInMiddleware=t.Inngest=void 0;let n=r(61778),s=r(84728),i=r(61575),a=r(52889),o=r(62019),l=r(31861),u=r(82576),d=r(59121),c=r(92899),h=r(34557),p=r(17410),f=r(76206);class g{get apiBaseUrl(){return this._apiBaseUrl}get eventBaseUrl(){return this._eventBaseUrl}get env(){var e;return null!==(e=this.headers[s.headerKeys.Environment])&&void 0!==e?e:null}get appVersion(){return this._appVersion}constructor(e){this.eventKey="",this.sendEventUrl=new URL(`e/${this.eventKey}`,s.defaultInngestEventBaseUrl),this.localFns=[],this.createFunction=(e,t,r)=>{let n=this._createFunction(e,t,r);return this.localFns.push(n),n},this._createFunction=(e,t,r)=>{let n=this.sanitizeOptions(e),s=this.sanitizeTriggers(t);return new p.InngestFunction(this,Object.assign(Object.assign({},n),{triggers:s}),r)},this.options=e;let{id:r,fetch:i,logger:a=new c.DefaultLogger,middleware:l,isDev:u,schemas:d,appVersion:h}=this.options;if(!r)throw Error("An `id` must be passed to create an Inngest instance.");this.id=r,this._mode=(0,o.getMode)({explicitMode:"boolean"==typeof u?u?"dev":"cloud":void 0}),this.fetch=(0,o.getFetch)(i),this.inngestApi=new n.InngestApi({baseUrl:this.apiBaseUrl,signingKey:(0,o.processEnv)(s.envKeys.InngestSigningKey)||"",signingKeyFallback:(0,o.processEnv)(s.envKeys.InngestSigningKeyFallback),fetch:this.fetch,mode:this.mode}),this.schemas=d,this.loadModeEnvVars(),this.logger=a,this.middleware=this.initializeMiddleware([...t.builtInMiddleware,...l||[]]),this._appVersion=h}get ready(){return this.middleware.then(()=>{})}setEnvVars(e=(0,o.allProcessEnv)()){return this.mode=(0,o.getMode)({env:e,client:this}),this}loadModeEnvVars(){this._apiBaseUrl=this.options.baseUrl||this.mode.env[s.envKeys.InngestApiBaseUrl]||this.mode.env[s.envKeys.InngestBaseUrl]||this.mode.getExplicitUrl(s.defaultInngestApiBaseUrl),this._eventBaseUrl=this.options.baseUrl||this.mode.env[s.envKeys.InngestEventApiBaseUrl]||this.mode.env[s.envKeys.InngestBaseUrl]||this.mode.getExplicitUrl(s.defaultInngestEventBaseUrl),this.setEventKey(this.options.eventKey||this.mode.env[s.envKeys.InngestEventKey]||""),this.headers=(0,o.inngestHeaders)({inngestEnv:this.options.env,env:this.mode.env}),this.inngestApi.mode=this.mode,this.inngestApi.apiBaseUrl=this._apiBaseUrl}async initializeMiddleware(e=[],t){var r;let n=await (null!==(r=null==t?void 0:t.prefixStack)&&void 0!==r?r:[]),s=e.reduce(async(e,r)=>[...await e,await r.init(Object.assign({client:this},null==t?void 0:t.registerInput))],Promise.resolve([]));return[...n,...await s]}get mode(){return this._mode}set mode(e){this._mode=e,this.loadModeEnvVars()}async getResponseError(e,t,r="Unknown error"){let n=r;if("Unknown error"===n)switch(e.status){case 401:n="Event key Not Found";break;case 400:n="Cannot process event payload";break;case 403:n="Forbidden";break;case 404:n="Event key not found";break;case 406:n=`${JSON.stringify(await t)}`;break;case 409:case 412:n="Event transformation failed";break;case 413:n="Event payload too large";break;case 500:n="Internal server error";break;default:try{n=await e.text()}catch(e){n=`${JSON.stringify(await t)}`}}return Error(`Inngest API Error: ${e.status} ${n}`)}setEventKey(e){this.eventKey=e||s.dummyEventKey,this.sendEventUrl=new URL(`e/${this.eventKey}`,this.eventBaseUrl||s.defaultInngestEventBaseUrl)}eventKeySet(){return!!this.eventKey&&this.eventKey!==s.dummyEventKey}async sendSignal({signal:e,data:t,env:r}){let n=Object.assign({},r?{[s.headerKeys.Environment]:r}:{});return this._sendSignal({signal:e,data:t,headers:n})}async _sendSignal({signal:e,data:t,headers:r}){var n;let s=await this.inngestApi.sendSignal({signal:e,data:t},Object.assign(Object.assign({},this.headers),r));if(s.ok)return s.value;throw Error(`Failed to send signal: ${(null===(n=s.error)||void 0===n?void 0:n.error)||"Unknown error"}`)}async send(e,t){let r=Object.assign({},(null==t?void 0:t.env)?{[s.headerKeys.Environment]:t.env}:{});return this._send({payload:e,headers:r})}async _send({payload:e,headers:t}){var r;let n=new Date().getTime(),o=5;try{let e=(0,i.createEntropy)(10),r=Buffer.from(e).toString("base64");t=Object.assign(Object.assign({},t),{[s.headerKeys.EventIdSeed]:`${n},${r}`})}catch(t){let e="Event-sending retries disabled";t instanceof Error&&(e+=`: ${t.message}`),console.debug(e),o=1}let c=await (0,f.getHookStack)(this.middleware,"onSendEvent",void 0,{transformInput:(e,t)=>Object.assign(Object.assign({},e),t),transformOutput:(e,t)=>({result:Object.assign(Object.assign({},e.result),null==t?void 0:t.result)})}),p=Array.isArray(e)?e:e?[e]:[],g=await (null===(r=c.transformInput)||void 0===r?void 0:r.call(c,{payloads:[...p]}));(null==g?void 0:g.payloads)&&(p=[...g.payloads]);let y=async e=>{var t;let r=await (null===(t=c.transformOutput)||void 0===t?void 0:t.call(c,e));return Object.assign(Object.assign({},e.result),null==r?void 0:r.result)};if(!(p=p.map(e=>Object.assign(Object.assign({},e),{id:e.id,ts:e.ts||n,data:e.data||{}}))).length)return console.warn((0,l.prettyError)({type:"warn",whatHappened:"`inngest.send()` called with no events",reassurance:"This is not an error, but you may not have intended to do this.",consequences:"The returned promise will resolve, but no events have been sent to Inngest.",stack:!0})),await y({result:{ids:[]}});let m=this.sendEventUrl.href;if(this.mode.isCloud&&!this.eventKeySet())throw Error((0,l.prettyError)({whatHappened:"Failed to send event",consequences:"Your event or events were not sent to Inngest.",why:"We couldn't find an event key to use to send events to Inngest.",toFixNow:l.fixEventKeyMissingSteps}));this.mode.isDev&&this.mode.isInferred&&!this.eventBaseUrl&&await (0,a.devServerAvailable)(s.defaultDevServerHost,this.fetch)&&(m=(0,a.devServerUrl)(s.defaultDevServerHost,`e/${this.eventKey}`).href);let v=await (0,u.retryWithBackoff)(async()=>{let e,r;let n=await this.fetch(m,{method:"POST",body:(0,d.stringify)(p),headers:Object.assign(Object.assign({},this.headers),t)});try{e=await n.json(),r=await h.sendEventResponseSchema.parseAsync(e)}catch(t){throw await this.getResponseError(n,e)}if(200!==r.status||r.error)throw await this.getResponseError(n,e,r.error);return r},{maxAttempts:o,baseDelay:100});return await y({result:{ids:v.ids}})}get funcs(){return this.localFns}sanitizeOptions(e){return(Object.prototype.hasOwnProperty.call(e,"fns")&&console.warn(`${s.logPrefix} InngestFunction: \`fns\` option has been deprecated in v3; use \`middleware\` instead. See https://www.inngest.com/docs/sdk/migration`),"string"==typeof e)?(console.warn(`${s.logPrefix} InngestFunction: Creating a function with a string as the first argument has been deprecated in v3; pass an object instead. See https://www.inngest.com/docs/sdk/migration`),{id:e}):e}sanitizeTriggers(e){return"string"==typeof e?(console.warn(`${s.logPrefix} InngestFunction: Creating a function with a string as the second argument has been deprecated in v3; pass an object instead. See https://www.inngest.com/docs/sdk/migration`),[{event:e}]):Array.isArray(e)?e:[e]}}t.Inngest=g,t.builtInMiddleware=[new f.InngestMiddleware({name:"Inngest: Logger",init:({client:e})=>({onFunctionRun(t){let{ctx:r}=t,n={runID:r.runId,eventName:r.event.name,functionName:t.fn.name},s=e.logger;try{"child"in s&&(s=s.child(n))}catch(e){console.error('failed to create "childLogger" with error: ',e)}let i=new c.ProxyLogger(s);return{transformInput:()=>({ctx:{logger:i}}),beforeExecution(){i.enable()},transformOutput({result:{error:e}}){e&&i.error(e)},async beforeResponse(){await i.flush()}}}})})]},36272:function(e,t,r){"use strict";var n,s,i=this&&this.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InngestCommHandler=void 0;let o=a(r(57034)),l=r(27353),u=r(35593),d=r(84728),c=r(52889),h=r(51606),p=r(62019),f=r(31861),g=r(31511),y=r(81374),m=r(82576),v=r(12067),b=r(59121),_=r(34557),w=r(4711),O=r(95486),E=l.z.object({status:l.z.number().default(200),skipped:l.z.boolean().optional().default(!1),modified:l.z.boolean().optional().default(!1),error:l.z.string().default("Successfully registered")});class S{constructor(e){var t;if(this.fns={},this.env=(0,p.allProcessEnv)(),this._options=e,Object.prototype.hasOwnProperty.call(e,"eventKey"))throw Error(`${d.logPrefix} You've passed an Inngest client as the first argument to your serve handler. This is no longer supported in v3; please pass the Inngest client as the \`client\` property of an options object instead. See https://www.inngest.com/docs/sdk/migration`);this.frameworkName=e.frameworkName,this.client=e.client,e.id&&console.warn(`${d.logPrefix} The \`id\` serve option is deprecated and will be removed in v4`),this.id=e.id||this.client.id,this.handler=e.handler,this.allowExpiredSignatures=!!(null===(t=arguments[0])||void 0===t?void 0:t.__testingAllowExpiredSignatures),this.rawFns=e.functions.filter(Boolean),this.rawFns.length!==e.functions.length&&console.warn("Some functions passed to serve() are undefined and misconfigured.  Please check your imports."),this.fns=this.rawFns.reduce((e,t)=>{let r=t.getConfig({baseUrl:new URL("https://example.com"),appPrefix:this.id}),n=r.reduce((e,{id:r},n)=>Object.assign(Object.assign({},e),{[r]:{fn:t,onFailure:!!n}}),{});return r.forEach(({id:t})=>{if(e[t])throw Error(`Duplicate function ID "${t}"; please change a function's name or provide an explicit ID to avoid conflicts.`)}),Object.assign(Object.assign({},e),n)},{}),this.inngestRegisterUrl=new URL("/fn/register",this.apiBaseUrl),this.signingKey=e.signingKey,this.signingKeyFallback=e.signingKeyFallback,this._serveHost=e.serveHost||this.env[d.envKeys.InngestServeHost],this._servePath=e.servePath||this.env[d.envKeys.InngestServePath],this.skipSignatureValidation=e.skipSignatureValidation||!1;let r="info";this.logLevel=l.z.enum(_.logLevels).default(r).catch(e=>(this.log("warn",`Unknown log level passed: ${String(e.input)}; defaulting to ${r}`),r)).parse(e.logLevel||this.env[d.envKeys.InngestLogLevel]),"debug"===this.logLevel&&o.default.enable&&"function"==typeof o.default.enable&&o.default.enable(`${d.debugPrefix}:*`),this.streaming=l.z.union([l.z.enum(["allow","force"]),l.z.literal(!1)]).default(!1).catch(e=>(this.log("warn",`Unknown streaming option passed: ${String(e.input)}; defaulting to ${String(!1)}`),!1)).parse(e.streaming||this.env[d.envKeys.InngestStreaming]),this.fetch=e.fetch?(0,p.getFetch)(e.fetch):this.client.fetch}get apiBaseUrl(){return this._options.baseUrl||this.env[d.envKeys.InngestApiBaseUrl]||this.env[d.envKeys.InngestBaseUrl]||this.client.apiBaseUrl||d.defaultInngestApiBaseUrl}get eventApiBaseUrl(){return this._options.baseUrl||this.env[d.envKeys.InngestEventApiBaseUrl]||this.env[d.envKeys.InngestBaseUrl]||this.client.eventBaseUrl||d.defaultInngestEventBaseUrl}get serveHost(){return this._serveHost||this.env[d.envKeys.InngestServeHost]}get servePath(){return this._servePath||this.env[d.envKeys.InngestServePath]}get hashedEventKey(){if(this.client.eventKey&&this.client.eventKey!==d.dummyEventKey)return(0,b.hashEventKey)(this.client.eventKey)}get hashedSigningKey(){if(this.signingKey)return(0,b.hashSigningKey)(this.signingKey)}get hashedSigningKeyFallback(){if(this.signingKeyFallback)return(0,b.hashSigningKey)(this.signingKeyFallback)}async shouldStream(e){return void 0===await e.queryStringWithDefaults("testing for probe",d.queryKeys.Probe)&&!!e.transformStreamingResponse&&("force"===this.streaming||"allow"===this.streaming&&(0,p.platformSupportsStreaming)(this.frameworkName,this.env))}createHandler(){let e=async(...e)=>{var t,r;let n=new u.ServerTiming,s=e[e.length-1],i="object"==typeof s&&null!==s&&"actionOverrides"in s&&"object"==typeof s.actionOverrides&&null!==s.actionOverrides?s.actionOverrides:{},a=Object.assign(Object.assign(Object.assign({},Object.entries(Object.assign(Object.assign({},await n.wrap("handler",()=>this.handler(...e)).catch((0,f.rethrowError)("Serve handler failed to run"))),i)).reduce((e,[t,r])=>"function"!=typeof r?e:Object.assign(Object.assign({},e),{[t]:(e,...n)=>{let s=[`Failed calling \`${t}\` from serve handler`,e].filter(Boolean).join(" when ");return(0,m.runAsPromise)(()=>r(...n)).catch((0,f.rethrowError)(s)).catch(e=>{throw this.log("error",e),e})}}),{})),{queryStringWithDefaults:async(e,t)=>{var r;let n=await a.url(e);return await (null===(r=a.queryString)||void 0===r?void 0:r.call(a,e,t,n))||n.searchParams.get(t)||void 0}}),i),[o,l]=await Promise.all([null===(t=a.env)||void 0===t?void 0:t.call(a,"starting to handle request"),a.headers("checking expected server kind",d.headerKeys.InngestServerKind)]);this.env=Object.assign(Object.assign({},(0,p.allProcessEnv)()),o);let c=()=>(0,p.inngestHeaders)({env:this.env,framework:this.frameworkName,client:this.client,expectedServerKind:l||void 0,extras:{"Server-Timing":n.getHeader()}}),h=(0,p.getMode)({env:this.env,client:this.client});if(h.isExplicit)this._mode=h;else{let e=await (null===(r=a.isProduction)||void 0===r?void 0:r.call(a,"starting to handle request"));"boolean"==typeof e?this._mode=new p.Mode({type:e?"cloud":"dev",isExplicit:!1}):this._mode=h}this.upsertKeysFromEnv();let g=a.method("starting to handle request"),y=[d.headerKeys.TraceParent,d.headerKeys.TraceState].map(async e=>{let t=await a.headers(`fetching ${e} for forwarding`,e);return{header:e,value:t}}),_=await a.headers("checking signature for request",d.headerKeys.ContentLength).then(e=>{if(e)return parseInt(e,10)}),[w,E,S]=await Promise.all([a.headers("checking signature for request",d.headerKeys.Signature).then(e=>null!=e?e:void 0),g,g.then(e=>("POST"===e||"PUT"===e)&&_?a.body(`checking body for request signing as method is ${e}`):"")]),I=this.validateSignature(w,S),x=Promise.all(y).then(e=>e.reduce((e,{header:t,value:r})=>(r&&(e[t]=r),e),{})),k=n.wrap("action",()=>this.handleAction({actions:a,timer:n,getInngestHeaders:c,reqArgs:e,signatureValidation:I,body:S,method:E,headers:x})),j=async e=>{var t;let r;let n=Object.assign(Object.assign(Object.assign(Object.assign({},c()),await x),e.headers),null===e.version?{}:{[d.headerKeys.RequestVersion]:(null!==(t=e.version)&&void 0!==t?t:O.PREFERRED_EXECUTION_VERSION).toString()});try{r=await I.then(t=>{if(t.success&&t.keyUsed)return this.getResponseSignature(t.keyUsed,e.body)})}catch(t){return Object.assign(Object.assign({},e),{headers:n,body:(0,b.stringify)((0,f.serializeError)(t)),status:500})}return r&&(n[d.headerKeys.Signature]=r),Object.assign(Object.assign({},e),{headers:n})};if(await this.shouldStream(a)&&"POST"===await a.method("starting streaming response")){let{stream:e,finalize:t}=await (0,v.createStream)();return k.then(e=>t(j(e))),n.wrap("res",()=>{var t;return null===(t=a.transformStreamingResponse)||void 0===t?void 0:t.call(a,"starting streaming response",{status:201,headers:c(),body:e,version:null})})}return n.wrap("res",async()=>k.then(j).then(e=>a.transformResponse("sending back response",e)))};return Object.defineProperties(e,{name:{value:"InngestHandler"},length:{value:this.handler.length}}),e}get mode(){return this._mode}set mode(e){this._mode=e,e&&(this.client.mode=e)}async handleAction({actions:e,timer:t,getInngestHeaders:r,reqArgs:n,signatureValidation:s,body:i,method:a,headers:o}){var l;let u=void 0===i;try{let c=await e.url("starting to handle request");if("POST"===a){if(u)return this.log("error","Missing body when executing, possibly due to missing request body middleware"),{status:500,headers:{"Content-Type":"application/json"},body:(0,b.stringify)((0,f.serializeError)(Error("Missing request body when executing, possibly due to missing request body middleware"))),version:void 0};let r=await s;if(!r.success)return{status:401,headers:{"Content-Type":"application/json"},body:(0,b.stringify)((0,f.serializeError)(r.err)),version:void 0};let a=await e.queryStringWithDefaults("testing for probe",d.queryKeys.Probe);if(a){let e=(0,h.enumFromValue)(d.probe,a);if(!e)return{status:400,headers:{"Content-Type":"application/json"},body:(0,b.stringify)((0,f.serializeError)(Error(`Unknown probe "${a}"`))),version:void 0};return({[d.probe.Trust]:()=>({status:200,headers:{"Content-Type":"application/json"},body:"",version:void 0})})[e]()}let l=await e.queryStringWithDefaults("processing run request",d.queryKeys.FnId);if(!l)throw Error("No function ID found in request");let c=await e.queryStringWithDefaults("processing run request",d.queryKeys.StepId)||null,{version:p,result:y}=this.runStep({functionId:l,data:i,stepId:c,timer:t,reqArgs:n,headers:await o}),m=await y,v=e=>(e.data=(0,g.undefinedToNull)(e.data),e),_={"function-rejected":e=>({status:e.retriable?500:400,headers:Object.assign({"Content-Type":"application/json",[d.headerKeys.NoRetry]:e.retriable?"false":"true"},"string"==typeof e.retriable?{[d.headerKeys.RetryAfter]:e.retriable}:{}),body:(0,b.stringify)((0,g.undefinedToNull)(e.error)),version:p}),"function-resolved":e=>({status:200,headers:{"Content-Type":"application/json"},body:(0,b.stringify)((0,g.undefinedToNull)(e.data)),version:p}),"step-not-found":e=>({status:500,headers:{"Content-Type":"application/json",[d.headerKeys.NoRetry]:"false"},body:(0,b.stringify)({error:`Could not find step "${e.step.displayName||e.step.id}" to run; timed out`}),version:p}),"step-ran":e=>{let t=v(e.step);return{status:206,headers:Object.assign({"Content-Type":"application/json"},void 0!==e.retriable?Object.assign({[d.headerKeys.NoRetry]:e.retriable?"false":"true"},"string"==typeof e.retriable?{[d.headerKeys.RetryAfter]:e.retriable}:{}):{}),body:(0,b.stringify)([t]),version:p}},"steps-found":e=>{let t=e.steps.map(v);return{status:206,headers:{"Content-Type":"application/json"},body:(0,b.stringify)(t),version:p}}}[m.type];try{return await _(m)}catch(e){throw this.log("error","Error handling execution result",e),e}}let y=null!==(l=r()[d.headerKeys.Environment])&&void 0!==l?l:null;if("GET"===a)return{status:200,body:(0,b.stringify)(await this.introspectionBody({actions:e,env:y,signatureValidation:s,url:c})),headers:{"Content-Type":"application/json"},version:void 0};if("PUT"===a){let[t,n]=await Promise.all([e.queryStringWithDefaults("processing deployment request",d.queryKeys.DeployId).then(e=>"undefined"===e?void 0:e),Promise.resolve((0,p.parseAsBoolean)(this.env[d.envKeys.InngestAllowInBandSync])).then(t=>void 0===t||t?e.headers("processing deployment request",d.headerKeys.InngestSyncKind):d.syncKind.OutOfBand).then(e=>e===d.syncKind.InBand)]);if(n){if(u)return this.log("error","Missing body when syncing, possibly due to missing request body middleware"),{status:500,headers:{"Content-Type":"application/json"},body:(0,b.stringify)((0,f.serializeError)(Error("Missing request body when syncing, possibly due to missing request body middleware"))),version:void 0};if(!(await s).success)return{status:401,body:(0,b.stringify)({code:"sig_verification_failed"}),headers:{"Content-Type":"application/json"},version:void 0};let r=_.inBandSyncRequestBodySchema.safeParse(i);if(!r.success)return{status:400,body:(0,b.stringify)({code:"invalid_request",message:r.error.message}),headers:{"Content-Type":"application/json"},version:void 0};c=this.reqUrl(new URL(r.data.url));let n=await this.inBandRegisterBody({actions:e,deployId:t,env:y,signatureValidation:s,url:c});return{status:200,body:(0,b.stringify)(n),headers:{"Content-Type":"application/json",[d.headerKeys.InngestSyncKind]:d.syncKind.InBand},version:void 0}}let{status:a,message:o,modified:l}=await this.register(this.reqUrl(c),t,r);return{status:a,body:(0,b.stringify)({message:o,modified:l}),headers:{"Content-Type":"application/json",[d.headerKeys.InngestSyncKind]:d.syncKind.OutOfBand},version:void 0}}}catch(e){return{status:500,body:(0,b.stringify)(Object.assign({type:"internal"},(0,f.serializeError)(e))),headers:{"Content-Type":"application/json"},version:void 0}}return{status:405,body:JSON.stringify({message:"No action found; request was likely not POST, PUT, or GET",mode:this._mode}),headers:{},version:void 0}}runStep({functionId:e,stepId:t,data:r,timer:n,reqArgs:s,headers:i}){var a,o;let l=this.fns[e];if(!l)throw Error(`Could not find function with ID "${e}"`);let u=(0,g.parseFnData)(r),{version:d}=u;d===O.ExecutionVersion.V1&&(null===(o=(a=l.fn).shouldOptimizeParallelism)||void 0===o?void 0:o.call(a))&&(d=O.ExecutionVersion.V2);let c=(0,m.runAsPromise)(async()=>{let e=await (0,g.fetchAllFnData)({data:u,api:this.client.inngestApi,version:d});if(!e.ok)throw Error(e.error);let r={[O.ExecutionVersion.V0]:({event:e,events:r,steps:a,ctx:o,version:u})=>{var d,c,h;let p=Object.entries(null!=a?a:{}).reduce((e,[t,r])=>Object.assign(Object.assign({},e),{[t]:{id:t,data:r}}),{});return{version:u,partialOptions:{client:this.client,runId:(null==o?void 0:o.run_id)||"",data:{event:e,events:r,runId:(null==o?void 0:o.run_id)||"",attempt:null!==(d=null==o?void 0:o.attempt)&&void 0!==d?d:0},stepState:p,requestedRunStep:"step"===t?void 0:t||void 0,timer:n,isFailureHandler:l.onFailure,stepCompletionOrder:null!==(h=null===(c=null==o?void 0:o.stack)||void 0===c?void 0:c.stack)&&void 0!==h?h:[],reqArgs:s,headers:i}}},[O.ExecutionVersion.V1]:({event:e,events:r,steps:a,ctx:o,version:u})=>{var d,c,h;let p=Object.entries(null!=a?a:{}).reduce((e,[t,r])=>Object.assign(Object.assign({},e),{[t]:"data"===r.type?{id:t,data:r.data}:"input"===r.type?{id:t,input:r.input}:{id:t,error:r.error}}),{});return{version:u,partialOptions:{client:this.client,runId:(null==o?void 0:o.run_id)||"",data:{event:e,events:r,runId:(null==o?void 0:o.run_id)||"",attempt:null!==(d=null==o?void 0:o.attempt)&&void 0!==d?d:0},stepState:p,requestedRunStep:"step"===t?void 0:t||void 0,timer:n,isFailureHandler:l.onFailure,disableImmediateExecution:null==o?void 0:o.disable_immediate_execution,stepCompletionOrder:null!==(h=null===(c=null==o?void 0:o.stack)||void 0===c?void 0:c.stack)&&void 0!==h?h:[],reqArgs:s,headers:i}}},[O.ExecutionVersion.V2]:({event:e,events:r,steps:a,ctx:o,version:u})=>{var d,c,h;let p=Object.entries(null!=a?a:{}).reduce((e,[t,r])=>Object.assign(Object.assign({},e),{[t]:"data"===r.type?{id:t,data:r.data}:"input"===r.type?{id:t,input:r.input}:{id:t,error:r.error}}),{});return{version:u,partialOptions:{client:this.client,runId:(null==o?void 0:o.run_id)||"",data:{event:e,events:r,runId:(null==o?void 0:o.run_id)||"",attempt:null!==(d=null==o?void 0:o.attempt)&&void 0!==d?d:0},stepState:p,requestedRunStep:"step"===t?void 0:t||void 0,timer:n,isFailureHandler:l.onFailure,disableImmediateExecution:null==o?void 0:o.disable_immediate_execution,stepCompletionOrder:null!==(h=null===(c=null==o?void 0:o.stack)||void 0===c?void 0:c.stack)&&void 0!==h?h:[],reqArgs:s,headers:i}}}},a=await r[d](e.value);return l.fn.createExecution(a).start()});return{version:d,result:c}}configs(e){let t=Object.values(this.rawFns).reduce((t,r)=>[...t,...r.getConfig({baseUrl:e,appPrefix:this.id})],[]);for(let e of t){let t=_.functionConfigSchema.safeParse(e);if(!t.success){let r=t.error.errors.map(e=>e.message).join("; ");this.log("warn",`Config invalid for function "${e.id}" : ${r}`)}}return t}reqUrl(e){let t=new URL(e),r=this.serveHost||this.env[d.envKeys.InngestServeHost],n=this.servePath||this.env[d.envKeys.InngestServePath];return n&&(t.pathname=n),r&&(t=new URL(t.pathname+t.search,r)),t}registerBody({url:e,deployId:t}){return{url:e.href,deployType:"ping",framework:this.frameworkName,appName:this.id,functions:this.configs(e),sdk:`js:v${w.version}`,v:"0.1",deployId:t||void 0,capabilities:{trust_probe:"v1",connect:"v1"},appVersion:this.client.appVersion}}async inBandRegisterBody({actions:e,deployId:t,env:r,signatureValidation:n,url:s}){let i=this.registerBody({deployId:t,url:s}),a=await this.introspectionBody({actions:e,env:r,signatureValidation:n,url:s}),o={app_id:this.id,appVersion:this.client.appVersion,capabilities:i.capabilities,env:r,framework:i.framework,functions:i.functions,inspection:a,platform:(0,p.getPlatformName)(Object.assign(Object.assign({},(0,p.allProcessEnv)()),this.env)),sdk_author:"inngest",sdk_language:"",sdk_version:"",sdk:i.sdk,url:i.url};return a.authentication_succeeded&&(o.sdk_language=a.sdk_language,o.sdk_version=a.sdk_version),o}async introspectionBody({actions:e,env:t,signatureValidation:r,url:n}){var s,i,a,o,l;let u=this.registerBody({url:this.reqUrl(n),deployId:null});if(!this._mode)throw Error("No mode set; cannot introspect without mode");let d={authentication_succeeded:null,extra:{is_mode_explicit:this._mode.isExplicit},has_event_key:this.client.eventKeySet(),has_signing_key:!!this.signingKey,function_count:u.functions.length,mode:this._mode.type,schema_version:"2024-05-24"};if("cloud"===this._mode.type)try{if(!(await r).success)throw Error("Signature validation failed");d=Object.assign(Object.assign({},d),{authentication_succeeded:!0,api_origin:this.apiBaseUrl,app_id:this.id,capabilities:{trust_probe:"v1",connect:"v1"},env:t,event_api_origin:this.eventApiBaseUrl,event_key_hash:null!==(s=this.hashedEventKey)&&void 0!==s?s:null,extra:Object.assign(Object.assign({},d.extra),{is_streaming:await this.shouldStream(e)}),framework:this.frameworkName,sdk_language:"js",sdk_version:w.version,serve_origin:null!==(i=this.serveHost)&&void 0!==i?i:null,serve_path:null!==(a=this.servePath)&&void 0!==a?a:null,signing_key_fallback_hash:null!==(o=this.hashedSigningKeyFallback)&&void 0!==o?o:null,signing_key_hash:null!==(l=this.hashedSigningKey)&&void 0!==l?l:null})}catch(e){d=Object.assign(Object.assign({},d),{authentication_succeeded:!1})}return d}async register(e,t,r){var n;let s,i,a,o,l;let u=this.registerBody({url:e,deployId:t}),h=new URL(this.inngestRegisterUrl.href);if(this._mode&&this._mode.isInferred&&this._mode.isDev){let e=(0,p.devServerHost)(this.env);await (0,c.devServerAvailable)(e,this.fetch)&&(h=(0,c.devServerUrl)(e,"/fn/register"))}else(null===(n=this._mode)||void 0===n?void 0:n.explicitDevUrl)&&(h=(0,c.devServerUrl)(this._mode.explicitDevUrl.href,"/fn/register"));t&&h.searchParams.set(d.queryKeys.DeployId,t);try{s=await (0,y.fetchWithAuthFallback)({authToken:this.hashedSigningKey,authTokenFallback:this.hashedSigningKeyFallback,fetch:this.fetch,url:h.href,options:{method:"POST",body:(0,b.stringify)(u),headers:Object.assign(Object.assign({},r()),{[d.headerKeys.InngestSyncKind]:d.syncKind.OutOfBand}),redirect:"follow"}})}catch(e){return this.log("error",e),{status:500,message:`Failed to register${e instanceof Error?`; ${e.message}`:""}`,modified:!1}}let f=await s.text(),g={};try{g=JSON.parse(f)}catch(t){this.log("warn","Couldn't unpack register response:",t);let e="Failed to register";return t instanceof Error&&(e+=`; ${t.message}`),{status:500,message:e+=`; status code: ${s.status}`,modified:!1}}try{({status:i,error:a,skipped:o,modified:l}=E.parse(g))}catch(t){this.log("warn","Invalid register response schema:",t);let e="Failed to register";return t instanceof Error&&(e+=`; ${t.message}`),{status:500,message:e+=`; status code: ${s.status}`,modified:!1}}return o||this.log("debug","registered inngest functions:",s.status,s.statusText,g),{status:i,message:a,modified:l}}upsertKeysFromEnv(){this.env[d.envKeys.InngestSigningKey]&&(this.signingKey||(this.signingKey=String(this.env[d.envKeys.InngestSigningKey])),this.client.inngestApi.setSigningKey(this.signingKey)),this.env[d.envKeys.InngestSigningKeyFallback]&&(this.signingKeyFallback||(this.signingKeyFallback=String(this.env[d.envKeys.InngestSigningKeyFallback])),this.client.inngestApi.setSigningKeyFallback(this.signingKeyFallback)),!this.client.eventKeySet()&&this.env[d.envKeys.InngestEventKey]&&this.client.setEventKey(String(this.env[d.envKeys.InngestEventKey])),this.env[d.envKeys.InngestDevServerUrl]&&this.log("warn",`Use of ${d.envKeys.InngestDevServerUrl} has been deprecated in v3; please use ${d.envKeys.InngestBaseUrl} instead. See https://www.inngest.com/docs/sdk/migration`)}async validateSignature(e,t){try{if(this.skipSignatureValidation||this._mode&&!this._mode.isCloud)return{success:!0,keyUsed:""};if(!this.signingKey)throw Error(`No signing key found in client options or ${d.envKeys.InngestSigningKey} env var. Find your keys at https://app.inngest.com/secrets`);if(!e)throw Error(`No ${d.headerKeys.Signature} provided`);return{success:!0,keyUsed:new I(e).verifySignature({body:t,allowExpiredSignatures:this.allowExpiredSignatures,signingKey:this.signingKey,signingKeyFallback:this.signingKeyFallback})}}catch(e){return{success:!1,err:e}}}getResponseSignature(e,t){let r=Date.now(),n=(0,y.signDataWithKey)(t,e,r.toString());return`t=${r}&s=${n}`}log(e,...t){let r=["debug","info","warn","error","fatal","silent"],n=r.indexOf(this.logLevel);if(r.indexOf(e)>=n){let r=console.log;Object.prototype.hasOwnProperty.call(console,e)&&(r=console[e]),r(`${d.logPrefix} ${e} -`,...t)}}}t.InngestCommHandler=S;class I{constructor(e){n.add(this);let t=new URLSearchParams(e);if(this.timestamp=t.get("t")||"",this.signature=t.get("s")||"",!this.timestamp||!this.signature)throw Error(`Invalid ${d.headerKeys.Signature} provided`)}hasExpired(e){return!e&&Date.now()-new Date(1e3*parseInt(this.timestamp)).valueOf()>3e5}verifySignature({body:e,signingKey:t,signingKeyFallback:r,allowExpiredSignatures:a}){try{return i(this,n,"m",s).call(this,{body:e,signingKey:t,allowExpiredSignatures:a}),t}catch(t){if(!r)throw t;return i(this,n,"m",s).call(this,{body:e,signingKey:r,allowExpiredSignatures:a}),r}}}n=new WeakSet,s=function({body:e,signingKey:t,allowExpiredSignatures:r}){if(this.hasExpired(r))throw Error("Signature has expired");if((0,y.signDataWithKey)(e,t,this.timestamp)!==this.signature)throw Error("Invalid signature")}},17410:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InngestFunction=void 0;let n=r(84728),s=r(59121),i=r(95486),a=r(68595),o=r(79379),l=r(8086);class u{constructor(e,t,r){this.client=e,this.opts=t,this.fn=r,this.onFailureFn=this.opts.onFailure,this.middleware=this.client.initializeMiddleware(this.opts.middleware,{registerInput:{fn:this},prefixStack:this.client.middleware})}id(e){return[e,this.opts.id].filter(Boolean).join("-")}get absoluteId(){return this.id(this.client.id)}get name(){return this.opts.name||this.id()}get description(){return this.opts.description}getConfig({baseUrl:e,appPrefix:t,isConnect:r}){var i,a;let o=this.id(t),l=new URL(e.href);l.searchParams.set(n.queryKeys.FnId,o),l.searchParams.set(n.queryKeys.StepId,u.stepId);let{retries:d,cancelOn:c,idempotency:h,batchEvents:p,rateLimit:f,throttle:g,concurrency:y,debounce:m,timeouts:v,priority:b,singleton:_}=this.opts,w={id:o,name:this.name,triggers:(null!==(i=this.opts.triggers)&&void 0!==i?i:[]).map(e=>"event"in e?{event:e.event,expression:e.if}:{cron:e.cron}),steps:{[u.stepId]:{id:u.stepId,name:u.stepId,runtime:{type:r?"ws":"http",url:l.href},retries:void 0===d?void 0:{attempts:d}}},idempotency:h,batchEvents:p,rateLimit:f,throttle:g,concurrency:y,debounce:m,priority:b,timeouts:v,singleton:_};c&&(w.cancel=c.map(({event:e,timeout:t,if:r,match:n})=>{let i={event:e};return t&&(i.timeout=(0,s.timeStr)(t)),n?i.if=`event.${n} == async.${n}`:r&&(i.if=r),i},[]));let O=[w];if(this.onFailureFn){let e=`${w.id}${u.failureSuffix}`,t=`${null!==(a=w.name)&&void 0!==a?a:w.id} (failure)`,r=new URL(l.href);r.searchParams.set(n.queryKeys.FnId,e),O.push({id:e,name:t,triggers:[{event:n.internalEvents.FunctionFailed,expression:`event.data.function_id == '${o}'`}],steps:{[u.stepId]:{id:u.stepId,name:u.stepId,runtime:{type:"http",url:r.href},retries:{attempts:1}}}})}return O}createExecution(e){let t=Object.assign({fn:this},e.partialOptions);return({[i.ExecutionVersion.V2]:()=>(0,l.createV2InngestExecution)(t),[i.ExecutionVersion.V1]:()=>(0,o.createV1InngestExecution)(t),[i.ExecutionVersion.V0]:()=>(0,a.createV0InngestExecution)(t)})[e.version]()}shouldOptimizeParallelism(){var e,t;return null!==(t=null!==(e=this.opts.optimizeParallelism)&&void 0!==e?e:this.client.options.optimizeParallelism)&&void 0!==t&&t}}t.InngestFunction=u,u.stepId="step",u.failureSuffix="-failure"},80602:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.referenceFunction=t.InngestFunctionReference=void 0;class r{constructor(e){this.opts=e}}t.InngestFunctionReference=r,t.referenceFunction=({functionId:e,appId:t})=>new r({functionId:e,appId:t})},76206:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHookStack=t.InngestMiddleware=void 0;let n=r(31511);class s{constructor({name:e,init:t}){this.name=e,this.init=t}}t.InngestMiddleware=s;let i=async(e,t,r,s)=>{let i=(await e).reduce((e,r)=>{let n=r[t];return n?[...e,n]:e},[]),a=await i.reduce(async(e,t)=>[...await e,await t(r)],Promise.resolve([])),o={};for(let e of a)for(let t of Object.keys(e)){let r=[e[t]],i=o[t];i&&(r=[i,e[t]]);let a=s[t];o[t]=(0,n.waterfall)(r,a)}for(let e of Object.keys(o))o[e]=(0,n.cacheFn)(o[e]);return o};t.getHookStack=i},24968:function(e,t,r){"use strict";var n,s=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),a=0;a<r.length;a++)"default"!==r[a]&&s(t,e,r[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.invokePayloadSchema=t.gatewaySymbol=t.createStepTools=t.STEP_INDEXING_SUFFIX=t.getStepOptions=void 0;let o=r(98395),l=r(27353),u=r(84728),d=r(59121),c=a(r(51447)),h=r(34557),p=r(97177),f=r(17410),g=r(80602);t.getStepOptions=e=>"string"==typeof e?{id:e}:e,t.STEP_INDEXING_SUFFIX=":",t.createStepTools=(e,r,n)=>{let s=(e,t)=>async(...r)=>n({args:r,matchOp:e,opts:t}),i=e=>s(({id:t,name:r},n,...s)=>{let i=Object.assign(Object.assign({},s.length?{input:s}:{}),e?{type:e}:{});return Object.assign({id:t,op:h.StepOpCode.StepPlanned,name:t,displayName:null!=r?r:t},Object.keys(i).length?{opts:i}:{})},{fn:(e,t,...r)=>t(...r)}),a={sendEvent:s(({id:e,name:t})=>({id:e,op:h.StepOpCode.StepPlanned,name:"sendEvent",displayName:null!=t?t:e}),{fn:(t,n)=>e._send({payload:n,headers:r.options.headers})}),waitForSignal:s(({id:e,name:t},r)=>({id:e,op:h.StepOpCode.WaitForSignal,name:r.signal,displayName:null!=t?t:e,opts:{signal:r.signal,timeout:(0,d.timeStr)(r.timeout),conflict:r.onConflict}})),sendSignal:s(({id:e,name:t},r)=>({id:e,op:h.StepOpCode.StepPlanned,name:"sendSignal",displayName:null!=t?t:e,opts:{type:"step.sendSignal",signal:r.signal}}),{fn:(t,n)=>e._sendSignal({signal:n.signal,data:n.data,headers:r.options.headers})}),waitForEvent:s(({id:e,name:t},r)=>{let n={timeout:(0,d.timeStr)("string"==typeof r?r:r.timeout)};return"string"!=typeof r&&((null==r?void 0:r.match)?n.if=`event.${r.match} == async.${r.match}`:(null==r?void 0:r.if)&&(n.if=r.if)),{id:e,op:h.StepOpCode.WaitForEvent,name:r.event,opts:n,displayName:null!=t?t:e}}),run:i(),ai:{infer:s(({id:e,name:t},r)=>{var n,s;let i=Object.assign({},r.model);return null===(s=(n=r.model).onCall)||void 0===s||s.call(n,i,r.body),{id:e,op:h.StepOpCode.AiGateway,displayName:null!=t?t:e,opts:{type:"step.ai.infer",url:i.url,headers:i.headers,auth_key:i.authKey,format:i.format,body:r.body}}}),wrap:i("step.ai.wrap"),models:Object.assign({},o.models)},sleep:s(({id:e,name:t},r)=>{let n=(0,d.timeStr)(c.isTemporalDuration(r)?r.total({unit:"milliseconds"}):r);return{id:e,op:h.StepOpCode.Sleep,name:n,displayName:null!=t?t:e}}),sleepUntil:s(({id:e,name:t},r)=>{try{let n=c.getISOString(r);return{id:e,op:h.StepOpCode.Sleep,name:n,displayName:null!=t?t:e}}catch(e){throw console.warn("Invalid `Date`, date string, `Temporal.Instant`, or `Temporal.ZonedDateTime` passed to sleepUntil;",e),Error(`Invalid \`Date\`, date string, \`Temporal.Instant\`, or \`Temporal.ZonedDateTime\` passed to sleepUntil: ${r}`)}}),invoke:s(({id:r,name:n},s)=>{let i=t.invokePayloadSchema.extend({timeout:l.z.union([l.z.number(),l.z.string(),l.z.date()]).optional()}),a=i.extend({_type:l.z.literal("fullId").optional().default("fullId"),function:l.z.string().min(1)}).or(i.extend({_type:l.z.literal("fnInstance").optional().default("fnInstance"),function:l.z.instanceof(f.InngestFunction)})).or(i.extend({_type:l.z.literal("refInstance").optional().default("refInstance"),function:l.z.instanceof(g.InngestFunctionReference)})).safeParse(s);if(!a.success)throw Error("Invalid invocation options passed to invoke; must include either a function or functionId.");let{_type:o,function:c,data:p,user:y,v:m,timeout:v}=a.data,b={payload:{data:p,user:y,v:m},function_id:"",timeout:void 0===v?void 0:(0,d.timeStr)(v)};switch(o){case"fnInstance":b.function_id=c.id(c.client.id);break;case"fullId":console.warn(`${u.logPrefix} Invoking function with \`function: string\` is deprecated and will be removed in v4.0.0; use an imported function or \`referenceFunction()\` instead. See https://innge.st/ts-referencing-functions`),b.function_id=c;break;case"refInstance":b.function_id=[c.opts.appId||e.id,c.opts.functionId].filter(Boolean).join("-")}return{id:r,op:h.StepOpCode.InvokeFunction,displayName:null!=n?n:r,opts:b}}),fetch:p.fetch};return a[t.gatewaySymbol]=s(({id:e,name:t},r,n)=>{var s;let i=r instanceof Request?r.url:r.toString(),a={};return r instanceof Request?r.headers.forEach((e,t)=>a[t]=e):(null==n?void 0:n.headers)&&new Headers(n.headers).forEach((e,t)=>a[t]=e),{id:e,op:h.StepOpCode.Gateway,displayName:null!=t?t:e,opts:{url:i,method:null!==(s=null==n?void 0:n.method)&&void 0!==s?s:"GET",headers:a,body:null==n?void 0:n.body}}}),a},t.gatewaySymbol=Symbol.for("inngest.step.gateway"),t.invokePayloadSchema=l.z.object({data:l.z.record(l.z.any()).optional(),user:l.z.record(l.z.any()).optional(),v:l.z.string().optional()})},80983:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NonRetriableError=void 0;class r extends Error{constructor(e,t){super(e),this.cause=null==t?void 0:t.cause,this.name="NonRetriableError"}}t.NonRetriableError=r},33472:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RetryAfterError=void 0;let s=n(r(48939));class i extends Error{constructor(e,t,r){if(super(e),t instanceof Date)this.retryAfter=t.toISOString();else{let e=`${Math.ceil(("string"==typeof t?(0,s.default)(t):t)/1e3)}`;if(!isFinite(Number(e)))throw Error("retryAfter must be a number of milliseconds, a ms-compatible string, or a Date");this.retryAfter=e}this.cause=null==r?void 0:r.cause}}t.RetryAfterError=i},89912:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StepError=void 0;let n=r(31861),s=r(34557);class i extends Error{constructor(e,t){var r;let i=s.jsonErrorSchema.parse(t);super(i.message),this.stepId=e,this.name=i.name,this.stepId=e,this.stack=null!==(r=i.stack)&&void 0!==r?r:void 0,this.cause=i.cause?(0,n.deserializeError)(i.cause,!0):void 0}}t.StepError=i},95486:function(e,t,r){"use strict";var n,s,i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InngestExecution=t.PREFERRED_EXECUTION_VERSION=t.ExecutionVersion=void 0;let a=i(r(57034)),o=r(84728);(n=s||(t.ExecutionVersion=s={}))[n.V0=0]="V0",n[n.V1=1]="V1",n[n.V2=2]="V2",t.PREFERRED_EXECUTION_VERSION=s.V1;class l{constructor(e){this.options=e,this.debug=(0,a.default)(`${o.debugPrefix}:${this.options.runId}`)}}t.InngestExecution=l},98340:function(e,t,r){"use strict";var n,s=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),a=0;a<r.length;a++)"default"!==r[a]&&s(t,e,r[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.getAsyncLocalStorage=t.getAsyncCtx=void 0;let o=Symbol.for("inngest:als"),l=async()=>(0,t.getAsyncLocalStorage)().then(e=>e.getStore());t.getAsyncCtx=l;let u=async()=>{var e,t;return null!==(e=(t=globalThis)[o])&&void 0!==e||(t[o]=new Promise(async e=>{try{let{AsyncLocalStorage:t}=await Promise.resolve().then(()=>a(r(92761)));e(new t)}catch(t){console.warn("node:async_hooks is not supported in this runtime. Experimental async context is disabled."),e({getStore:()=>void 0,run:(e,t)=>t()})}})),globalThis[o]};t.getAsyncLocalStorage=u},5380:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clientProcessorMap=void 0,t.clientProcessorMap=new WeakMap},68595:function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)0>t.indexOf(n[s])&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t._internals=t.V0InngestExecution=t.createV0InngestExecution=void 0;let i=s(r(8075)),a=r(18566),o=r(27353),l=r(31861),u=r(31511),d=r(82576),c=r(34557),h=r(76206),p=r(24968),f=r(80983),g=r(33472),y=r(95486);t.createV0InngestExecution=e=>new m(e);class m extends y.InngestExecution{constructor(e){super(e),this.userFnToRun=this.getUserFnToRun(),this.state=this.createExecutionState(),this.fnArg=this.createFnArg()}start(){var e;return this.debug("starting V0 execution"),null!==(e=this.execution)&&void 0!==e?e:this.execution=this._start().then(e=>(this.debug("result:",e),e))}async _start(){var e,t,r,s,i,a,o,u,h,p,g,y,m,b,_,w,O,E,S,I,x,k;this.state.hooks=await this.initializeMiddleware();try{await this.transformInput(),await (null===(t=(e=this.state.hooks).beforeMemoization)||void 0===t?void 0:t.call(e)),0!==this.state.opStack.length||this.options.requestedRunStep||(await (null===(s=(r=this.state.hooks).afterMemoization)||void 0===s?void 0:s.call(r)),await (null===(a=(i=this.state.hooks).beforeExecution)||void 0===a?void 0:a.call(i)));let x=(0,d.runAsPromise)(()=>this.userFnToRun(this.fnArg)),k=-1;do{if(k>=0){this.options.requestedRunStep||k!==this.state.opStack.length-1||(await (null===(u=(o=this.state.hooks).afterMemoization)||void 0===u?void 0:u.call(o)),await (null===(p=(h=this.state.hooks).beforeExecution)||void 0===p?void 0:p.call(h))),this.state.tickOps={};let e=this.state.opStack[k];if(this.state.currentOp=this.state.allFoundOps[e.id],!this.state.currentOp)throw new f.NonRetriableError((0,l.prettyError)({whatHappened:" Your function was stopped from running",why:"We couldn't resume your function's state because it may have changed since the run started or there are async actions in-between steps that we haven't noticed in previous executions.",consequences:"Continuing to run the function may result in unexpected behaviour, so we've stopped your function to ensure nothing unexpected happened!",toFixNow:"Ensure that your function is either entirely step-based or entirely non-step-based, by either wrapping all asynchronous logic in `step.run()` calls or by removing all `step.*()` calls.",otherwise:"For more information on why step functions work in this manner, see https://www.inngest.com/docs/functions/multi-step#gotchas",stack:!0,code:l.ErrCode.NON_DETERMINISTIC_FUNCTION}));this.state.currentOp.fulfilled=!0,void 0!==e.data?this.state.currentOp.resolve(e.data):this.state.currentOp.reject(e.error)}await (0,d.resolveAfterPending)(),this.state.reset(),k++}while(k<this.state.opStack.length);await (null===(y=(g=this.state.hooks).afterMemoization)||void 0===y?void 0:y.call(g));let j=Object.values(this.state.tickOps).map(v),C=this.options.requestedRunStep||this.getEarlyExecRunStep(j);if(C){let e=this.state.allFoundOps[C],t=null==e?void 0:e.fn;if(!t)throw Error(`Bad stack; executor requesting to run unknown step "${C}"`);let r=Object.assign(Object.assign({},v(e)),{op:c.StepOpCode.Step});await (null===(b=(m=this.state.hooks).beforeExecution)||void 0===b?void 0:b.call(m)),this.state.executingStep=!0;let s=await (0,d.runAsPromise)(t).finally(()=>{this.state.executingStep=!1}).catch(async e=>await this.transformOutput({error:e},r)).then(async e=>{var t,n;return await (null===(n=null===(t=this.state.hooks)||void 0===t?void 0:t.afterExecution)||void 0===n?void 0:n.call(t)),await this.transformOutput({data:e},r)}),{type:i}=s,a=n(s,["type"]);return{type:"step-ran",ctx:this.fnArg,ops:this.ops,step:Object.assign(Object.assign({},r),a)}}if(!j.length){let e=await Promise.race([x.then(e=>({type:"complete",data:e})),(0,d.resolveNextTick)().then(()=>({type:"incomplete"}))]);if("complete"===e.type){if(await (null===(w=(_=this.state.hooks).afterExecution)||void 0===w?void 0:w.call(_)),Object.values(this.state.allFoundOps).every(e=>e.fulfilled))return await this.transformOutput({data:e.data})}else if(this.state.hasUsedTools){if(!Object.values(this.state.allFoundOps).some(e=>!1===e.fulfilled))throw new f.NonRetriableError((0,l.functionStoppedRunningErr)(l.ErrCode.ASYNC_DETECTED_AFTER_MEMOIZATION))}else{this.state.nonStepFnDetected=!0;let e=await x;return await (null===(E=(O=this.state.hooks).afterExecution)||void 0===E?void 0:E.call(O)),await this.transformOutput({data:e})}}return await (null===(I=(S=this.state.hooks).afterExecution)||void 0===I?void 0:I.call(S)),{type:"steps-found",ctx:this.fnArg,ops:this.ops,steps:j}}catch(e){return await this.transformOutput({error:e})}finally{await (null===(k=(x=this.state.hooks).beforeResponse)||void 0===k?void 0:k.call(x))}}async initializeMiddleware(){let e=this.options.data;return await (0,h.getHookStack)(this.options.fn.middleware,"onFunctionRun",{ctx:e,fn:this.options.fn,steps:Object.values(this.options.stepState),reqArgs:this.options.reqArgs},{transformInput:(e,t)=>({ctx:Object.assign(Object.assign({},e.ctx),null==t?void 0:t.ctx),fn:this.options.fn,steps:e.steps.map((e,r)=>{var n;return Object.assign(Object.assign({},e),null===(n=null==t?void 0:t.steps)||void 0===n?void 0:n[r])}),reqArgs:e.reqArgs}),transformOutput:(e,t)=>({result:Object.assign(Object.assign({},e.result),null==t?void 0:t.result),step:e.step})})}createExecutionState(){let e={allFoundOps:{},tickOps:{},tickOpHashes:{},currentOp:void 0,hasUsedTools:!1,reset:()=>{e.tickOpHashes={},e.allFoundOps=Object.assign(Object.assign({},e.allFoundOps),e.tickOps)},nonStepFnDetected:!1,executingStep:!1,opStack:this.options.stepCompletionOrder.reduce((e,t)=>{let r=this.options.stepState[t];return r?[...e,r]:e},[])};return e}get ops(){return Object.fromEntries(Object.entries(this.state.allFoundOps).map(([e,t])=>[e,{id:t.id,rawArgs:t.rawArgs,data:t.data,error:t.error,fulfilled:t.fulfilled,seen:!0}]))}getUserFnToRun(){if(!this.options.isFailureHandler)return this.options.fn.fn;if(!this.options.fn.onFailureFn)throw Error("Cannot find function `onFailure` handler");return this.options.fn.onFailureFn}createFnArg(){var e,r,n,s;this.state.tickOps=this.state.allFoundOps;let i=e=>{var r,n,s,i;let a={parent:null!==(n=null===(r=this.state.currentOp)||void 0===r?void 0:r.id)&&void 0!==n?n:null,op:e.op,name:e.name,opts:e.op===c.StepOpCode.StepPlanned?null:null!==(s=e.opts)&&void 0!==s?s:null},o=t._internals.hashData(a),l=this.state.tickOpHashes[o]=(null!==(i=this.state.tickOpHashes[o])&&void 0!==i?i:-1)+1;return Object.assign(Object.assign({},e),{id:t._internals.hashData(Object.assign({pos:l},a))})},a=(0,p.createStepTools)(this.options.client,this,({args:e,matchOp:t,opts:r})=>{if(this.state.nonStepFnDetected)throw new f.NonRetriableError((0,l.functionStoppedRunningErr)(l.ErrCode.STEP_USED_AFTER_ASYNC));if(this.state.executingStep)throw new f.NonRetriableError((0,l.prettyError)({whatHappened:"Your function was stopped from running",why:"We detected that you have nested `step.*` tooling.",consequences:"Nesting `step.*` tooling is not supported.",stack:!0,toFixNow:"Make sure you're not using `step.*` tooling inside of other `step.*` tooling. If you need to compose steps together, you can create a new async function and call it from within your step function, or use promise chaining.",otherwise:"For more information on step functions with Inngest, see https://www.inngest.com/docs/functions/multi-step",code:l.ErrCode.NESTING_STEPS}));this.state.hasUsedTools=!0;let n=i(t((0,p.getStepOptions)(e[0]),...e.slice(1)));return new Promise((t,s)=>{this.state.tickOps[n.id]=Object.assign(Object.assign(Object.assign({},n),(null==r?void 0:r.fn)?{fn:()=>{var t;return null===(t=r.fn)||void 0===t?void 0:t.call(r,...e)}}:{}),{rawArgs:e,resolve:t,reject:s,fulfilled:!1})})}),u=Object.assign(Object.assign({},this.options.data),{step:a});if(this.options.isFailureHandler){let t=o.z.object({error:c.jsonErrorSchema}).parse(null===(e=u.event)||void 0===e?void 0:e.data);u=Object.assign(Object.assign({},u),{error:(0,l.deserializeError)(t.error)})}return null!==(s=null===(n=(r=this.options).transformCtx)||void 0===n?void 0:n.call(r,u))&&void 0!==s?s:u}async transformInput(){var e,t;let r=await (null===(t=null===(e=this.state.hooks)||void 0===e?void 0:e.transformInput)||void 0===t?void 0:t.call(e,{ctx:Object.assign({},this.fnArg),steps:Object.values(this.options.stepState),fn:this.options.fn,reqArgs:this.options.reqArgs}));(null==r?void 0:r.ctx)&&(this.fnArg=r.ctx),(null==r?void 0:r.steps)&&(this.state.opStack=[...r.steps])}getEarlyExecRunStep(e){if(1!==e.length)return;let t=e[0];if(t&&t.op===c.StepOpCode.StepPlanned)return t.id}async transformOutput(e,t){var r,n,s,i;let a=Object.assign({},e);void 0!==a.error&&(a.data=(0,l.serializeError)(a.error));let o=await (null===(n=null===(r=this.state.hooks)||void 0===r?void 0:r.transformOutput)||void 0===n?void 0:n.call(r,{result:Object.assign({},a),step:t})),{data:d,error:c}=Object.assign(Object.assign({},a),null==o?void 0:o.result);if(t||await (null===(i=null===(s=this.state.hooks)||void 0===s?void 0:s.finished)||void 0===i?void 0:i.call(s,{result:Object.assign({},void 0!==c?{error:c}:{data:d})})),void 0!==c){let e=!(c instanceof f.NonRetriableError);e&&c instanceof g.RetryAfterError&&(e=c.retryAfter);let t=(0,l.serializeError)(c);return{type:"function-rejected",ctx:this.fnArg,ops:this.ops,error:t,retriable:e}}return{type:"function-resolved",ctx:this.fnArg,ops:this.ops,data:(0,u.undefinedToNull)(d)}}}t.V0InngestExecution=m;let v=e=>({op:e.op,id:e.id,name:e.name,opts:e.opts});t._internals={hashData:e=>(0,a.sha1)().update((0,i.default)(e)).digest("hex")}},79379:function(e,t,r){"use strict";var n=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,s){(function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)})(n,s,(t=e[r](t)).done,t.value)})}}},s=this&&this.__await||function(e){return this instanceof s?(this.v=e,this):new s(e)},i=this&&this.__asyncGenerator||function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),a=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,d)}}),n[Symbol.asyncIterator]=function(){return this},n;function o(e,t){i[e]&&(n[e]=function(t){return new Promise(function(r,n){a.push([e,t,r,n])>1||l(e,t)})},t&&(n[e]=t(n[e])))}function l(e,t){try{var r;(r=i[e](t)).value instanceof s?Promise.resolve(r.value.v).then(u,d):c(a[0][2],r)}catch(e){c(a[0][3],e)}}function u(e){l("next",e)}function d(e){l("throw",e)}function c(e,t){e(t),a.shift(),a.length&&l(a[0][0],a[0][1])}};Object.defineProperty(t,"__esModule",{value:!0}),t._internals=t.createV1InngestExecution=void 0;let a=r(16002),o=r(18566),l=r(27353),u=r(84728),d=r(31861),c=r(31511),h=r(82576),p=r(34557),f=r(4711),g=r(76206),y=r(24968),m=r(80983),v=r(33472),b=r(89912),_=r(95486),w=r(98340),O=r(5380);t.createV1InngestExecution=e=>new E(e);class E extends _.InngestExecution{constructor(e){super(e),this.timeoutDuration=1e4,this.userFnToRun=this.getUserFnToRun(),this.state=this.createExecutionState(),this.fnArg=this.createFnArg(),this.checkpointHandlers=this.createCheckpointHandlers(),this.initializeTimer(this.state),this.debug("created new V1 execution for run;",this.options.requestedRunStep?`wanting to run step "${this.options.requestedRunStep}"`:"discovering steps"),this.debug("existing state keys:",Object.keys(this.state.stepState))}start(){if(!this.execution){this.debug("starting V1 execution");let e=a.trace.getTracer("inngest",f.version);this.execution=(0,w.getAsyncLocalStorage)().then(t=>t.run({app:this.options.client,ctx:this.fnArg},async()=>e.startActiveSpan("inngest.execution",e=>{var t;return null===(t=O.clientProcessorMap.get(this.options.client))||void 0===t||t.declareStartingSpan({span:e,runId:this.options.runId,traceparent:this.options.headers[u.headerKeys.TraceParent],tracestate:this.options.headers[u.headerKeys.TraceState]}),this._start().then(e=>(this.debug("result:",e),e)).finally(()=>{e.end()})})))}return this.execution}async _start(){try{let d=this.getCheckpointHandler("");this.state.hooks=await this.initializeMiddleware(),await this.startExecution();try{for(var e,t,r,s,i,a,o,l=!0,u=n(this.state.loop);!(e=(o=await u.next()).done);l=!0){s=o.value,l=!1,await d(s);let e=this.getCheckpointHandler(s.type),t=await e(s);if(t)return t}}catch(e){t={error:e}}finally{try{!l&&!e&&(r=u.return)&&await r.call(u)}finally{if(t)throw t.error}}}catch(e){return await this.transformOutput({error:e})}finally{this.state.loop.return(),await (null===(a=null===(i=this.state.hooks)||void 0===i?void 0:i.beforeResponse)||void 0===a?void 0:a.call(i))}throw Error("Core loop finished without returning a value")}createCheckpointHandlers(){return{"":e=>{this.debug("checkpoint:",e)},"function-resolved":async e=>await this.transformOutput({data:e.data}),"function-rejected":async e=>await this.transformOutput({error:e.error}),"steps-found":async({steps:e})=>{let r=await this.tryExecuteStep(e);if(r){let e=await this.transformOutput(r);return"function-resolved"===e.type?{type:"step-ran",ctx:e.ctx,ops:e.ops,step:t._internals.hashOp(Object.assign(Object.assign({},r),{data:e.data}))}:"function-rejected"===e.type?{type:"step-ran",ctx:e.ctx,ops:e.ops,step:t._internals.hashOp(Object.assign(Object.assign({},r),{error:e.error})),retriable:e.retriable}:e}let n=await this.filterNewSteps(Array.from(this.state.steps.values()));if(n)return{type:"steps-found",ctx:this.fnArg,ops:this.ops,steps:n}},"step-not-found":({step:e})=>({type:"step-not-found",ctx:this.fnArg,ops:this.ops,step:e})}}getCheckpointHandler(e){return this.checkpointHandlers[e]}async tryExecuteStep(e){var t;let r=this.options.requestedRunStep||this.getEarlyExecRunStep(e);if(!r)return;let n=e.find(e=>e.hashedId===r&&e.fn);if(n)return await this.executeStep(n);null===(t=this.timeout)||void 0===t||t.reset()}getEarlyExecRunStep(e){if(this.options.disableImmediateExecution)return;let t=e.filter(e=>!e.fulfilled);if(1!==t.length)return;let r=t[0];if(r&&r.op===p.StepOpCode.StepPlanned)return r.hashedId}async filterNewSteps(e){var t,r,n,s,i,a;if(this.options.requestedRunStep)return;let o=e.filter(e=>!e.fulfilled);if(!o.length)return;let l=0;for(let t of e)t.fulfilled&&l++;this.state.stepsToFulfill!==l&&console.warn((0,d.prettyError)({type:"warn",whatHappened:"Function may be indeterminate",why:"We found new steps before seeing all previous steps, which may indicate that the function is non-deterministic.",consequences:"This may cause unexpected behaviour as Inngest executes your function.",reassurance:"This is expected if a function is updated in the middle of a run, but may indicate a bug if not."})),await (null===(r=null===(t=this.state.hooks)||void 0===t?void 0:t.afterMemoization)||void 0===r?void 0:r.call(t)),await (null===(s=null===(n=this.state.hooks)||void 0===n?void 0:n.beforeExecution)||void 0===s?void 0:s.call(n)),await (null===(a=null===(i=this.state.hooks)||void 0===i?void 0:i.afterExecution)||void 0===a?void 0:a.call(i));let u=o.map(e=>({displayName:e.displayName,op:e.op,id:e.hashedId,name:e.name,opts:e.opts}));return await this.transformNewSteps(u)}async transformNewSteps(e){return Promise.all(e.map(async e=>{var t,r,n,s,i,a,o;if(e.op!==p.StepOpCode.InvokeFunction)return e;let l=await (0,g.getHookStack)(this.options.fn.middleware,"onSendEvent",void 0,{transformInput:(e,t)=>Object.assign(Object.assign({},e),t),transformOutput:(e,t)=>({result:Object.assign(Object.assign({},e.result),null==t?void 0:t.result)})}),d=await (null===(t=l.transformInput)||void 0===t?void 0:t.call(l,{payloads:[Object.assign(Object.assign({},null!==(n=null===(r=e.opts)||void 0===r?void 0:r.payload)&&void 0!==n?n:{}),{name:u.internalEvents.FunctionInvoked})]})),c=y.invokePayloadSchema.parse(null!==(i=null===(s=null==d?void 0:d.payloads)||void 0===s?void 0:s[0])&&void 0!==i?i:{});return Object.assign(Object.assign({},e),{opts:Object.assign(Object.assign({},e.opts),{payload:Object.assign(Object.assign({},null!==(o=null===(a=e.opts)||void 0===a?void 0:a.payload)&&void 0!==o?o:{}),c)})})}))}async executeStep({id:e,name:t,opts:r,fn:n,displayName:s}){var i,a,o,l,u;null===(i=this.timeout)||void 0===i||i.clear(),await (null===(o=null===(a=this.state.hooks)||void 0===a?void 0:a.afterMemoization)||void 0===o?void 0:o.call(a)),await (null===(u=null===(l=this.state.hooks)||void 0===l?void 0:l.beforeExecution)||void 0===u?void 0:u.call(l));let d={id:e,op:p.StepOpCode.StepRun,name:t,opts:r,displayName:s};this.state.executingStep=d;let c=await (0,w.getAsyncCtx)();return c&&(c.executingStep={id:e,name:s}),this.debug(`executing step "${e}"`),(0,h.runAsPromise)(n).finally(async()=>{var e,t;c&&delete c.executingStep,await (null===(t=null===(e=this.state.hooks)||void 0===e?void 0:e.afterExecution)||void 0===t?void 0:t.call(e))}).then(e=>Object.assign(Object.assign({},d),{data:e})).catch(e=>Object.assign(Object.assign({},d),{op:p.StepOpCode.StepError,error:e}))}async startExecution(){var e,t,r,n,s,i,a;await this.transformInput(),null===(e=this.timeout)||void 0===e||e.start(),await (null===(r=null===(t=this.state.hooks)||void 0===t?void 0:t.beforeMemoization)||void 0===r?void 0:r.call(t)),this.state.allStateUsed()&&(await (null===(s=null===(n=this.state.hooks)||void 0===n?void 0:n.afterMemoization)||void 0===s?void 0:s.call(n)),await (null===(a=null===(i=this.state.hooks)||void 0===i?void 0:i.beforeExecution)||void 0===a?void 0:a.call(i))),(0,h.runAsPromise)(()=>this.userFnToRun(this.fnArg)).finally(async()=>{var e,t,r,n,s,i;await (null===(t=null===(e=this.state.hooks)||void 0===e?void 0:e.afterMemoization)||void 0===t?void 0:t.call(e)),await (null===(n=null===(r=this.state.hooks)||void 0===r?void 0:r.beforeExecution)||void 0===n?void 0:n.call(r)),await (null===(i=null===(s=this.state.hooks)||void 0===s?void 0:s.afterExecution)||void 0===i?void 0:i.call(s))}).then(e=>{this.state.setCheckpoint({type:"function-resolved",data:e})}).catch(e=>{this.state.setCheckpoint({type:"function-rejected",error:e})})}async transformInput(){var e,t;let r=await (null===(t=null===(e=this.state.hooks)||void 0===e?void 0:e.transformInput)||void 0===t?void 0:t.call(e,{ctx:Object.assign({},this.fnArg),steps:Object.values(this.state.stepState),fn:this.options.fn,reqArgs:this.options.reqArgs}));(null==r?void 0:r.ctx)&&(this.fnArg=r.ctx),(null==r?void 0:r.steps)&&(this.state.stepState=Object.fromEntries(r.steps.map(e=>[e.id,e])))}async transformOutput(e){var t,r,n,s;let i=Object.assign({},e);void 0!==i.error&&(i.data=(0,d.serializeError)(i.error));let a=!!this.state.executingStep,o=await (null===(r=null===(t=this.state.hooks)||void 0===t?void 0:t.transformOutput)||void 0===r?void 0:r.call(t,{result:Object.assign({},i),step:this.state.executingStep})),{data:l,error:u}=Object.assign(Object.assign({},i),null==o?void 0:o.result);if(a||await (null===(s=null===(n=this.state.hooks)||void 0===n?void 0:n.finished)||void 0===s?void 0:s.call(n,{result:Object.assign({},void 0!==u?{error:u}:{data:l})})),void 0!==u){let e=!(u instanceof m.NonRetriableError||u instanceof b.StepError);e&&u instanceof v.RetryAfterError&&(e=u.retryAfter);let t=(0,d.minifyPrettyError)((0,d.serializeError)(u));return{type:"function-rejected",ctx:this.fnArg,ops:this.ops,error:t,retriable:e}}return{type:"function-resolved",ctx:this.fnArg,ops:this.ops,data:(0,c.undefinedToNull)(l)}}createExecutionState(){let e=(0,h.createDeferredPromiseWithStack)(),t=e.deferred.resolve,r=e.results,n=function(e){return i(this,arguments,function*(){try{for(;;){let e=(yield s(r.next())).value;e&&(yield yield s(e))}}finally{null==e||e()}})}(()=>{var e;null===(e=this.timeout)||void 0===e||e.clear(),r.return()}),a=Object.keys(this.options.stepState).length;return{stepState:this.options.stepState,stepsToFulfill:a,steps:new Map,loop:n,hasSteps:!!a,stepCompletionOrder:[...this.options.stepCompletionOrder],remainingStepsToBeSeen:new Set(this.options.stepCompletionOrder),setCheckpoint:e=>{({resolve:t}=t(e))},allStateUsed:()=>0===this.state.remainingStepsToBeSeen.size}}get ops(){return Object.fromEntries(this.state.steps)}createFnArg(){var e,t,r,n;let s=this.createStepTools(),i=Object.assign(Object.assign({},this.options.data),{step:s});if(this.options.isFailureHandler){let t=l.z.object({error:p.jsonErrorSchema}).parse(null===(e=i.event)||void 0===e?void 0:e.data);i=Object.assign(Object.assign({},i),{error:(0,d.deserializeError)(t.error)})}return null!==(n=null===(r=(t=this.options).transformCtx)||void 0===r?void 0:r.call(t,i))&&void 0!==n?n:i}createStepTools(){let e,r;let n=new Map,s=new Map,i=new Map,a=this.state.stepCompletionOrder.slice(),o=!1,l=0,u=e=>{!o&&this.state.steps.has(e)&&!n.has(e)&&(o=!0,console.warn((0,d.prettyError)({type:"warn",whatHappened:"We detected that you have multiple steps with the same ID.",code:d.ErrCode.AUTOMATIC_PARALLEL_INDEXING,why:`This can happen if you're using the same ID for multiple steps across different chains of parallel work. We found the issue with step "${e}".`,reassurance:"Your function is still running, though it may exhibit unexpected behaviour.",consequences:"Using the same IDs across parallel chains of work can cause unexpected behaviour.",toFixNow:"We recommend using a unique ID for each step, especially those happening in parallel."})))},c=()=>{let t;e||(++l>=10?(l=0,t=new Promise(e=>setTimeout(e))):t=(0,h.resolveAfterPending)(),e=t.then(()=>r).then(()=>{var t;e=void 0;for(let e=0;e<a.length;e++){let r=a[e];if(r&&(null===(t=s.get(r))||void 0===t?void 0:t.handle()))return a.splice(e,1),s.delete(r),void c()}let r=[...n.values()];n.clear(),s.clear(),this.state.setCheckpoint({type:"steps-found",steps:r})}))},f=e=>{n.set(e.id,e),s.set(e.hashedId,e),c()},g=async({args:e,matchOp:n,opts:s})=>{var a,o,l,c;let g;await r;let m=n((0,y.getStepOptions)(e[0]),...e.slice(1));if(this.state.executingStep&&console.warn((0,d.prettyError)({whatHappened:`We detected that you have nested \`step.*\` tooling in \`${null!==(a=m.displayName)&&void 0!==a?a:m.id}\``,consequences:"Nesting `step.*` tooling is not supported.",type:"warn",reassurance:"It's possible to see this warning if steps are separated by regular asynchronous calls, which is fine.",stack:!0,toFixNow:"Make sure you're not using `step.*` tooling inside of other `step.*` tooling. If you need to compose steps together, you can create a new async function and call it from within your step function, or use promise chaining.",code:d.ErrCode.NESTING_STEPS})),this.state.steps.has(m.id)){let e=m.id;u(e);let t=null!==(o=i.get(e))&&void 0!==o?o:1;for(let r=t;;r++){let t=e+y.STEP_INDEXING_SUFFIX+r;if(!this.state.steps.has(t)){i.set(e,r+1),m.id=t;break}}}let{promise:v,resolve:_,reject:w}=(0,h.createDeferredPromise)(),O=t._internals.hashId(m.id),E=this.state.stepState[O],S=!1;E&&(E.seen=!0,this.state.remainingStepsToBeSeen.delete(O),void 0===E.input&&(S=!0));let I=[...e];if(void 0!==(null==E?void 0:E.input)&&Array.isArray(E.input))switch(m.op){case p.StepOpCode.StepPlanned:I=[...e.slice(0,2),...E.input],g={input:[...E.input]};break;case p.StepOpCode.AiGateway:g={body:Object.assign(Object.assign({},"object"==typeof(null===(l=m.opts)||void 0===l?void 0:l.body)?Object.assign({},m.opts.body):{}),E.input[0])}}let x=Object.assign(Object.assign({},m),{opts:Object.assign(Object.assign({},m.opts),g),rawArgs:I,hashedId:O,input:null==E?void 0:E.input,fn:(null==s?void 0:s.fn)?()=>{var e;return null===(e=s.fn)||void 0===e?void 0:e.call(s,...I)}:void 0,promise:v,fulfilled:S,hasStepState:!!E,displayName:null!==(c=m.displayName)&&void 0!==c?c:m.id,handled:!1,handle:()=>!x.handled&&(x.handled=!0,S&&E&&(E.fulfilled=!0,Promise.all([E.data,E.error,E.input]).then(()=>{void 0!==E.data?_(E.data):(this.state.recentlyRejectedStepError=new b.StepError(m.id,E.error),w(this.state.recentlyRejectedStepError))})),!0)});return this.state.steps.set(m.id,x),this.state.hasSteps=!0,f(x),!r&&this.state.allStateUsed()&&await (r=(async()=>{var e,t,r,n;await (null===(t=null===(e=this.state.hooks)||void 0===e?void 0:e.afterMemoization)||void 0===t?void 0:t.call(e)),await (null===(n=null===(r=this.state.hooks)||void 0===r?void 0:r.beforeExecution)||void 0===n?void 0:n.call(r))})()),v};return(0,y.createStepTools)(this.options.client,this,g)}getUserFnToRun(){if(!this.options.isFailureHandler)return this.options.fn.fn;if(!this.options.fn.onFailureFn)throw Error("Cannot find function `onFailure` handler");return this.options.fn.onFailureFn}initializeTimer(e){this.options.requestedRunStep&&(this.timeout=(0,h.createTimeoutPromise)(this.timeoutDuration),this.timeout.then(async()=>{var t,r,n,s,i,a;await (null===(r=null===(t=this.state.hooks)||void 0===t?void 0:t.afterMemoization)||void 0===r?void 0:r.call(t)),await (null===(s=null===(n=this.state.hooks)||void 0===n?void 0:n.beforeExecution)||void 0===s?void 0:s.call(n)),await (null===(a=null===(i=this.state.hooks)||void 0===i?void 0:i.afterExecution)||void 0===a?void 0:a.call(i)),e.setCheckpoint({type:"step-not-found",step:{id:this.options.requestedRunStep,op:p.StepOpCode.StepNotFound}})}))}async initializeMiddleware(){let e=this.options.data;return await (0,g.getHookStack)(this.options.fn.middleware,"onFunctionRun",{ctx:e,fn:this.options.fn,steps:Object.values(this.options.stepState),reqArgs:this.options.reqArgs},{transformInput:(e,t)=>({ctx:Object.assign(Object.assign({},e.ctx),null==t?void 0:t.ctx),fn:this.options.fn,steps:e.steps.map((e,r)=>{var n;return Object.assign(Object.assign({},e),null===(n=null==t?void 0:t.steps)||void 0===n?void 0:n[r])}),reqArgs:e.reqArgs}),transformOutput:(e,t)=>({result:Object.assign(Object.assign({},e.result),null==t?void 0:t.result),step:e.step})})}}let S=e=>(0,o.sha1)().update(e).digest("hex");t._internals={hashOp:e=>Object.assign(Object.assign({},e),{id:S(e.id)}),hashId:S}},8086:function(e,t,r){"use strict";var n=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,s){(function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)})(n,s,(t=e[r](t)).done,t.value)})}}},s=this&&this.__await||function(e){return this instanceof s?(this.v=e,this):new s(e)},i=this&&this.__asyncGenerator||function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),a=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,d)}}),n[Symbol.asyncIterator]=function(){return this},n;function o(e,t){i[e]&&(n[e]=function(t){return new Promise(function(r,n){a.push([e,t,r,n])>1||l(e,t)})},t&&(n[e]=t(n[e])))}function l(e,t){try{var r;(r=i[e](t)).value instanceof s?Promise.resolve(r.value.v).then(u,d):c(a[0][2],r)}catch(e){c(a[0][3],e)}}function u(e){l("next",e)}function d(e){l("throw",e)}function c(e,t){e(t),a.shift(),a.length&&l(a[0][0],a[0][1])}};Object.defineProperty(t,"__esModule",{value:!0}),t._internals=t.createV2InngestExecution=void 0;let a=r(16002),o=r(18566),l=r(27353),u=r(84728),d=r(31861),c=r(31511),h=r(82576),p=r(34557),f=r(4711),g=r(76206),y=r(24968),m=r(80983),v=r(33472),b=r(89912),_=r(95486),w=r(98340),O=r(5380);t.createV2InngestExecution=e=>new E(e);class E extends _.InngestExecution{constructor(e){super(e),this.timeoutDuration=1e4,this.userFnToRun=this.getUserFnToRun(),this.state=this.createExecutionState(),this.fnArg=this.createFnArg(),this.checkpointHandlers=this.createCheckpointHandlers(),this.initializeTimer(this.state),this.debug("created new V2 execution for run;",this.options.requestedRunStep?`wanting to run step "${this.options.requestedRunStep}"`:"discovering steps"),this.debug("existing state keys:",Object.keys(this.state.stepState))}start(){if(!this.execution){this.debug("starting V2 execution");let e=a.trace.getTracer("inngest",f.version);this.execution=(0,w.getAsyncLocalStorage)().then(t=>t.run({app:this.options.client,ctx:this.fnArg},async()=>e.startActiveSpan("inngest.execution",e=>{var t;return null===(t=O.clientProcessorMap.get(this.options.client))||void 0===t||t.declareStartingSpan({span:e,runId:this.options.runId,traceparent:this.options.headers[u.headerKeys.TraceParent],tracestate:this.options.headers[u.headerKeys.TraceState]}),this._start().then(e=>(this.debug("result:",e),e)).finally(()=>{e.end()})})))}return this.execution}async _start(){try{let d=this.getCheckpointHandler("");this.state.hooks=await this.initializeMiddleware(),await this.startExecution();try{for(var e,t,r,s,i,a,o,l=!0,u=n(this.state.loop);!(e=(o=await u.next()).done);l=!0){s=o.value,l=!1,await d(s);let e=this.getCheckpointHandler(s.type),t=await e(s);if(t)return t}}catch(e){t={error:e}}finally{try{!l&&!e&&(r=u.return)&&await r.call(u)}finally{if(t)throw t.error}}}catch(e){return await this.transformOutput({error:e})}finally{this.state.loop.return(),await (null===(a=null===(i=this.state.hooks)||void 0===i?void 0:i.beforeResponse)||void 0===a?void 0:a.call(i))}throw Error("Core loop finished without returning a value")}createCheckpointHandlers(){return{"":e=>{this.debug("checkpoint:",e)},"function-resolved":async e=>await this.transformOutput({data:e.data}),"function-rejected":async e=>await this.transformOutput({error:e.error}),"steps-found":async({steps:e})=>{let r=await this.tryExecuteStep(e);if(r){let e=await this.transformOutput(r);return"function-resolved"===e.type?{type:"step-ran",ctx:e.ctx,ops:e.ops,step:t._internals.hashOp(Object.assign(Object.assign({},r),{data:e.data}))}:"function-rejected"===e.type?{type:"step-ran",ctx:e.ctx,ops:e.ops,step:t._internals.hashOp(Object.assign(Object.assign({},r),{error:e.error})),retriable:e.retriable}:e}let n=await this.filterNewSteps(Array.from(this.state.steps.values()));if(n)return{type:"steps-found",ctx:this.fnArg,ops:this.ops,steps:n}},"step-not-found":({step:e})=>({type:"step-not-found",ctx:this.fnArg,ops:this.ops,step:e})}}getCheckpointHandler(e){return this.checkpointHandlers[e]}async tryExecuteStep(e){var t;let r=this.options.requestedRunStep||this.getEarlyExecRunStep(e);if(!r)return;let n=e.find(e=>e.hashedId===r&&e.fn);if(n)return await this.executeStep(n);null===(t=this.timeout)||void 0===t||t.reset()}getEarlyExecRunStep(e){if(this.options.disableImmediateExecution)return;let t=e.filter(e=>!e.fulfilled);if(1!==t.length)return;let r=t[0];if(r&&r.op===p.StepOpCode.StepPlanned)return r.hashedId}async filterNewSteps(e){var t,r,n,s,i,a;if(this.options.requestedRunStep)return;let o=e.filter(e=>!e.fulfilled);if(!o.length)return;let l=0;for(let t of e)t.fulfilled&&l++;this.state.stepsToFulfill!==l&&console.warn((0,d.prettyError)({type:"warn",whatHappened:"Function may be indeterminate",why:"We found new steps before seeing all previous steps, which may indicate that the function is non-deterministic.",consequences:"This may cause unexpected behaviour as Inngest executes your function.",reassurance:"This is expected if a function is updated in the middle of a run, but may indicate a bug if not."})),await (null===(r=null===(t=this.state.hooks)||void 0===t?void 0:t.afterMemoization)||void 0===r?void 0:r.call(t)),await (null===(s=null===(n=this.state.hooks)||void 0===n?void 0:n.beforeExecution)||void 0===s?void 0:s.call(n)),await (null===(a=null===(i=this.state.hooks)||void 0===i?void 0:i.afterExecution)||void 0===a?void 0:a.call(i));let u=o.map(e=>({displayName:e.displayName,op:e.op,id:e.hashedId,name:e.name,opts:e.opts}));return await this.transformNewSteps(u)}async transformNewSteps(e){return Promise.all(e.map(async e=>{var t,r,n,s,i,a,o;if(e.op!==p.StepOpCode.InvokeFunction)return e;let l=await (0,g.getHookStack)(this.options.fn.middleware,"onSendEvent",void 0,{transformInput:(e,t)=>Object.assign(Object.assign({},e),t),transformOutput:(e,t)=>({result:Object.assign(Object.assign({},e.result),null==t?void 0:t.result)})}),d=await (null===(t=l.transformInput)||void 0===t?void 0:t.call(l,{payloads:[Object.assign(Object.assign({},null!==(n=null===(r=e.opts)||void 0===r?void 0:r.payload)&&void 0!==n?n:{}),{name:u.internalEvents.FunctionInvoked})]})),c=y.invokePayloadSchema.parse(null!==(i=null===(s=null==d?void 0:d.payloads)||void 0===s?void 0:s[0])&&void 0!==i?i:{});return Object.assign(Object.assign({},e),{opts:Object.assign(Object.assign({},e.opts),{payload:Object.assign(Object.assign({},null!==(o=null===(a=e.opts)||void 0===a?void 0:a.payload)&&void 0!==o?o:{}),c)})})}))}async executeStep({id:e,name:t,opts:r,fn:n,displayName:s}){var i,a,o,l,u;null===(i=this.timeout)||void 0===i||i.clear(),await (null===(o=null===(a=this.state.hooks)||void 0===a?void 0:a.afterMemoization)||void 0===o?void 0:o.call(a)),await (null===(u=null===(l=this.state.hooks)||void 0===l?void 0:l.beforeExecution)||void 0===u?void 0:u.call(l));let d={id:e,op:p.StepOpCode.StepRun,name:t,opts:r,displayName:s};this.state.executingStep=d;let c=await (0,w.getAsyncCtx)();return c&&(c.executingStep={id:e,name:s}),this.debug(`executing step "${e}"`),(0,h.runAsPromise)(n).finally(async()=>{var e,t;c&&delete c.executingStep,await (null===(t=null===(e=this.state.hooks)||void 0===e?void 0:e.afterExecution)||void 0===t?void 0:t.call(e))}).then(e=>Object.assign(Object.assign({},d),{data:e})).catch(e=>Object.assign(Object.assign({},d),{op:p.StepOpCode.StepError,error:e}))}async startExecution(){var e,t,r,n,s,i,a;await this.transformInput(),null===(e=this.timeout)||void 0===e||e.start(),await (null===(r=null===(t=this.state.hooks)||void 0===t?void 0:t.beforeMemoization)||void 0===r?void 0:r.call(t)),this.state.allStateUsed()&&(await (null===(s=null===(n=this.state.hooks)||void 0===n?void 0:n.afterMemoization)||void 0===s?void 0:s.call(n)),await (null===(a=null===(i=this.state.hooks)||void 0===i?void 0:i.beforeExecution)||void 0===a?void 0:a.call(i))),(0,h.runAsPromise)(()=>this.userFnToRun(this.fnArg)).finally(async()=>{var e,t,r,n,s,i;await (null===(t=null===(e=this.state.hooks)||void 0===e?void 0:e.afterMemoization)||void 0===t?void 0:t.call(e)),await (null===(n=null===(r=this.state.hooks)||void 0===r?void 0:r.beforeExecution)||void 0===n?void 0:n.call(r)),await (null===(i=null===(s=this.state.hooks)||void 0===s?void 0:s.afterExecution)||void 0===i?void 0:i.call(s))}).then(e=>{this.state.setCheckpoint({type:"function-resolved",data:e})}).catch(e=>{this.state.setCheckpoint({type:"function-rejected",error:e})})}async transformInput(){var e,t;let r=await (null===(t=null===(e=this.state.hooks)||void 0===e?void 0:e.transformInput)||void 0===t?void 0:t.call(e,{ctx:Object.assign({},this.fnArg),steps:Object.values(this.state.stepState),fn:this.options.fn,reqArgs:this.options.reqArgs}));(null==r?void 0:r.ctx)&&(this.fnArg=r.ctx),(null==r?void 0:r.steps)&&(this.state.stepState=Object.fromEntries(r.steps.map(e=>[e.id,e])))}async transformOutput(e){var t,r,n,s;let i=Object.assign({},e);void 0!==i.error&&(i.data=(0,d.serializeError)(i.error));let a=!!this.state.executingStep,o=await (null===(r=null===(t=this.state.hooks)||void 0===t?void 0:t.transformOutput)||void 0===r?void 0:r.call(t,{result:Object.assign({},i),step:this.state.executingStep})),{data:l,error:u}=Object.assign(Object.assign({},i),null==o?void 0:o.result);if(a||await (null===(s=null===(n=this.state.hooks)||void 0===n?void 0:n.finished)||void 0===s?void 0:s.call(n,{result:Object.assign({},void 0!==u?{error:u}:{data:l})})),void 0!==u){let e=!(u instanceof m.NonRetriableError||u instanceof b.StepError);e&&u instanceof v.RetryAfterError&&(e=u.retryAfter);let t=(0,d.minifyPrettyError)((0,d.serializeError)(u));return{type:"function-rejected",ctx:this.fnArg,ops:this.ops,error:t,retriable:e}}return{type:"function-resolved",ctx:this.fnArg,ops:this.ops,data:(0,c.undefinedToNull)(l)}}createExecutionState(){let e=(0,h.createDeferredPromiseWithStack)(),t=e.deferred.resolve,r=e.results,n=function(e){return i(this,arguments,function*(){try{for(;;){let e=(yield s(r.next())).value;e&&(yield yield s(e))}}finally{null==e||e()}})}(()=>{var e;null===(e=this.timeout)||void 0===e||e.clear(),r.return()}),a=Object.keys(this.options.stepState).length;return{stepState:this.options.stepState,stepsToFulfill:a,steps:new Map,loop:n,hasSteps:!!a,stepCompletionOrder:[...this.options.stepCompletionOrder],remainingStepsToBeSeen:new Set(this.options.stepCompletionOrder),setCheckpoint:e=>{({resolve:t}=t(e))},allStateUsed:()=>0===this.state.remainingStepsToBeSeen.size}}get ops(){return Object.fromEntries(this.state.steps)}createFnArg(){var e,t,r,n;let s=this.createStepTools(),i=Object.assign(Object.assign({},this.options.data),{step:s});if(this.options.isFailureHandler){let t=l.z.object({error:p.jsonErrorSchema}).parse(null===(e=i.event)||void 0===e?void 0:e.data);i=Object.assign(Object.assign({},i),{error:(0,d.deserializeError)(t.error)})}return null!==(n=null===(r=(t=this.options).transformCtx)||void 0===r?void 0:r.call(t,i))&&void 0!==n?n:i}createStepTools(){let e,r;let n=new Map,s=new Map,i=new Map,a=()=>{e||(e=new Promise(e=>setImmediate(e)).then(()=>r).then(()=>{for(let[t,r]of(e=void 0,s))r.handle()&&(s.delete(t),r.fulfilled&&n.delete(r.id));if(n.size){let e=[...n.values()];return n.clear(),void this.state.setCheckpoint({type:"steps-found",steps:e})}}))},o=e=>{n.set(e.id,e),s.set(e.hashedId,e),a()},l=async({args:e,matchOp:n,opts:s})=>{var a,l,u,c;let f;await r;let g=n((0,y.getStepOptions)(e[0]),...e.slice(1));if(this.state.executingStep&&console.warn((0,d.prettyError)({whatHappened:`We detected that you have nested \`step.*\` tooling in \`${null!==(a=g.displayName)&&void 0!==a?a:g.id}\``,consequences:"Nesting `step.*` tooling is not supported.",type:"warn",reassurance:"It's possible to see this warning if steps are separated by regular asynchronous calls, which is fine.",stack:!0,toFixNow:"Make sure you're not using `step.*` tooling inside of other `step.*` tooling. If you need to compose steps together, you can create a new async function and call it from within your step function, or use promise chaining.",code:d.ErrCode.NESTING_STEPS})),this.state.steps.has(g.id)){let e=g.id,t=null!==(l=i.get(e))&&void 0!==l?l:1;for(let r=t;;r++){let t=e+y.STEP_INDEXING_SUFFIX+r;if(!this.state.steps.has(t)){i.set(e,r+1),g.id=t;break}}}let{promise:m,resolve:v,reject:_}=(0,h.createDeferredPromise)(),w=t._internals.hashId(g.id),O=this.state.stepState[w],E=!1;O&&(O.seen=!0,this.state.remainingStepsToBeSeen.delete(w),void 0===O.input&&(E=!0));let S=[...e];if(void 0!==(null==O?void 0:O.input)&&Array.isArray(O.input))switch(g.op){case p.StepOpCode.StepPlanned:S=[...e.slice(0,2),...O.input],f={input:[...O.input]};break;case p.StepOpCode.AiGateway:f={body:Object.assign(Object.assign({},"object"==typeof(null===(u=g.opts)||void 0===u?void 0:u.body)?Object.assign({},g.opts.body):{}),O.input[0])}}let I=Object.assign(Object.assign({},g),{opts:Object.assign(Object.assign({},g.opts),f),rawArgs:S,hashedId:w,input:null==O?void 0:O.input,fn:(null==s?void 0:s.fn)?()=>{var e;return null===(e=s.fn)||void 0===e?void 0:e.call(s,...S)}:void 0,promise:m,fulfilled:E,hasStepState:!!O,displayName:null!==(c=g.displayName)&&void 0!==c?c:g.id,handled:!1,handle:()=>!I.handled&&(I.handled=!0,E&&O&&(O.fulfilled=!0,Promise.all([O.data,O.error,O.input]).then(()=>{void 0!==O.data?v(O.data):(this.state.recentlyRejectedStepError=new b.StepError(g.id,O.error),_(this.state.recentlyRejectedStepError))})),!0)});return this.state.steps.set(g.id,I),this.state.hasSteps=!0,o(I),!r&&this.state.allStateUsed()&&await (r=(async()=>{var e,t,r,n;await (null===(t=null===(e=this.state.hooks)||void 0===e?void 0:e.afterMemoization)||void 0===t?void 0:t.call(e)),await (null===(n=null===(r=this.state.hooks)||void 0===r?void 0:r.beforeExecution)||void 0===n?void 0:n.call(r))})()),m};return(0,y.createStepTools)(this.options.client,this,l)}getUserFnToRun(){if(!this.options.isFailureHandler)return this.options.fn.fn;if(!this.options.fn.onFailureFn)throw Error("Cannot find function `onFailure` handler");return this.options.fn.onFailureFn}initializeTimer(e){this.options.requestedRunStep&&(this.timeout=(0,h.createTimeoutPromise)(this.timeoutDuration),this.timeout.then(async()=>{var t,r,n,s,i,a;await (null===(r=null===(t=this.state.hooks)||void 0===t?void 0:t.afterMemoization)||void 0===r?void 0:r.call(t)),await (null===(s=null===(n=this.state.hooks)||void 0===n?void 0:n.beforeExecution)||void 0===s?void 0:s.call(n)),await (null===(a=null===(i=this.state.hooks)||void 0===i?void 0:i.afterExecution)||void 0===a?void 0:a.call(i)),e.setCheckpoint({type:"step-not-found",step:{id:this.options.requestedRunStep,op:p.StepOpCode.StepNotFound}})}))}async initializeMiddleware(){let e=this.options.data;return await (0,g.getHookStack)(this.options.fn.middleware,"onFunctionRun",{ctx:e,fn:this.options.fn,steps:Object.values(this.options.stepState),reqArgs:this.options.reqArgs},{transformInput:(e,t)=>({ctx:Object.assign(Object.assign({},e.ctx),null==t?void 0:t.ctx),fn:this.options.fn,steps:e.steps.map((e,r)=>{var n;return Object.assign(Object.assign({},e),null===(n=null==t?void 0:t.steps)||void 0===n?void 0:n[r])}),reqArgs:e.reqArgs}),transformOutput:(e,t)=>({result:Object.assign(Object.assign({},e.result),null==t?void 0:t.result),step:e.step})})}}let S=e=>(0,o.sha1)().update(e).digest("hex");t._internals={hashOp:e=>Object.assign(Object.assign({},e),{id:S(e.id)}),hashId:S}},35593:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerTiming=void 0;let n=r(82576);class s{constructor(){this.timings={}}start(e,t){this.timings[e]||(this.timings[e]={description:null!=t?t:"",timers:[]});let r=this.timings[e].timers.push({start:Date.now()})-1;return()=>{let t=this.timings[e];if(!t)return console.warn(`Timing "${e}" does not exist`);let n=t.timers[r];if(!n)return console.warn(`Timer ${r} for timing "${e}" does not exist`);n.end=Date.now()}}append(e,t){this.timings[e]={description:t,timers:[]}}async wrap(e,t,r){let s=this.start(e,r);try{return await (0,n.runAsPromise)(t)}finally{s()}}getHeader(){return Object.entries(this.timings).reduce((e,[t,{description:r,timers:n}])=>{if(!n.some(e=>e.end))return e;let s=n.reduce((e,{start:t,end:r})=>t&&r?e+(r-t):e,0);return[...e,[t,r?`desc="${r}"`:"",s?`dur=${s}`:""].filter(Boolean).join(";")]},[]).join(", ")}}t.ServerTiming=s},84728:function(e,t,r){"use strict";var n,s,i,a,o,l,u,d,c,h,p,f,g,y=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.syncKind=t.serverKind=t.dummyEventKey=t.debugPrefix=t.logPrefix=t.internalEvents=t.defaultDevServerHost=t.defaultInngestEventBaseUrl=t.defaultInngestApiBaseUrl=t.headerKeys=t.envKeys=t.probe=t.queryKeys=void 0;let m=y(r(7904));(n=u||(t.queryKeys=u={})).DeployId="deployId",n.FnId="fnId",n.Probe="probe",n.StepId="stepId",(d||(t.probe=d={})).Trust="trust",(s=c||(t.envKeys=c={})).InngestSigningKey="INNGEST_SIGNING_KEY",s.InngestSigningKeyFallback="INNGEST_SIGNING_KEY_FALLBACK",s.InngestEventKey="INNGEST_EVENT_KEY",s.InngestDevServerUrl="INNGEST_DEVSERVER_URL",s.InngestEnvironment="INNGEST_ENV",s.InngestBaseUrl="INNGEST_BASE_URL",s.InngestEventApiBaseUrl="INNGEST_EVENT_API_BASE_URL",s.InngestApiBaseUrl="INNGEST_API_BASE_URL",s.InngestServeHost="INNGEST_SERVE_HOST",s.InngestServePath="INNGEST_SERVE_PATH",s.InngestLogLevel="INNGEST_LOG_LEVEL",s.InngestStreaming="INNGEST_STREAMING",s.InngestDevMode="INNGEST_DEV",s.InngestAllowInBandSync="INNGEST_ALLOW_IN_BAND_SYNC",s.BranchName="BRANCH_NAME",s.VercelBranch="VERCEL_GIT_COMMIT_REF",s.IsVercel="VERCEL",s.CloudflarePagesBranch="CF_PAGES_BRANCH",s.IsCloudflarePages="CF_PAGES",s.NetlifyBranch="BRANCH",s.IsNetlify="NETLIFY",s.RenderBranch="RENDER_GIT_BRANCH",s.IsRender="RENDER",s.RailwayBranch="RAILWAY_GIT_BRANCH",s.RailwayEnvironment="RAILWAY_ENVIRONMENT",s.VercelEnvKey="VERCEL_ENV",s.OpenAiApiKey="OPENAI_API_KEY",s.GeminiApiKey="GEMINI_API_KEY",s.AnthropicApiKey="ANTHROPIC_API_KEY",(i=h||(t.headerKeys=h={})).ContentLength="content-length",i.Signature="x-inngest-signature",i.SdkVersion="x-inngest-sdk",i.Environment="x-inngest-env",i.Platform="x-inngest-platform",i.Framework="x-inngest-framework",i.NoRetry="x-inngest-no-retry",i.RequestVersion="x-inngest-req-version",i.RetryAfter="retry-after",i.InngestServerKind="x-inngest-server-kind",i.InngestExpectedServerKind="x-inngest-expected-server-kind",i.InngestSyncKind="x-inngest-sync-kind",i.EventIdSeed="x-inngest-event-id-seed",i.TraceParent="traceparent",i.TraceState="tracestate",t.defaultInngestApiBaseUrl="https://api.inngest.com/",t.defaultInngestEventBaseUrl="https://inn.gs/",t.defaultDevServerHost="http://localhost:8288/",(a=p||(t.internalEvents=p={})).FunctionFailed="inngest/function.failed",a.FunctionInvoked="inngest/function.invoked",a.FunctionFinished="inngest/function.finished",a.FunctionCancelled="inngest/function.cancelled",a.ScheduledTimer="inngest/scheduled.timer",t.logPrefix=m.default.magenta.bold("[Inngest]"),t.debugPrefix="inngest",t.dummyEventKey="NO_EVENT_KEY_SET",(o=f||(t.serverKind=f={})).Dev="dev",o.Cloud="cloud",(l=g||(t.syncKind=g={})).InBand="in_band",l.OutOfBand="out_of_band"},61575:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createEntropy=function(e){let t=new Uint8Array(e),{crypto:r}=globalThis;if(!r)throw Error("missing crypto module");if(!r.getRandomValues)throw Error("missing crypto.getRandomValues");return r.getRandomValues(t),t}},52889:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.devServerHost=t.devServerUrl=t.devServerAvailable=void 0;let n=r(84728),s=r(62019),i=async(e=n.defaultDevServerHost,r)=>{try{let n=(0,t.devServerUrl)(e,"/dev"),s=await r(n.toString());return await s.json(),!0}catch(e){return!1}};t.devServerAvailable=i,t.devServerUrl=(e=(0,t.devServerHost)(),r="")=>new URL(r,e.includes("://")?e:`http://${e}`),t.devServerHost=()=>(0,s.devServerHost)()||n.defaultDevServerHost},51606:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enumFromValue=void 0,t.enumFromValue=(e,t)=>{if(Object.values(e).includes(t))return t}},62019:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseAsBoolean=t.getResponse=t.getFetch=t.platformSupportsStreaming=t.getPlatformName=t.inngestHeaders=t.allProcessEnv=t.processEnv=t.getEnvironmentName=t.getMode=t.Mode=t.devServerHost=void 0;let n=r(4711),s=r(84728),i=r(59121);t.devServerHost=(e=(0,t.allProcessEnv)())=>{let r=["REACT_APP_","NEXT_PUBLIC_"];return[s.envKeys.InngestBaseUrl,s.envKeys.InngestDevMode].flatMap(t=>r.map(r=>e[r+t])).find(e=>{if(e)try{return new URL(e),!0}catch(e){}})};let a={equals:(e,t)=>e===t,"starts with":(e,t)=>{var r;return!!t&&null!==(r=null==e?void 0:e.startsWith(t))&&void 0!==r&&r},"is truthy":e=>!!e,"is truthy but not":(e,t)=>!!e&&e!==t},o=[["CF_PAGES","equals","1"],["CONTEXT","starts with","prod"],["ENVIRONMENT","starts with","prod"],["NODE_ENV","starts with","prod"],["VERCEL_ENV","starts with","prod"],["DENO_DEPLOYMENT_ID","is truthy"],[s.envKeys.VercelEnvKey,"is truthy but not","development"],[s.envKeys.IsNetlify,"is truthy"],[s.envKeys.IsRender,"is truthy"],[s.envKeys.RailwayBranch,"is truthy"],[s.envKeys.IsCloudflarePages,"is truthy"]];class l{constructor({type:e,isExplicit:r,explicitDevUrl:n,env:s=(0,t.allProcessEnv)()}){this.env=s,this.type=e,this.isExplicit=r||!!n,this.explicitDevUrl=n}get isDev(){return"dev"===this.type}get isCloud(){return"cloud"===this.type}get isInferred(){return!this.isExplicit}getExplicitUrl(e){return this.isExplicit?this.explicitDevUrl?this.explicitDevUrl.href:this.isCloud?e:this.isDev?s.defaultDevServerHost:void 0:void 0}}t.Mode=l,t.getMode=({env:e=(0,t.allProcessEnv)(),client:r,explicitMode:n}={})=>{if(n)return new l({type:n,isExplicit:!0,env:e});if(null==r?void 0:r.mode.isExplicit)return r.mode;if(s.envKeys.InngestDevMode in e){if("string"==typeof e[s.envKeys.InngestDevMode])try{let t=new URL(e[s.envKeys.InngestDevMode]);return new l({type:"dev",isExplicit:!0,explicitDevUrl:t,env:e})}catch(e){}let r=(0,t.parseAsBoolean)(e[s.envKeys.InngestDevMode]);if("boolean"==typeof r)return new l({type:r?"dev":"cloud",isExplicit:!0,env:e})}return new l({type:o.some(([t,r,n])=>a[r]((0,i.stringifyUnknown)(e[t]),n))?"cloud":"dev",isExplicit:!1,env:e})},t.getEnvironmentName=(e=(0,t.allProcessEnv)())=>e[s.envKeys.InngestEnvironment]||e[s.envKeys.BranchName]||e[s.envKeys.VercelBranch]||e[s.envKeys.NetlifyBranch]||e[s.envKeys.CloudflarePagesBranch]||e[s.envKeys.RenderBranch]||e[s.envKeys.RailwayBranch],t.processEnv=e=>(0,t.allProcessEnv)()[e],t.allProcessEnv=()=>{try{if(process.env)return process.env}catch(e){}try{let e=Deno.env.toObject();if(e)return e}catch(e){}try{let e=Netlify.env.toObject();if(e)return e}catch(e){}return{}},t.inngestHeaders=e=>{var r;let i=`inngest-js:v${n.version}`,a={"Content-Type":"application/json","User-Agent":i,[s.headerKeys.SdkVersion]:i};(null==e?void 0:e.framework)&&(a[s.headerKeys.Framework]=e.framework),(null==e?void 0:e.expectedServerKind)&&(a[s.headerKeys.InngestExpectedServerKind]=e.expectedServerKind);let o=Object.assign(Object.assign({},(0,t.allProcessEnv)()),null==e?void 0:e.env),l=(null==e?void 0:e.inngestEnv)||(0,t.getEnvironmentName)(o);l&&(a[s.headerKeys.Environment]=l);let u=(0,t.getPlatformName)(o);return u&&(a[s.headerKeys.Platform]=u),Object.assign(Object.assign(Object.assign({},a),null===(r=null==e?void 0:e.client)||void 0===r?void 0:r.headers),null==e?void 0:e.extras)};let u={vercel:e=>"1"===e[s.envKeys.IsVercel]||"string"==typeof EdgeRuntime,netlify:e=>"true"===e[s.envKeys.IsNetlify],"cloudflare-pages":e=>"1"===e[s.envKeys.IsCloudflarePages],render:e=>"true"===e[s.envKeys.IsRender],railway:e=>!!e[s.envKeys.RailwayEnvironment]},d={vercel:(e,t)=>"string"==typeof EdgeRuntime,"cloudflare-pages":()=>!0};t.getPlatformName=e=>Object.keys(u).find(t=>u[t](e)),t.platformSupportsStreaming=(e,r=(0,t.allProcessEnv)())=>{var n,s;return null!==(s=null===(n=d[(0,t.getPlatformName)(r)])||void 0===n?void 0:n.call(d,e,r))&&void 0!==s&&s};let c=Symbol("Custom fetch implementation");t.getFetch=e=>{if(e){if(c in e)return e;let t=async(...t)=>{var r;try{return await e(...t)}catch(e){throw e instanceof Error&&(null===(r=e.message)||void 0===r?void 0:r.startsWith("fetch failed"))||(console.warn("A request failed when using a custom fetch implementation; this may be a misconfiguration. Make sure that your fetch client is correctly bound to the global scope."),console.error(e)),e}};return Object.defineProperties(t,{[c]:{},name:{value:e.name},length:{value:e.length}}),t}try{if("undefined"!=typeof globalThis&&"fetch"in globalThis)return fetch.bind(globalThis)}catch(e){}return"undefined"!=typeof fetch?fetch:r(62845)},t.getResponse=()=>"undefined"!=typeof Response?Response:r(62845).Response,t.parseAsBoolean=e=>{if("boolean"==typeof e)return e;if("number"==typeof e)return!!e;if("string"==typeof e){let t=e.trim().toLowerCase();return"undefined"===t?void 0:!!["true","1"].includes(t)}}},31861:function(e,t,r){"use strict";var n,s,i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.functionStoppedRunningErr=t.rethrowError=t.OutgoingResultError=t.fixEventKeyMissingSteps=t.prettyError=t.getErrorMessage=t.minifyPrettyError=t.prettyErrorSplitter=t.ErrCode=t.deserializeError=t.isSerializedError=t.serializeError=void 0;let a=i(r(7904)),o=i(r(48850)),l=r(66),u=i(r(23729)),d=r(27353),c=r(80983),h="__serialized";l.errorConstructors.set("NonRetriableError",c.NonRetriableError),t.serializeError=(e,r=!1)=>{try{let n=(0,t.isSerializedError)(e);if(n)return n;if("object"==typeof e&&null!==e){let n=(0,l.serializeError)(e);if(!n.name&&r)return e;let s=Object.assign(Object.assign({},n),{name:n.name||"Error",message:n.message||(0,o.default)(e)||"Unknown error; error serialization could not find a message.",stack:n.stack||"",[h]:!0}),i=s;for(let e=0;e<5;e++){if("object"==typeof i&&null!==i&&"cause"in i&&i.cause){i=i.cause=(0,t.serializeError)(i.cause,!0);continue}break}return s}throw Error("Error is not an object; strange throw value.")}catch(n){if(r)return e;try{return Object.assign(Object.assign({},(0,t.serializeError)(Error("string"==typeof e?e:(0,o.default)(e)),!1)),{stack:"",[h]:!0})}catch(e){return{name:"Could not serialize source error",message:"Serializing the source error failed.",stack:"",[h]:!0}}}},t.isSerializedError=e=>{try{if("string"==typeof e){let t=d.z.object({[h]:d.z.literal(!0),name:d.z.enum([...Array.from(l.errorConstructors.keys())]),message:d.z.string(),stack:d.z.string()}).passthrough().safeParse(JSON.parse(e));if(t.success)return t.data}if("object"==typeof e&&null!==e&&Object.prototype.hasOwnProperty.call(e,h)&&!0===e[h])return e}catch(e){}},t.deserializeError=(e,r=!1)=>{try{if(!["name","message"].every(t=>Object.prototype.hasOwnProperty.call(e,t)))throw Error();let r=(0,l.deserializeError)(e);return"cause"in r&&(r.cause=(0,t.deserializeError)(r.cause,!0)),r}catch(n){if(r)return e;let t=Error("Unknown error; could not reserialize");return t.stack=void 0,t}},(n=s||(t.ErrCode=s={})).NESTING_STEPS="NESTING_STEPS",n.NON_DETERMINISTIC_FUNCTION="NON_DETERMINISTIC_FUNCTION",n.ASYNC_DETECTED_AFTER_MEMOIZATION="ASYNC_DETECTED_AFTER_MEMOIZATION",n.STEP_USED_AFTER_ASYNC="STEP_USED_AFTER_ASYNC",n.AUTOMATIC_PARALLEL_INDEXING="AUTOMATIC_PARALLEL_INDEXING",t.prettyErrorSplitter="=================================================",t.minifyPrettyError=e=>{var r,n,s,i;try{if(!p(e)||!e.message.includes(t.prettyErrorSplitter))return e;let a=(0,u.default)(e.message),o=(null===(n=null===(r=a.split("  ")[1])||void 0===r?void 0:r.split("\n")[0])||void 0===n?void 0:n.trim())||e.message,l=(null===(i=null===(s=a.split("\n\nCode: ")[1])||void 0===s?void 0:s.split("\n\n")[0])||void 0===i?void 0:i.trim())||void 0;if(e.message=[l,o].filter(Boolean).join(" - "),e.stack){let r=(0,u.default)(e.stack).split(`${t.prettyErrorSplitter}
`).slice(2).join("\n");e.stack=`${e.name}: ${e.message}
${r}`}return e}catch(t){return e}};let p=e=>{try{if(e instanceof Error)return!0;let t=Object.prototype.hasOwnProperty.call(e,"name"),r=Object.prototype.hasOwnProperty.call(e,"message");return t&&r}catch(e){return!1}};t.getErrorMessage=(e,t)=>{let{message:r}=d.z.object({message:d.z.string().min(1)}).catch({message:t}).parse(e);return r},t.prettyError=({type:e="error",whatHappened:r,otherwise:n,reassurance:s,toFixNow:i,why:o,consequences:l,stack:u,code:d})=>{var c,h;let{icon:p,colorFn:f}={error:{icon:"❌",colorFn:a.default.red},warn:{icon:"⚠️",colorFn:a.default.yellow}}[e],g=`${p}  ${a.default.bold.underline(r.trim())}`;u&&(g+="\n"+[...(null===(c=Error().stack)||void 0===c?void 0:c.split("\n").slice(1).filter(Boolean))||[]].join("\n"));let y=null!==(h=Array.isArray(i)?i.map(e=>e.trim()).filter(Boolean).map((e,t)=>`	${t+1}. ${e}`).join("\n"):null==i?void 0:i.trim())&&void 0!==h?h:"";Array.isArray(i)&&y&&(y=`To fix this, you can take one of the following courses of action:

${y}`);let m=[null==s?void 0:s.trim(),null==o?void 0:o.trim(),null==l?void 0:l.trim()].filter(Boolean).join(" ");m+=m?`

${y}`:y;let v=[null==n?void 0:n.trim()].filter(Boolean).join(" "),b=[t.prettyErrorSplitter,g,m,v,d?`Code: ${d}`:"",t.prettyErrorSplitter].filter(Boolean).join("\n\n");return f(b)},t.fixEventKeyMissingSteps=["Set the `INNGEST_EVENT_KEY` environment variable","Pass a key to the `new Inngest()` constructor using the `eventKey` option","Use `inngest.setEventKey()` at runtime"];class f extends Error{constructor(e){super("OutgoingOpError"),this.result=e}}t.OutgoingResultError=f,t.rethrowError=e=>t=>{try{t.message&&(t.message=`${e}; ${t.message}`)}catch(e){}finally{throw t}},t.functionStoppedRunningErr=e=>(0,t.prettyError)({whatHappened:"Your function was stopped from running",why:"We detected a mix of asynchronous logic, some using step tooling and some not.",consequences:"This can cause unexpected behaviour when a function is paused and resumed and is therefore strongly discouraged; we stopped your function to ensure nothing unexpected happened!",stack:!0,toFixNow:"Ensure that your function is either entirely step-based or entirely non-step-based, by either wrapping all asynchronous logic in `step.run()` calls or by removing all `step.*()` calls.",otherwise:"For more information on why step functions work in this manner, see https://www.inngest.com/docs/functions/multi-step#gotchas",code:e})},31511:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAllFnData=t.parseFnData=t.undefinedToNull=t.waterfall=t.cacheFn=void 0;let n=r(27353),s=r(36991),i=r(95486),a=r(34557),o=r(31861);t.cacheFn=e=>{let t="value",r=new Map;return(...n)=>(r.has(t)||r.set(t,e(...n)),r.get(t))},t.waterfall=(e,t)=>(...r)=>e.reduce(async(e,r)=>{let n=await e,s=await r(n);return t?await t(n,s):void 0===s?n:s},Promise.resolve(r[0])),t.undefinedToNull=e=>void 0===e?null:e;let l=n.z.object({version:n.z.literal(-1).or(n.z.literal(0)).or(n.z.literal(1)).or(n.z.literal(2)).optional().transform(e=>void 0===e?(console.debug(`No request version specified by executor; defaulting to v${i.PREFERRED_EXECUTION_VERSION}`),i.PREFERRED_EXECUTION_VERSION):-1===e?i.PREFERRED_EXECUTION_VERSION:e)});t.parseFnData=e=>{let t;try{return{version:t}=l.parse(e),({[i.ExecutionVersion.V0]:()=>Object.assign({version:i.ExecutionVersion.V0},n.z.object({event:n.z.record(n.z.any()),events:n.z.array(n.z.record(n.z.any())).default([]),steps:s.stepsSchemas[i.ExecutionVersion.V0],ctx:n.z.object({run_id:n.z.string(),attempt:n.z.number().default(0),stack:n.z.object({stack:n.z.array(n.z.string()).nullable().transform(e=>Array.isArray(e)?e:[]),current:n.z.number()}).passthrough().optional().nullable()}).optional().nullable(),use_api:n.z.boolean().default(!1)}).parse(e)),[i.ExecutionVersion.V1]:()=>Object.assign({version:i.ExecutionVersion.V1},n.z.object({event:n.z.record(n.z.any()),events:n.z.array(n.z.record(n.z.any())).default([]),steps:s.stepsSchemas[i.ExecutionVersion.V1],ctx:n.z.object({run_id:n.z.string(),attempt:n.z.number().default(0),disable_immediate_execution:n.z.boolean().default(!1),use_api:n.z.boolean().default(!1),stack:n.z.object({stack:n.z.array(n.z.string()).nullable().transform(e=>Array.isArray(e)?e:[]),current:n.z.number()}).passthrough().optional().nullable()}).optional().nullable()}).parse(e)),[i.ExecutionVersion.V2]:()=>Object.assign({version:i.ExecutionVersion.V2},n.z.object({event:n.z.record(n.z.any()),events:n.z.array(n.z.record(n.z.any())).default([]),steps:s.stepsSchemas[i.ExecutionVersion.V2],ctx:n.z.object({run_id:n.z.string(),attempt:n.z.number().default(0),disable_immediate_execution:n.z.boolean().default(!1),use_api:n.z.boolean().default(!1),stack:n.z.object({stack:n.z.array(n.z.string()).nullable().transform(e=>Array.isArray(e)?e:[]),current:n.z.number()}).passthrough().optional().nullable()}).optional().nullable()}).parse(e))})[t]()}catch(e){throw Error(d(e))}};let u=async({data:e,api:t,version:r})=>{var n,s,l,u;let c=Object.assign({},e);try{if(c.version===i.ExecutionVersion.V0&&c.use_api||c.version===i.ExecutionVersion.V1&&(null===(n=c.ctx)||void 0===n?void 0:n.use_api)){if(!(null===(s=c.ctx)||void 0===s?void 0:s.run_id))return(0,a.err)((0,o.prettyError)({whatHappened:"failed to attempt retrieving data from API",consequences:"function execution can't continue",why:"run_id is missing from context",stack:!0}));let[e,n]=await Promise.all([t.getRunBatch(c.ctx.run_id),t.getRunSteps(c.ctx.run_id,r)]);if(!e.ok)return(0,a.err)((0,o.prettyError)({whatHappened:"failed to retrieve list of events",consequences:"function execution can't continue",why:null===(l=e.error)||void 0===l?void 0:l.error,stack:!0}));if(c.events=e.value,!n.ok)return(0,a.err)((0,o.prettyError)({whatHappened:"failed to retrieve steps for function run",consequences:"function execution can't continue",why:null===(u=n.error)||void 0===u?void 0:u.error,stack:!0}));c.steps=n.value}return(0,a.ok)(c)}catch(e){return console.error(e),(0,a.err)(d(e))}};t.fetchAllFnData=u;let d=e=>{let t;return e instanceof n.ZodError&&(t=e.toString()),(0,o.prettyError)({whatHappened:"Failed to parse data from executor.",consequences:"Function execution can't continue.",toFixNow:"Make sure that your API is set up to parse incoming request bodies as JSON, like body-parser for Express (https://expressjs.com/en/resources/middleware/body-parser.html).",stack:!0,why:t})}},81374:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.fetchWithAuthFallback=a,t.signDataWithKey=function(e,t,r){let n="string"==typeof e?e:(0,s.default)(e),a=t.replace(/signkey-\w+-/,"");return(0,i.hmac)(i.sha256,a).update(n).update(r).digest("hex")};let s=n(r(8075)),i=r(18566);async function a({authToken:e,authTokenFallback:t,fetch:r,options:n,url:s}){let i=await r(s,Object.assign(Object.assign({},n),{headers:Object.assign(Object.assign({},null==n?void 0:n.headers),{Authorization:`Bearer ${e}`})}));return[401,403].includes(i.status)&&t&&(i=await r(s,Object.assign(Object.assign({},n),{headers:Object.assign(Object.assign({},null==n?void 0:n.headers),{Authorization:`Bearer ${t}`})}))),i}},82576:function(e,t){"use strict";var r=this&&this.__await||function(e){return this instanceof r?(this.v=e,this):new r(e)},n=this&&this.__asyncGenerator||function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,i=n.apply(e,t||[]),a=[];return s=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,d)}}),s[Symbol.asyncIterator]=function(){return this},s;function o(e,t){i[e]&&(s[e]=function(t){return new Promise(function(r,n){a.push([e,t,r,n])>1||l(e,t)})},t&&(s[e]=t(s[e])))}function l(e,t){try{var n;(n=i[e](t)).value instanceof r?Promise.resolve(n.value.v).then(u,d):c(a[0][2],n)}catch(e){c(a[0][3],e)}}function u(e){l("next",e)}function d(e){l("throw",e)}function c(e,t){e(t),a.shift(),a.length&&l(a[0][0],a[0][1])}};Object.defineProperty(t,"__esModule",{value:!0}),t.retryWithBackoff=t.resolveNextTick=t.runAsPromise=t.createTimeoutPromise=t.createDeferredPromiseWithStack=t.createDeferredPromise=t.resolveAfterPending=t.createFrozenPromise=void 0;let s=e=>{Promise.resolve().then(e)};t.createFrozenPromise=()=>new Promise(()=>void 0),t.resolveAfterPending=(e=100)=>new Promise(t=>{let r=0,n=()=>{s(()=>{if(r++>e)return t();n()})};n()}),t.createDeferredPromise=()=>{let e,r;return{promise:new Promise((n,s)=>{e=e=>(n(e),(0,t.createDeferredPromise)()),r=e=>(s(e),(0,t.createDeferredPromise)())}),resolve:e,reject:r}},t.createDeferredPromiseWithStack=()=>{let e=[],s=()=>{},i=function(){return n(this,arguments,function*(){for(;;){let t=e.shift();t?yield yield r(t):yield r(new Promise(e=>{s=e}))}})}(),a=t=>{let r=t.resolve,n=t.reject;return t.resolve=n=>(e.push(t.promise),s(),a(r(n))),t.reject=r=>(e.push(t.promise),s(),a(n(r))),t};return{deferred:a((0,t.createDeferredPromise)()),results:i}},t.createTimeoutPromise=e=>{let r,n;let{promise:s,resolve:i}=(0,t.createDeferredPromise)(),a=()=>(r||(r=setTimeout(()=>{i()},e)),n),o=()=>{clearTimeout(r),r=void 0};return n=Object.assign(s,{start:a,clear:o,reset:()=>(o(),a())})},t.runAsPromise=e=>Promise.resolve().then(e),t.resolveNextTick=()=>new Promise(e=>setTimeout(e));let i=async(e,t)=>{var r;let n=(null==t?void 0:t.maxAttempts)||5,s=null!==(r=null==t?void 0:t.baseDelay)&&void 0!==r?r:100;for(let t=1;t<=n;t++)try{return await e()}catch(i){if(t>=n)throw i;let e=Math.random()*s,r=s*Math.pow(2,t-1)+e;await new Promise(e=>setTimeout(e,r))}throw Error("Max retries reached; this should be unreachable.")};t.retryWithBackoff=i},12067:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createStream=void 0;let n=r(59121);t.createStream=e=>{var t,r;let s;let i=new Promise(e=>{s=e}),a=null!==(t=null==e?void 0:e.interval)&&void 0!==t?t:3e3,o=null!==(r=null==e?void 0:e.value)&&void 0!==r?r:" ";return new Promise(async(e,t)=>{try{let t=new ReadableStream({start(e){let t=new TextEncoder,r=setInterval(()=>{e.enqueue(t.encode(o))},a);s(s=>{clearInterval(r),Promise.resolve(s).then(r=>{e.enqueue(t.encode((0,n.stringify)(r))),e.close()})})}});e({stream:t,finalize:await i})}catch(e){t(e)}})}},59121:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.hashSigningKey=t.hashEventKey=t.stringifyUnknown=t.timeStr=t.slugify=t.stringify=void 0;let s=r(18566),i=n(r(48850)),a=n(r(48939));t.stringify=e=>(0,i.default)(e,(e,t)=>{if("bigint"!=typeof t)return t}),t.slugify=e=>e.toLowerCase().replace(/[^a-z0-9-]+/g,"-").replace(/-+/g,"-").split("-").filter(Boolean).join("-");let o=[["w",6048e5],["d",864e5],["h",36e5],["m",6e4],["s",1e3]];t.timeStr=e=>{if(e instanceof Date)return e.toISOString();let t="string"==typeof e?(0,a.default)(e):e,[,r]=o.reduce(([e,t],[r,n])=>{let s=Math.floor(e/n);return s>0?[e%n,`${t}${s}${r}`]:[e,t]},[t,""]);return r},t.stringifyUnknown=e=>{if("boolean"==typeof e||"number"==typeof e||"string"==typeof e)return e.toString()},t.hashEventKey=e=>(0,s.sha256)().update(e).digest("hex"),t.hashSigningKey=e=>{var t;if(!e)return"";let r=(null===(t=e.match(/^signkey-[\w]+-/))||void 0===t?void 0:t.shift())||"",n=e.replace(/^signkey-[\w]+-/,"");return`${r}${(0,s.sha256)().update(n,"hex").digest("hex")}`}},51447:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getISOString=t.isTemporalZonedDateTime=t.isTemporalInstant=t.isTemporalDuration=void 0,t.isTemporalDuration=e=>{try{return"Temporal.Duration"===e[Symbol.toStringTag]}catch(e){return!1}},t.isTemporalInstant=e=>{try{return"Temporal.Instant"===e[Symbol.toStringTag]}catch(e){return!1}},t.isTemporalZonedDateTime=e=>{try{return"Temporal.ZonedDateTime"===e[Symbol.toStringTag]}catch(e){return!1}},t.getISOString=e=>{if("string"==typeof e)return new Date(e).toISOString();if(e instanceof Date)return e.toISOString();if((0,t.isTemporalZonedDateTime)(e))return e.toInstant().toString();if((0,t.isTemporalInstant)(e))return e.toString();throw TypeError("Invalid date input")}},19641:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.version=t.ProxyLogger=t.dependencyInjectionMiddleware=t.slugify=t.queryKeys=t.internalEvents=t.headerKeys=t.StepError=t.RetryAfterError=t.NonRetriableError=t.InngestMiddleware=t.referenceFunction=t.InngestCommHandler=t.Inngest=t.EventSchemas=void 0,s(r(98395),t);var i=r(97888);Object.defineProperty(t,"EventSchemas",{enumerable:!0,get:function(){return i.EventSchemas}});var a=r(97177);Object.defineProperty(t,"fetch",{enumerable:!0,get:function(){return a.fetch}});var o=r(11346);Object.defineProperty(t,"Inngest",{enumerable:!0,get:function(){return o.Inngest}});var l=r(36272);Object.defineProperty(t,"InngestCommHandler",{enumerable:!0,get:function(){return l.InngestCommHandler}});var u=r(80602);Object.defineProperty(t,"referenceFunction",{enumerable:!0,get:function(){return u.referenceFunction}});var d=r(76206);Object.defineProperty(t,"InngestMiddleware",{enumerable:!0,get:function(){return d.InngestMiddleware}});var c=r(80983);Object.defineProperty(t,"NonRetriableError",{enumerable:!0,get:function(){return c.NonRetriableError}});var h=r(33472);Object.defineProperty(t,"RetryAfterError",{enumerable:!0,get:function(){return h.RetryAfterError}});var p=r(89912);Object.defineProperty(t,"StepError",{enumerable:!0,get:function(){return p.StepError}});var f=r(84728);Object.defineProperty(t,"headerKeys",{enumerable:!0,get:function(){return f.headerKeys}}),Object.defineProperty(t,"internalEvents",{enumerable:!0,get:function(){return f.internalEvents}}),Object.defineProperty(t,"queryKeys",{enumerable:!0,get:function(){return f.queryKeys}});var g=r(59121);Object.defineProperty(t,"slugify",{enumerable:!0,get:function(){return g.slugify}});var y=r(3057);Object.defineProperty(t,"dependencyInjectionMiddleware",{enumerable:!0,get:function(){return y.dependencyInjectionMiddleware}});var m=r(92899);Object.defineProperty(t,"ProxyLogger",{enumerable:!0,get:function(){return m.ProxyLogger}});var v=r(4711);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return v.version}})},3057:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dependencyInjectionMiddleware=void 0;let n=r(76206);t.dependencyInjectionMiddleware=e=>new n.InngestMiddleware({name:"Inngest: Dependency Injection",init:()=>({onFunctionRun:()=>({transformInput:()=>({ctx:e})})})})},92899:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyLogger=t.DefaultLogger=void 0;class r{info(...e){console.info(...e)}warn(...e){console.warn(...e)}error(...e){console.error(...e)}debug(...e){console.debug(...e)}}t.DefaultLogger=r;class n{constructor(e){return this.enabled=!1,this.logger=e,new Proxy(this,{get:(e,t,r)=>t in e?Reflect.get(e,t,r):Reflect.get(e.logger,t,r)})}info(...e){this.enabled&&this.logger.info(...e)}warn(...e){this.enabled&&this.logger.warn(...e)}error(...e){this.enabled&&this.logger.error(...e)}debug(...e){this.enabled&&"function"==typeof this.logger.debug&&this.logger.debug(...e)}enable(){this.enabled=!0}disable(){this.enabled=!1}async flush(){this.logger.constructor.name!==r.name&&await new Promise(e=>{setTimeout(()=>e(null),1e3)})}}t.ProxyLogger=n},7904:(e,t,r)=>{"use strict";let n;let s=r(33143),{stdout:i,stderr:a}=r(84764),{stringReplaceAll:o,stringEncaseCRLFWithFirstIndex:l}=r(80330),{isArray:u}=Array,d=["ansi","ansi","ansi256","ansi16m"],c=Object.create(null),h=(e,t={})=>{if(t.level&&!(Number.isInteger(t.level)&&t.level>=0&&t.level<=3))throw Error("The `level` option should be an integer from 0 to 3");let r=i?i.level:0;e.level=void 0===t.level?r:t.level};class p{constructor(e){return f(e)}}let f=e=>{let t={};return h(t,e),t.template=(...e)=>w(t.template,...e),Object.setPrototypeOf(t,g.prototype),Object.setPrototypeOf(t.template,t),t.template.constructor=()=>{throw Error("`chalk.constructor()` is deprecated. Use `new chalk.Instance()` instead.")},t.template.Instance=p,t.template};function g(e){return f(e)}for(let[e,t]of Object.entries(s))c[e]={get(){let r=b(this,v(t.open,t.close,this._styler),this._isEmpty);return Object.defineProperty(this,e,{value:r}),r}};c.visible={get(){let e=b(this,this._styler,!0);return Object.defineProperty(this,"visible",{value:e}),e}};let y=["rgb","hex","keyword","hsl","hsv","hwb","ansi","ansi256"];for(let e of y)c[e]={get(){let{level:t}=this;return function(...r){return b(this,v(s.color[d[t]][e](...r),s.color.close,this._styler),this._isEmpty)}}};for(let e of y)c["bg"+e[0].toUpperCase()+e.slice(1)]={get(){let{level:t}=this;return function(...r){return b(this,v(s.bgColor[d[t]][e](...r),s.bgColor.close,this._styler),this._isEmpty)}}};let m=Object.defineProperties(()=>{},{...c,level:{enumerable:!0,get(){return this._generator.level},set(e){this._generator.level=e}}}),v=(e,t,r)=>{let n,s;return void 0===r?(n=e,s=t):(n=r.openAll+e,s=t+r.closeAll),{open:e,close:t,openAll:n,closeAll:s,parent:r}},b=(e,t,r)=>{let n=(...e)=>u(e[0])&&u(e[0].raw)?_(n,w(n,...e)):_(n,1===e.length?""+e[0]:e.join(" "));return Object.setPrototypeOf(n,m),n._generator=e,n._styler=t,n._isEmpty=r,n},_=(e,t)=>{if(e.level<=0||!t)return e._isEmpty?"":t;let r=e._styler;if(void 0===r)return t;let{openAll:n,closeAll:s}=r;if(-1!==t.indexOf("\x1b"))for(;void 0!==r;)t=o(t,r.close,r.open),r=r.parent;let i=t.indexOf("\n");return -1!==i&&(t=l(t,s,n,i)),n+t+s},w=(e,...t)=>{let[s]=t;if(!u(s)||!u(s.raw))return t.join(" ");let i=t.slice(1),a=[s.raw[0]];for(let e=1;e<s.length;e++)a.push(String(i[e-1]).replace(/[{}\\]/g,"\\$&"),String(s.raw[e]));return void 0===n&&(n=r(92047)),n(e,a.join(""))};Object.defineProperties(g.prototype,c);let O=f(void 0);O.supportsColor=i,O.stderr=f({level:a?a.level:0}),O.stderr.supportsColor=a,e.exports=O},92047:e=>{"use strict";let t=/(?:\\(u(?:[a-f\d]{4}|\{[a-f\d]{1,6}\})|x[a-f\d]{2}|.))|(?:\{(~)?(\w+(?:\([^)]*\))?(?:\.\w+(?:\([^)]*\))?)*)(?:[ \t]|(?=\r?\n)))|(\})|((?:.|[\r\n\f])+?)/gi,r=/(?:^|\.)(\w+)(?:\(([^)]*)\))?/g,n=/^(['"])((?:\\.|(?!\1)[^\\])*)\1$/,s=/\\(u(?:[a-f\d]{4}|{[a-f\d]{1,6}})|x[a-f\d]{2}|.)|([^\\])/gi,i=new Map([["n","\n"],["r","\r"],["t","	"],["b","\b"],["f","\f"],["v","\v"],["0","\0"],["\\","\\"],["e","\x1b"],["a","\x07"]]);function a(e){let t="u"===e[0],r="{"===e[1];return t&&!r&&5===e.length||"x"===e[0]&&3===e.length?String.fromCharCode(parseInt(e.slice(1),16)):t&&r?String.fromCodePoint(parseInt(e.slice(2,-1),16)):i.get(e)||e}function o(e,t){let r={};for(let e of t)for(let t of e.styles)r[t[0]]=e.inverse?null:t.slice(1);let n=e;for(let[e,t]of Object.entries(r))if(Array.isArray(t)){if(!(e in n))throw Error(`Unknown Chalk style: ${e}`);n=t.length>0?n[e](...t):n[e]}return n}e.exports=(e,i)=>{let l=[],u=[],d=[];if(i.replace(t,(t,i,c,h,p,f)=>{if(i)d.push(a(i));else if(h){let t=d.join("");d=[],u.push(0===l.length?t:o(e,l)(t)),l.push({inverse:c,styles:function(e){let t;r.lastIndex=0;let i=[];for(;null!==(t=r.exec(e));){let e=t[1];if(t[2]){let r=function(e,t){let r;let i=[];for(let o of t.trim().split(/\s*,\s*/g)){let t=Number(o);if(Number.isNaN(t)){if(r=o.match(n))i.push(r[2].replace(s,(e,t,r)=>t?a(t):r));else throw Error(`Invalid Chalk template style argument: ${o} (in style '${e}')`)}else i.push(t)}return i}(e,t[2]);i.push([e].concat(r))}else i.push([e])}return i}(h)})}else if(p){if(0===l.length)throw Error("Found extraneous } in Chalk template literal");u.push(o(e,l)(d.join(""))),d=[],l.pop()}else d.push(f)}),u.push(d.join("")),l.length>0)throw Error(`Chalk template literal is missing ${l.length} closing bracket${1===l.length?"":"s"} (\`}\`)`);return u.join("")}},80330:e=>{"use strict";e.exports={stringReplaceAll:(e,t,r)=>{let n=e.indexOf(t);if(-1===n)return e;let s=t.length,i=0,a="";do a+=e.substr(i,n-i)+t+r,i=n+s,n=e.indexOf(t,i);while(-1!==n);return a+e.substr(i)},stringEncaseCRLFWithFirstIndex:(e,t,r,n)=>{let s=0,i="";do{let a="\r"===e[n-1];i+=e.substr(s,(a?n-1:n)-s)+t+(a?"\r\n":"\n")+r,s=n+1,n=e.indexOf("\n",s)}while(-1!==n);return i+e.substr(s)}}},34557:(e,t,r)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.inBandSyncRequestBodySchema=t.err=t.ok=t.functionConfigSchema=t.logLevels=t.sendEventResponseSchema=t.incomingOpSchema=t.StepOpCode=t.jsonErrorSchema=void 0;let s=r(27353),i=s.z.object({name:s.z.string().trim().optional(),error:s.z.string().trim().optional(),message:s.z.string().trim().optional(),stack:s.z.string().trim().optional()}),a=s.z.lazy(()=>s.z.object({name:s.z.string().trim(),message:s.z.string().trim(),stack:s.z.string().trim().optional(),cause:s.z.union([a,s.z.unknown()]).optional()}));t.jsonErrorSchema=i.extend({cause:s.z.union([a,s.z.unknown()]).optional()}).passthrough().catch({}).transform(e=>Object.assign(Object.assign({},e),{name:e.name||"Error",message:e.message||e.error||"Unknown error",stack:e.stack})),function(e){e.WaitForSignal="WaitForSignal",e.WaitForEvent="WaitForEvent",e.Step="Step",e.StepRun="StepRun",e.StepError="StepError",e.StepPlanned="StepPlanned",e.Sleep="Sleep",e.StepNotFound="StepNotFound",e.InvokeFunction="InvokeFunction",e.AiGateway="AIGateway",e.Gateway="Gateway"}(n||(t.StepOpCode=n={})),t.incomingOpSchema=s.z.object({id:s.z.string().min(1),data:s.z.any().optional(),error:s.z.any().optional(),input:s.z.any().optional()}),t.sendEventResponseSchema=s.z.object({ids:s.z.array(s.z.string()).default([]),status:s.z.number().default(0),error:s.z.string().optional()}),t.logLevels=["fatal","error","warn","info","debug","silent"];let o=s.z.strictObject({limit:s.z.number(),key:s.z.string().optional(),scope:s.z.enum(["fn","env","account"]).optional()});t.functionConfigSchema=s.z.strictObject({name:s.z.string().optional(),id:s.z.string(),triggers:s.z.array(s.z.union([s.z.strictObject({event:s.z.string(),expression:s.z.string().optional()}),s.z.strictObject({cron:s.z.string()})])),steps:s.z.record(s.z.strictObject({id:s.z.string(),name:s.z.string(),runtime:s.z.strictObject({type:s.z.union([s.z.literal("http"),s.z.literal("ws")]),url:s.z.string()}),retries:s.z.strictObject({attempts:s.z.number().optional()}).optional()})),idempotency:s.z.string().optional(),batchEvents:s.z.strictObject({maxSize:s.z.number(),timeout:s.z.string(),key:s.z.string().optional()}).optional(),rateLimit:s.z.strictObject({key:s.z.string().optional(),limit:s.z.number(),period:s.z.string().transform(e=>e)}).optional(),throttle:s.z.strictObject({key:s.z.string().optional(),limit:s.z.number(),period:s.z.string().transform(e=>e),burst:s.z.number().optional()}).optional(),singleton:s.z.strictObject({key:s.z.string().optional(),mode:s.z.enum(["skip","cancel"])}).optional(),cancel:s.z.array(s.z.strictObject({event:s.z.string(),if:s.z.string().optional(),timeout:s.z.string().optional()})).optional(),debounce:s.z.strictObject({key:s.z.string().optional(),period:s.z.string().transform(e=>e),timeout:s.z.string().transform(e=>e).optional()}).optional(),timeouts:s.z.strictObject({start:s.z.string().transform(e=>e).optional(),finish:s.z.string().transform(e=>e).optional()}).optional(),priority:s.z.strictObject({run:s.z.string().optional()}).optional(),concurrency:s.z.union([s.z.number(),o.transform(e=>e),s.z.array(o.transform(e=>e)).min(1).max(2)]).optional()}),t.ok=e=>({ok:!0,value:e}),t.err=e=>({ok:!1,error:e}),t.inBandSyncRequestBodySchema=s.z.strictObject({url:s.z.string()})},4711:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version=void 0,t.version="3.40.1"},48850:(e,t)=>{(e.exports=function(e,t,n,s){return JSON.stringify(e,r(t,s),n)}).getSerialize=r;function r(e,t){var r=[],n=[];return null==t&&(t=function(e,t){return r[0]===t?"[Circular ~]":"[Circular ~."+n.slice(0,r.indexOf(t)).join(".")+"]"}),function(s,i){if(r.length>0){var a=r.indexOf(this);~a?r.splice(a+1):r.push(this),~a?n.splice(a,1/0,s):n.push(s),~r.indexOf(i)&&(i=t.call(this,s,i))}else r.push(i);return null==e?i:e.call(this,s,i)}}},71460:e=>{function t(e,t){if(!e)throw Error(t||"Assertion failed")}e.exports=t,t.equal=function(e,t,r){if(e!=t)throw Error(r||"Assertion failed: "+e+" != "+t)}},48939:e=>{function t(e,t,r,n){return Math.round(e/r)+" "+n+(t>=1.5*r?"s":"")}e.exports=function(e,r){r=r||{};var n,s,i=typeof e;if("string"===i&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return 864e5*r;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(e);if("number"===i&&isFinite(e))return r.long?(n=Math.abs(e))>=864e5?t(e,n,864e5,"day"):n>=36e5?t(e,n,36e5,"hour"):n>=6e4?t(e,n,6e4,"minute"):n>=1e3?t(e,n,1e3,"second"):e+" ms":(s=Math.abs(e))>=864e5?Math.round(e/864e5)+"d":s>=36e5?Math.round(e/36e5)+"h":s>=6e4?Math.round(e/6e4)+"m":s>=1e3?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},67641:e=>{var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,i={};((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(i,{errorConstructors:()=>a}),e.exports=((e,i,a,o)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let l of n(i))s.call(e,l)||l===a||t(e,l,{get:()=>i[l],enumerable:!(o=r(i,l))||o.enumerable});return e})(t({},"__esModule",{value:!0}),i);let a=new Map([Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]))},66:(e,t,r)=>{var n=Object.defineProperty,s=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,o={};((e,t)=>{for(var r in t)n(e,r,{get:t[r],enumerable:!0})})(o,{deserializeError:()=>h,errorConstructors:()=>l.errorConstructors,serializeError:()=>c}),e.exports=((e,t,r,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let l of i(t))a.call(e,l)||l===r||n(e,l,{get:()=>t[l],enumerable:!(o=s(t,l))||o.enumerable});return e})(n({},"__esModule",{value:!0}),o);var l=r(67641);let u=e=>{var t;return null!=(t=l.errorConstructors.get(e))?t:Error},d=[{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}];function c(e){let t={name:"Error",message:"",stack:""};for(let{property:r}of d)r in e&&(t[r]=e[r]);return globalThis.DOMException&&e instanceof globalThis.DOMException?t.name="DOMException":t.name=Object.getPrototypeOf(e).name,t}function h(e){let t=new(u(e.name));for(let{property:r,enumerable:n}of d)r in e&&Object.defineProperty(t,r,{value:e[r],enumerable:n,configurable:!0,writable:!0});return t}},23729:(e,t,r)=>{"use strict";let n=r(80978);e.exports=e=>"string"==typeof e?e.replace(n(),""):e},84764:(e,t,r)=>{"use strict";let n;let s=r(22037),i=r(76224),a=r(88913),{env:o}=process;function l(e){return 0!==e&&{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function u(e,t){if(0===n)return 0;if(a("color=16m")||a("color=full")||a("color=truecolor"))return 3;if(a("color=256"))return 2;if(e&&!t&&void 0===n)return 0;let r=n||0;if("dumb"===o.TERM)return r;if("win32"===process.platform){let e=s.release().split(".");return Number(e[0])>=10&&Number(e[2])>=10586?Number(e[2])>=14931?3:2:1}if("CI"in o)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(e=>e in o)||"codeship"===o.CI_NAME?1:r;if("TEAMCITY_VERSION"in o)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(o.TEAMCITY_VERSION)?1:0;if("truecolor"===o.COLORTERM)return 3;if("TERM_PROGRAM"in o){let e=parseInt((o.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(o.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(o.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(o.TERM)||"COLORTERM"in o?1:r}a("no-color")||a("no-colors")||a("color=false")||a("color=never")?n=0:(a("color")||a("colors")||a("color=true")||a("color=always"))&&(n=1),"FORCE_COLOR"in o&&(n="true"===o.FORCE_COLOR?1:"false"===o.FORCE_COLOR?0:0===o.FORCE_COLOR.length?1:Math.min(parseInt(o.FORCE_COLOR,10),3)),e.exports={supportsColor:function(e){return l(u(e,e&&e.isTTY))},stdout:l(u(!0,i.isatty(1))),stderr:l(u(!0,i.isatty(2)))}},27353:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return s(t,e),t},a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.z=void 0;let o=i(r(59496));t.z=o,a(r(59496),t),t.default=o},3823:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZodError=t.quotelessJson=t.ZodIssueCode=void 0;let n=r(23050);t.ZodIssueCode=n.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),t.quotelessJson=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class s extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},n=e=>{for(let s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(n);else if("invalid_return_type"===s.code)n(s.returnTypeError);else if("invalid_arguments"===s.code)n(s.argumentsError);else if(0===s.path.length)r._errors.push(t(s));else{let e=r,n=0;for(;n<s.path.length;){let r=s.path[n];n===s.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(s))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(this),r}static assert(e){if(!(e instanceof s))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,n.util.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let n of this.issues)if(n.path.length>0){let r=n.path[0];t[r]=t[r]||[],t[r].push(e(n))}else r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}t.ZodError=s,s.create=e=>new s(e)},40359:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultErrorMap=void 0,t.setErrorMap=function(e){i=e},t.getErrorMap=function(){return i};let s=n(r(32366));t.defaultErrorMap=s.default;let i=s.default},59496:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(40359),t),s(r(17389),t),s(r(88791),t),s(r(23050),t),s(r(68778),t),s(r(3823),t)},97713:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.errorUtil=void 0,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(r||(t.errorUtil=r={}))},17389:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isAsync=t.isValid=t.isDirty=t.isAborted=t.OK=t.DIRTY=t.INVALID=t.ParseStatus=t.EMPTY_PATH=t.makeIssue=void 0,t.addIssueToContext=function(e,r){let n=(0,s.getErrorMap)(),a=(0,t.makeIssue)({issueData:r,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===i.default?void 0:i.default].filter(e=>!!e)});e.common.issues.push(a)};let s=r(40359),i=n(r(32366));t.makeIssue=e=>{let{data:t,path:r,errorMaps:n,issueData:s}=e,i=[...r,...s.path||[]],a={...s,path:i};if(void 0!==s.message)return{...s,path:i,message:s.message};let o="";for(let e of n.filter(e=>!!e).slice().reverse())o=e(a,{data:t,defaultError:o}).message;return{...s,path:i,message:o}},t.EMPTY_PATH=[];class a{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let s of r){if("aborted"===s.status)return t.INVALID;"dirty"===s.status&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,n=await e.value;r.push({key:t,value:n})}return a.mergeObjectSync(e,r)}static mergeObjectSync(e,r){let n={};for(let s of r){let{key:r,value:i}=s;if("aborted"===r.status||"aborted"===i.status)return t.INVALID;"dirty"===r.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"!==r.value&&(void 0!==i.value||s.alwaysSet)&&(n[r.value]=i.value)}return{status:e.value,value:n}}}t.ParseStatus=a,t.INVALID=Object.freeze({status:"aborted"}),t.DIRTY=e=>({status:"dirty",value:e}),t.OK=e=>({status:"valid",value:e}),t.isAborted=e=>"aborted"===e.status,t.isDirty=e=>"dirty"===e.status,t.isValid=e=>"valid"===e.status,t.isAsync=e=>"undefined"!=typeof Promise&&e instanceof Promise},88791:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},23050:(e,t)=>{"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.getParsedType=t.ZodParsedType=t.objectUtil=t.util=void 0,function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),n={};for(let e of r)n[e]=t[e];return e.objectValues(n)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(r||(t.util=r={})),(n||(t.objectUtil=n={})).mergeShapes=(e,t)=>({...e,...t}),t.ZodParsedType=r.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),t.getParsedType=e=>{switch(typeof e){case"undefined":return t.ZodParsedType.undefined;case"string":return t.ZodParsedType.string;case"number":return Number.isNaN(e)?t.ZodParsedType.nan:t.ZodParsedType.number;case"boolean":return t.ZodParsedType.boolean;case"function":return t.ZodParsedType.function;case"bigint":return t.ZodParsedType.bigint;case"symbol":return t.ZodParsedType.symbol;case"object":if(Array.isArray(e))return t.ZodParsedType.array;if(null===e)return t.ZodParsedType.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return t.ZodParsedType.promise;if("undefined"!=typeof Map&&e instanceof Map)return t.ZodParsedType.map;if("undefined"!=typeof Set&&e instanceof Set)return t.ZodParsedType.set;if("undefined"!=typeof Date&&e instanceof Date)return t.ZodParsedType.date;return t.ZodParsedType.object;default:return t.ZodParsedType.unknown}}},32366:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let n=r(3823),s=r(23050);t.default=(e,t)=>{let r;switch(e.code){case n.ZodIssueCode.invalid_type:r=e.received===s.ZodParsedType.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case n.ZodIssueCode.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,s.util.jsonStringifyReplacer)}`;break;case n.ZodIssueCode.unrecognized_keys:r=`Unrecognized key(s) in object: ${s.util.joinValues(e.keys,", ")}`;break;case n.ZodIssueCode.invalid_union:r="Invalid input";break;case n.ZodIssueCode.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${s.util.joinValues(e.options)}`;break;case n.ZodIssueCode.invalid_enum_value:r=`Invalid enum value. Expected ${s.util.joinValues(e.options)}, received '${e.received}'`;break;case n.ZodIssueCode.invalid_arguments:r="Invalid function arguments";break;case n.ZodIssueCode.invalid_return_type:r="Invalid function return type";break;case n.ZodIssueCode.invalid_date:r="Invalid date";break;case n.ZodIssueCode.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:s.util.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case n.ZodIssueCode.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case n.ZodIssueCode.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case n.ZodIssueCode.custom:r="Invalid input";break;case n.ZodIssueCode.invalid_intersection_types:r="Intersection results could not be merged";break;case n.ZodIssueCode.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case n.ZodIssueCode.not_finite:r="Number must be finite";break;default:r=t.defaultError,s.util.assertNever(e)}return{message:r}}},68778:(e,t,r)=>{"use strict";var n;let s;Object.defineProperty(t,"__esModule",{value:!0}),t.discriminatedUnion=t.date=t.boolean=t.bigint=t.array=t.any=t.coerce=t.ZodFirstPartyTypeKind=t.late=t.ZodSchema=t.Schema=t.ZodReadonly=t.ZodPipeline=t.ZodBranded=t.BRAND=t.ZodNaN=t.ZodCatch=t.ZodDefault=t.ZodNullable=t.ZodOptional=t.ZodTransformer=t.ZodEffects=t.ZodPromise=t.ZodNativeEnum=t.ZodEnum=t.ZodLiteral=t.ZodLazy=t.ZodFunction=t.ZodSet=t.ZodMap=t.ZodRecord=t.ZodTuple=t.ZodIntersection=t.ZodDiscriminatedUnion=t.ZodUnion=t.ZodObject=t.ZodArray=t.ZodVoid=t.ZodNever=t.ZodUnknown=t.ZodAny=t.ZodNull=t.ZodUndefined=t.ZodSymbol=t.ZodDate=t.ZodBoolean=t.ZodBigInt=t.ZodNumber=t.ZodString=t.ZodType=void 0,t.NEVER=t.void=t.unknown=t.union=t.undefined=t.tuple=t.transformer=t.symbol=t.string=t.strictObject=t.set=t.record=t.promise=t.preprocess=t.pipeline=t.ostring=t.optional=t.onumber=t.oboolean=t.object=t.number=t.nullable=t.null=t.never=t.nativeEnum=t.nan=t.map=t.literal=t.lazy=t.intersection=t.instanceof=t.function=t.enum=t.effect=void 0,t.datetimeRegex=P,t.custom=em;let i=r(3823),a=r(40359),o=r(97713),l=r(17389),u=r(23050);class d{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let c=(e,t)=>{if((0,l.isValid)(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new i.ZodError(e.common.issues);return this._error=t,this._error}}};function h(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:n,description:s}=e;if(t&&(r||n))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:s}:{errorMap:(t,s)=>{let{message:i}=e;return"invalid_enum_value"===t.code?{message:i??s.defaultError}:void 0===s.data?{message:i??n??s.defaultError}:"invalid_type"!==t.code?{message:s.defaultError}:{message:i??r??s.defaultError}},description:s}}class p{get description(){return this._def.description}_getType(e){return(0,u.getParsedType)(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:(0,u.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new l.ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:(0,u.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if((0,l.isAsync)(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,u.getParsedType)(e)},n=this._parseSync({data:e,path:r.path,parent:r});return c(r,n)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,u.getParsedType)(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return(0,l.isValid)(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>(0,l.isValid)(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,u.getParsedType)(e)},n=this._parse({data:e,path:r.path,parent:r});return c(r,await ((0,l.isAsync)(n)?n:Promise.resolve(n)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,n)=>{let s=e(t),a=()=>n.addIssue({code:i.ZodIssueCode.custom,...r(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then(e=>!!e||(a(),!1)):!!s||(a(),!1)})}refinement(e,t){return this._refinement((r,n)=>!!e(r)||(n.addIssue("function"==typeof t?t(r,n):t),!1))}_refinement(e){return new eo({schema:this,typeName:n.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return el.create(this,this._def)}nullable(){return eu.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return $.create(this)}promise(){return ea.create(this,this._def)}or(e){return H.create([this,e],this._def)}and(e){return W.create(this,e,this._def)}transform(e){return new eo({...h(this._def),schema:this,typeName:n.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new ed({...h(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:n.ZodDefault})}brand(){return new ep({typeName:n.ZodBranded,type:this,...h(this._def)})}catch(e){return new ec({...h(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:n.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return ef.create(this,e)}readonly(){return eg.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}t.ZodType=p,t.Schema=p,t.ZodSchema=p;let f=/^c[^\s-]{8,}$/i,g=/^[0-9a-z]+$/,y=/^[0-9A-HJKMNP-TV-Z]{26}$/i,m=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,v=/^[a-z0-9_-]{21}$/i,b=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,_=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,w=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,O=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,E=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,S=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,I=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,x=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,k=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,j="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",C=RegExp(`^${j}$`);function T(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function P(e){let t=`${j}T${T(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class A extends p{_parse(e){var t,r,n,a;let o;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==u.ZodParsedType.string){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.string,received:t.parsedType}),l.INVALID}let d=new l.ParseStatus;for(let c of this._def.checks)if("min"===c.kind)e.data.length<c.value&&(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{code:i.ZodIssueCode.too_small,minimum:c.value,type:"string",inclusive:!0,exact:!1,message:c.message}),d.dirty());else if("max"===c.kind)e.data.length>c.value&&(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{code:i.ZodIssueCode.too_big,maximum:c.value,type:"string",inclusive:!0,exact:!1,message:c.message}),d.dirty());else if("length"===c.kind){let t=e.data.length>c.value,r=e.data.length<c.value;(t||r)&&(o=this._getOrReturnCtx(e,o),t?(0,l.addIssueToContext)(o,{code:i.ZodIssueCode.too_big,maximum:c.value,type:"string",inclusive:!0,exact:!0,message:c.message}):r&&(0,l.addIssueToContext)(o,{code:i.ZodIssueCode.too_small,minimum:c.value,type:"string",inclusive:!0,exact:!0,message:c.message}),d.dirty())}else if("email"===c.kind)w.test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"email",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty());else if("emoji"===c.kind)s||(s=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),s.test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"emoji",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty());else if("uuid"===c.kind)m.test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"uuid",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty());else if("nanoid"===c.kind)v.test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"nanoid",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty());else if("cuid"===c.kind)f.test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"cuid",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty());else if("cuid2"===c.kind)g.test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"cuid2",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty());else if("ulid"===c.kind)y.test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"ulid",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty());else if("url"===c.kind)try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"url",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty()}else"regex"===c.kind?(c.regex.lastIndex=0,c.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"regex",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty())):"trim"===c.kind?e.data=e.data.trim():"includes"===c.kind?e.data.includes(c.value,c.position)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{code:i.ZodIssueCode.invalid_string,validation:{includes:c.value,position:c.position},message:c.message}),d.dirty()):"toLowerCase"===c.kind?e.data=e.data.toLowerCase():"toUpperCase"===c.kind?e.data=e.data.toUpperCase():"startsWith"===c.kind?e.data.startsWith(c.value)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{code:i.ZodIssueCode.invalid_string,validation:{startsWith:c.value},message:c.message}),d.dirty()):"endsWith"===c.kind?e.data.endsWith(c.value)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{code:i.ZodIssueCode.invalid_string,validation:{endsWith:c.value},message:c.message}),d.dirty()):"datetime"===c.kind?P(c).test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{code:i.ZodIssueCode.invalid_string,validation:"datetime",message:c.message}),d.dirty()):"date"===c.kind?C.test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{code:i.ZodIssueCode.invalid_string,validation:"date",message:c.message}),d.dirty()):"time"===c.kind?RegExp(`^${T(c)}$`).test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{code:i.ZodIssueCode.invalid_string,validation:"time",message:c.message}),d.dirty()):"duration"===c.kind?_.test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"duration",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty()):"ip"===c.kind?(t=e.data,("v4"===(r=c.version)||!r)&&O.test(t)||("v6"===r||!r)&&S.test(t)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"ip",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty())):"jwt"===c.kind?!function(e,t){if(!b.test(e))return!1;try{let[r]=e.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),s=JSON.parse(atob(n));if("object"!=typeof s||null===s||"typ"in s&&s?.typ!=="JWT"||!s.alg||t&&s.alg!==t)return!1;return!0}catch{return!1}}(e.data,c.alg)&&(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"jwt",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty()):"cidr"===c.kind?(n=e.data,("v4"===(a=c.version)||!a)&&E.test(n)||("v6"===a||!a)&&I.test(n)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"cidr",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty())):"base64"===c.kind?x.test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"base64",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty()):"base64url"===c.kind?k.test(e.data)||(o=this._getOrReturnCtx(e,o),(0,l.addIssueToContext)(o,{validation:"base64url",code:i.ZodIssueCode.invalid_string,message:c.message}),d.dirty()):u.util.assertNever(c);return{status:d.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:i.ZodIssueCode.invalid_string,...o.errorUtil.errToObj(r)})}_addCheck(e){return new A({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...o.errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...o.errorUtil.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...o.errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...o.errorUtil.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...o.errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...o.errorUtil.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...o.errorUtil.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...o.errorUtil.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...o.errorUtil.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...o.errorUtil.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...o.errorUtil.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...o.errorUtil.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...o.errorUtil.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...o.errorUtil.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...o.errorUtil.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...o.errorUtil.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...o.errorUtil.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...o.errorUtil.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...o.errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...o.errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...o.errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...o.errorUtil.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...o.errorUtil.errToObj(t)})}nonempty(e){return this.min(1,o.errorUtil.errToObj(e))}trim(){return new A({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new A({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new A({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}t.ZodString=A,A.create=e=>new A({checks:[],typeName:n.ZodString,coerce:e?.coerce??!1,...h(e)});class N extends p{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==u.ZodParsedType.number){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.number,received:t.parsedType}),l.INVALID}let r=new l.ParseStatus;for(let n of this._def.checks)"int"===n.kind?u.util.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,s=r>n?r:n;return Number.parseInt(e.toFixed(s).replace(".",""))%Number.parseInt(t.toFixed(s).replace(".",""))/10**s}(e.data,n.value)&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.not_finite,message:n.message}),r.dirty()):u.util.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,o.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,o.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,o.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,o.errorUtil.toString(t))}setLimit(e,t,r,n){return new N({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:o.errorUtil.toString(n)}]})}_addCheck(e){return new N({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:o.errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:o.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:o.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:o.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:o.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:o.errorUtil.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:o.errorUtil.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:o.errorUtil.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:o.errorUtil.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&u.util.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}t.ZodNumber=N,N.create=e=>new N({checks:[],typeName:n.ZodNumber,coerce:e?.coerce||!1,...h(e)});class R extends p{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==u.ZodParsedType.bigint)return this._getInvalidInput(e);let r=new l.ParseStatus;for(let n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):u.util.assertNever(n);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.bigint,received:t.parsedType}),l.INVALID}gte(e,t){return this.setLimit("min",e,!0,o.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,o.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,o.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,o.errorUtil.toString(t))}setLimit(e,t,r,n){return new R({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:o.errorUtil.toString(n)}]})}_addCheck(e){return new R({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:o.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:o.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:o.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:o.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:o.errorUtil.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}t.ZodBigInt=R,R.create=e=>new R({checks:[],typeName:n.ZodBigInt,coerce:e?.coerce??!1,...h(e)});class Z extends p{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==u.ZodParsedType.boolean){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.boolean,received:t.parsedType}),l.INVALID}return(0,l.OK)(e.data)}}t.ZodBoolean=Z,Z.create=e=>new Z({typeName:n.ZodBoolean,coerce:e?.coerce||!1,...h(e)});class F extends p{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==u.ZodParsedType.date){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.date,received:t.parsedType}),l.INVALID}if(Number.isNaN(e.data.getTime())){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_date}),l.INVALID}let r=new l.ParseStatus;for(let n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),r.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),r.dirty()):u.util.assertNever(n);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new F({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:o.errorUtil.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:o.errorUtil.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}t.ZodDate=F,F.create=e=>new F({checks:[],coerce:e?.coerce||!1,typeName:n.ZodDate,...h(e)});class z extends p{_parse(e){if(this._getType(e)!==u.ZodParsedType.symbol){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.symbol,received:t.parsedType}),l.INVALID}return(0,l.OK)(e.data)}}t.ZodSymbol=z,z.create=e=>new z({typeName:n.ZodSymbol,...h(e)});class M extends p{_parse(e){if(this._getType(e)!==u.ZodParsedType.undefined){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.undefined,received:t.parsedType}),l.INVALID}return(0,l.OK)(e.data)}}t.ZodUndefined=M,M.create=e=>new M({typeName:n.ZodUndefined,...h(e)});class K extends p{_parse(e){if(this._getType(e)!==u.ZodParsedType.null){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.null,received:t.parsedType}),l.INVALID}return(0,l.OK)(e.data)}}t.ZodNull=K,K.create=e=>new K({typeName:n.ZodNull,...h(e)});class U extends p{constructor(){super(...arguments),this._any=!0}_parse(e){return(0,l.OK)(e.data)}}t.ZodAny=U,U.create=e=>new U({typeName:n.ZodAny,...h(e)});class D extends p{constructor(){super(...arguments),this._unknown=!0}_parse(e){return(0,l.OK)(e.data)}}t.ZodUnknown=D,D.create=e=>new D({typeName:n.ZodUnknown,...h(e)});class B extends p{_parse(e){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.never,received:t.parsedType}),l.INVALID}}t.ZodNever=B,B.create=e=>new B({typeName:n.ZodNever,...h(e)});class L extends p{_parse(e){if(this._getType(e)!==u.ZodParsedType.undefined){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.void,received:t.parsedType}),l.INVALID}return(0,l.OK)(e.data)}}t.ZodVoid=L,L.create=e=>new L({typeName:n.ZodVoid,...h(e)});class $ extends p{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==u.ZodParsedType.array)return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.array,received:t.parsedType}),l.INVALID;if(null!==n.exactLength){let e=t.data.length>n.exactLength.value,s=t.data.length<n.exactLength.value;(e||s)&&((0,l.addIssueToContext)(t,{code:e?i.ZodIssueCode.too_big:i.ZodIssueCode.too_small,minimum:s?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&((0,l.addIssueToContext)(t,{code:i.ZodIssueCode.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&((0,l.addIssueToContext)(t,{code:i.ZodIssueCode.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>n.type._parseAsync(new d(t,e,t.path,r)))).then(e=>l.ParseStatus.mergeArray(r,e));let s=[...t.data].map((e,r)=>n.type._parseSync(new d(t,e,t.path,r)));return l.ParseStatus.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new $({...this._def,minLength:{value:e,message:o.errorUtil.toString(t)}})}max(e,t){return new $({...this._def,maxLength:{value:e,message:o.errorUtil.toString(t)}})}length(e,t){return new $({...this._def,exactLength:{value:e,message:o.errorUtil.toString(t)}})}nonempty(e){return this.min(1,e)}}t.ZodArray=$,$.create=(e,t)=>new $({type:e,minLength:null,maxLength:null,exactLength:null,typeName:n.ZodArray,...h(t)});class V extends p{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=u.util.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==u.ZodParsedType.object){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.object,received:t.parsedType}),l.INVALID}let{status:t,ctx:r}=this._processInputParams(e),{shape:n,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof B&&"strip"===this._def.unknownKeys))for(let e in r.data)s.includes(e)||a.push(e);let o=[];for(let e of s){let t=n[e],s=r.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new d(r,s,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof B){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of a)o.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)a.length>0&&((0,l.addIssueToContext)(r,{code:i.ZodIssueCode.unrecognized_keys,keys:a}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of a){let n=r.data[t];o.push({key:{status:"valid",value:t},value:e._parse(new d(r,n,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of o){let r=await t.key,n=await t.value;e.push({key:r,value:n,alwaysSet:t.alwaysSet})}return e}).then(e=>l.ParseStatus.mergeObjectSync(t,e)):l.ParseStatus.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(e){return o.errorUtil.errToObj,new V({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let n=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:o.errorUtil.errToObj(e).message??n}:{message:n}}}:{}})}strip(){return new V({...this._def,unknownKeys:"strip"})}passthrough(){return new V({...this._def,unknownKeys:"passthrough"})}extend(e){return new V({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new V({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:n.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new V({...this._def,catchall:e})}pick(e){let t={};for(let r of u.util.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new V({...this._def,shape:()=>t})}omit(e){let t={};for(let r of u.util.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new V({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof V){let r={};for(let n in t.shape){let s=t.shape[n];r[n]=el.create(e(s))}return new V({...t._def,shape:()=>r})}return t instanceof $?new $({...t._def,type:e(t.element)}):t instanceof el?el.create(e(t.unwrap())):t instanceof eu?eu.create(e(t.unwrap())):t instanceof Y?Y.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};for(let r of u.util.objectKeys(this.shape)){let n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()}return new V({...this._def,shape:()=>t})}required(e){let t={};for(let r of u.util.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof el;)e=e._def.innerType;t[r]=e}return new V({...this._def,shape:()=>t})}keyof(){return en(u.util.objectKeys(this.shape))}}t.ZodObject=V,V.create=(e,t)=>new V({shape:()=>e,unknownKeys:"strip",catchall:B.create(),typeName:n.ZodObject,...h(t)}),V.strictCreate=(e,t)=>new V({shape:()=>e,unknownKeys:"strict",catchall:B.create(),typeName:n.ZodObject,...h(t)}),V.lazycreate=(e,t)=>new V({shape:e,unknownKeys:"strip",catchall:B.create(),typeName:n.ZodObject,...h(t)});class H extends p{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new i.ZodError(e.ctx.common.issues));return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_union,unionErrors:r}),l.INVALID});{let e;let n=[];for(let s of r){let r={...t,common:{...t.common,issues:[]},parent:null},i=s._parseSync({data:t.data,path:t.path,parent:r});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:r}),r.common.issues.length&&n.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let s=n.map(e=>new i.ZodError(e));return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_union,unionErrors:s}),l.INVALID}}get options(){return this._def.options}}t.ZodUnion=H,H.create=(e,t)=>new H({options:e,typeName:n.ZodUnion,...h(t)});let q=e=>{if(e instanceof et)return q(e.schema);if(e instanceof eo)return q(e.innerType());if(e instanceof er)return[e.value];if(e instanceof es)return e.options;if(e instanceof ei)return u.util.objectValues(e.enum);if(e instanceof ed)return q(e._def.innerType);if(e instanceof M)return[void 0];else if(e instanceof K)return[null];else if(e instanceof el)return[void 0,...q(e.unwrap())];else if(e instanceof eu)return[null,...q(e.unwrap())];else if(e instanceof ep)return q(e.unwrap());else if(e instanceof eg)return q(e.unwrap());else if(e instanceof ec)return q(e._def.innerType);else return[]};class G extends p{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.ZodParsedType.object)return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.object,received:t.parsedType}),l.INVALID;let r=this.discriminator,n=t.data[r],s=this.optionsMap.get(n);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):((0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),l.INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let s=new Map;for(let r of t){let t=q(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let n of t){if(s.has(n))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);s.set(n,r)}}return new G({typeName:n.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...h(r)})}}t.ZodDiscriminatedUnion=G;class W extends p{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if((0,l.isAborted)(e)||(0,l.isAborted)(n))return l.INVALID;let s=function e(t,r){let n=(0,u.getParsedType)(t),s=(0,u.getParsedType)(r);if(t===r)return{valid:!0,data:t};if(n===u.ZodParsedType.object&&s===u.ZodParsedType.object){let n=u.util.objectKeys(r),s=u.util.objectKeys(t).filter(e=>-1!==n.indexOf(e)),i={...t,...r};for(let n of s){let s=e(t[n],r[n]);if(!s.valid)return{valid:!1};i[n]=s.data}return{valid:!0,data:i}}if(n===u.ZodParsedType.array&&s===u.ZodParsedType.array){if(t.length!==r.length)return{valid:!1};let n=[];for(let s=0;s<t.length;s++){let i=e(t[s],r[s]);if(!i.valid)return{valid:!1};n.push(i.data)}return{valid:!0,data:n}}return n===u.ZodParsedType.date&&s===u.ZodParsedType.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}(e.value,n.value);return s.valid?(((0,l.isDirty)(e)||(0,l.isDirty)(n))&&t.dirty(),{status:t.value,value:s.data}):((0,l.addIssueToContext)(r,{code:i.ZodIssueCode.invalid_intersection_types}),l.INVALID)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>n(e,t)):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}t.ZodIntersection=W,W.create=(e,t,r)=>new W({left:e,right:t,typeName:n.ZodIntersection,...h(r)});class Y extends p{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.ZodParsedType.array)return(0,l.addIssueToContext)(r,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.array,received:r.parsedType}),l.INVALID;if(r.data.length<this._def.items.length)return(0,l.addIssueToContext)(r,{code:i.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),l.INVALID;!this._def.rest&&r.data.length>this._def.items.length&&((0,l.addIssueToContext)(r,{code:i.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let n=[...r.data].map((e,t)=>{let n=this._def.items[t]||this._def.rest;return n?n._parse(new d(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(n).then(e=>l.ParseStatus.mergeArray(t,e)):l.ParseStatus.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new Y({...this._def,rest:e})}}t.ZodTuple=Y,Y.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new Y({items:e,typeName:n.ZodTuple,rest:null,...h(t)})};class X extends p{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.ZodParsedType.object)return(0,l.addIssueToContext)(r,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.object,received:r.parsedType}),l.INVALID;let n=[],s=this._def.keyType,a=this._def.valueType;for(let e in r.data)n.push({key:s._parse(new d(r,e,r.path,e)),value:a._parse(new d(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?l.ParseStatus.mergeObjectAsync(t,n):l.ParseStatus.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return new X(t instanceof p?{keyType:e,valueType:t,typeName:n.ZodRecord,...h(r)}:{keyType:A.create(),valueType:e,typeName:n.ZodRecord,...h(t)})}}t.ZodRecord=X;class J extends p{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.ZodParsedType.map)return(0,l.addIssueToContext)(r,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.map,received:r.parsedType}),l.INVALID;let n=this._def.keyType,s=this._def.valueType,a=[...r.data.entries()].map(([e,t],i)=>({key:n._parse(new d(r,e,r.path,[i,"key"])),value:s._parse(new d(r,t,r.path,[i,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of a){let n=await r.key,s=await r.value;if("aborted"===n.status||"aborted"===s.status)return l.INVALID;("dirty"===n.status||"dirty"===s.status)&&t.dirty(),e.set(n.value,s.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of a){let n=r.key,s=r.value;if("aborted"===n.status||"aborted"===s.status)return l.INVALID;("dirty"===n.status||"dirty"===s.status)&&t.dirty(),e.set(n.value,s.value)}return{status:t.value,value:e}}}}t.ZodMap=J,J.create=(e,t,r)=>new J({valueType:t,keyType:e,typeName:n.ZodMap,...h(r)});class Q extends p{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.ZodParsedType.set)return(0,l.addIssueToContext)(r,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.set,received:r.parsedType}),l.INVALID;let n=this._def;null!==n.minSize&&r.data.size<n.minSize.value&&((0,l.addIssueToContext)(r,{code:i.ZodIssueCode.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&r.data.size>n.maxSize.value&&((0,l.addIssueToContext)(r,{code:i.ZodIssueCode.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());let s=this._def.valueType;function a(e){let r=new Set;for(let n of e){if("aborted"===n.status)return l.INVALID;"dirty"===n.status&&t.dirty(),r.add(n.value)}return{status:t.value,value:r}}let o=[...r.data.values()].map((e,t)=>s._parse(new d(r,e,r.path,t)));return r.common.async?Promise.all(o).then(e=>a(e)):a(o)}min(e,t){return new Q({...this._def,minSize:{value:e,message:o.errorUtil.toString(t)}})}max(e,t){return new Q({...this._def,maxSize:{value:e,message:o.errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}t.ZodSet=Q,Q.create=(e,t)=>new Q({valueType:e,minSize:null,maxSize:null,typeName:n.ZodSet,...h(t)});class ee extends p{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.ZodParsedType.function)return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.function,received:t.parsedType}),l.INVALID;function r(e,r){return(0,l.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,a.getErrorMap)(),a.defaultErrorMap].filter(e=>!!e),issueData:{code:i.ZodIssueCode.invalid_arguments,argumentsError:r}})}function n(e,r){return(0,l.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,a.getErrorMap)(),a.defaultErrorMap].filter(e=>!!e),issueData:{code:i.ZodIssueCode.invalid_return_type,returnTypeError:r}})}let s={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof ea){let e=this;return(0,l.OK)(async function(...t){let a=new i.ZodError([]),l=await e._def.args.parseAsync(t,s).catch(e=>{throw a.addIssue(r(t,e)),a}),u=await Reflect.apply(o,this,l);return await e._def.returns._def.type.parseAsync(u,s).catch(e=>{throw a.addIssue(n(u,e)),a})})}{let e=this;return(0,l.OK)(function(...t){let a=e._def.args.safeParse(t,s);if(!a.success)throw new i.ZodError([r(t,a.error)]);let l=Reflect.apply(o,this,a.data),u=e._def.returns.safeParse(l,s);if(!u.success)throw new i.ZodError([n(l,u.error)]);return u.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ee({...this._def,args:Y.create(e).rest(D.create())})}returns(e){return new ee({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new ee({args:e||Y.create([]).rest(D.create()),returns:t||D.create(),typeName:n.ZodFunction,...h(r)})}}t.ZodFunction=ee;class et extends p{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}t.ZodLazy=et,et.create=(e,t)=>new et({getter:e,typeName:n.ZodLazy,...h(t)});class er extends p{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{received:t.data,code:i.ZodIssueCode.invalid_literal,expected:this._def.value}),l.INVALID}return{status:"valid",value:e.data}}get value(){return this._def.value}}function en(e,t){return new es({values:e,typeName:n.ZodEnum,...h(t)})}t.ZodLiteral=er,er.create=(e,t)=>new er({value:e,typeName:n.ZodLiteral,...h(t)});class es extends p{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return(0,l.addIssueToContext)(t,{expected:u.util.joinValues(r),received:t.parsedType,code:i.ZodIssueCode.invalid_type}),l.INVALID}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return(0,l.addIssueToContext)(t,{received:t.data,code:i.ZodIssueCode.invalid_enum_value,options:r}),l.INVALID}return(0,l.OK)(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return es.create(e,{...this._def,...t})}exclude(e,t=this._def){return es.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}t.ZodEnum=es,es.create=en;class ei extends p{_parse(e){let t=u.util.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==u.ZodParsedType.string&&r.parsedType!==u.ZodParsedType.number){let e=u.util.objectValues(t);return(0,l.addIssueToContext)(r,{expected:u.util.joinValues(e),received:r.parsedType,code:i.ZodIssueCode.invalid_type}),l.INVALID}if(this._cache||(this._cache=new Set(u.util.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=u.util.objectValues(t);return(0,l.addIssueToContext)(r,{received:r.data,code:i.ZodIssueCode.invalid_enum_value,options:e}),l.INVALID}return(0,l.OK)(e.data)}get enum(){return this._def.values}}t.ZodNativeEnum=ei,ei.create=(e,t)=>new ei({values:e,typeName:n.ZodNativeEnum,...h(t)});class ea extends p{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.ZodParsedType.promise&&!1===t.common.async)return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.promise,received:t.parsedType}),l.INVALID;let r=t.parsedType===u.ZodParsedType.promise?t.data:Promise.resolve(t.data);return(0,l.OK)(r.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}t.ZodPromise=ea,ea.create=(e,t)=>new ea({type:e,typeName:n.ZodPromise,...h(t)});class eo extends p{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===n.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,s={addIssue:e=>{(0,l.addIssueToContext)(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),"preprocess"===n.type){let e=n.transform(r.data,s);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return l.INVALID;let n=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===n.status?l.INVALID:"dirty"===n.status||"dirty"===t.value?(0,l.DIRTY)(n.value):n});{if("aborted"===t.value)return l.INVALID;let n=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===n.status?l.INVALID:"dirty"===n.status||"dirty"===t.value?(0,l.DIRTY)(n.value):n}}if("refinement"===n.type){let e=e=>{let t=n.refinement(e,s);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?l.INVALID:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?l.INVALID:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}}if("transform"===n.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>(0,l.isValid)(e)?Promise.resolve(n.transform(e.value,s)).then(e=>({status:t.value,value:e})):l.INVALID);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!(0,l.isValid)(e))return l.INVALID;let i=n.transform(e.value,s);if(i instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}}u.util.assertNever(n)}}t.ZodEffects=eo,t.ZodTransformer=eo,eo.create=(e,t,r)=>new eo({schema:e,typeName:n.ZodEffects,effect:t,...h(r)}),eo.createWithPreprocess=(e,t,r)=>new eo({schema:t,effect:{type:"preprocess",transform:e},typeName:n.ZodEffects,...h(r)});class el extends p{_parse(e){return this._getType(e)===u.ZodParsedType.undefined?(0,l.OK)(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodOptional=el,el.create=(e,t)=>new el({innerType:e,typeName:n.ZodOptional,...h(t)});class eu extends p{_parse(e){return this._getType(e)===u.ZodParsedType.null?(0,l.OK)(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodNullable=eu,eu.create=(e,t)=>new eu({innerType:e,typeName:n.ZodNullable,...h(t)});class ed extends p{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===u.ZodParsedType.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}t.ZodDefault=ed,ed.create=(e,t)=>new ed({innerType:e,typeName:n.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...h(t)});class ec extends p{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return(0,l.isAsync)(n)?n.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new i.ZodError(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new i.ZodError(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}t.ZodCatch=ec,ec.create=(e,t)=>new ec({innerType:e,typeName:n.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...h(t)});class eh extends p{_parse(e){if(this._getType(e)!==u.ZodParsedType.nan){let t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:i.ZodIssueCode.invalid_type,expected:u.ZodParsedType.nan,received:t.parsedType}),l.INVALID}return{status:"valid",value:e.data}}}t.ZodNaN=eh,eh.create=e=>new eh({typeName:n.ZodNaN,...h(e)}),t.BRAND=Symbol("zod_brand");class ep extends p{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}t.ZodBranded=ep;class ef extends p{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?l.INVALID:"dirty"===e.status?(t.dirty(),(0,l.DIRTY)(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?l.INVALID:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ef({in:e,out:t,typeName:n.ZodPipeline})}}t.ZodPipeline=ef;class eg extends p{_parse(e){let t=this._def.innerType._parse(e),r=e=>((0,l.isValid)(e)&&(e.value=Object.freeze(e.value)),e);return(0,l.isAsync)(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function ey(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function em(e,t={},r){return e?U.create().superRefine((n,s)=>{let i=e(n);if(i instanceof Promise)return i.then(e=>{if(!e){let e=ey(t,n),i=e.fatal??r??!0;s.addIssue({code:"custom",...e,fatal:i})}});if(!i){let e=ey(t,n),i=e.fatal??r??!0;s.addIssue({code:"custom",...e,fatal:i})}}):U.create()}t.ZodReadonly=eg,eg.create=(e,t)=>new eg({innerType:e,typeName:n.ZodReadonly,...h(t)}),t.late={object:V.lazycreate},function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(n||(t.ZodFirstPartyTypeKind=n={})),t.instanceof=(e,t={message:`Input not instance of ${e.name}`})=>em(t=>t instanceof e,t);let ev=A.create;t.string=ev;let eb=N.create;t.number=eb;let e_=eh.create;t.nan=e_;let ew=R.create;t.bigint=ew;let eO=Z.create;t.boolean=eO;let eE=F.create;t.date=eE;let eS=z.create;t.symbol=eS;let eI=M.create;t.undefined=eI;let ex=K.create;t.null=ex;let ek=U.create;t.any=ek;let ej=D.create;t.unknown=ej;let eC=B.create;t.never=eC;let eT=L.create;t.void=eT;let eP=$.create;t.array=eP;let eA=V.create;t.object=eA;let eN=V.strictCreate;t.strictObject=eN;let eR=H.create;t.union=eR;let eZ=G.create;t.discriminatedUnion=eZ;let eF=W.create;t.intersection=eF;let ez=Y.create;t.tuple=ez;let eM=X.create;t.record=eM;let eK=J.create;t.map=eK;let eU=Q.create;t.set=eU;let eD=ee.create;t.function=eD;let eB=et.create;t.lazy=eB;let eL=er.create;t.literal=eL;let e$=es.create;t.enum=e$;let eV=ei.create;t.nativeEnum=eV;let eH=ea.create;t.promise=eH;let eq=eo.create;t.effect=eq,t.transformer=eq;let eG=el.create;t.optional=eG;let eW=eu.create;t.nullable=eW;let eY=eo.createWithPreprocess;t.preprocess=eY;let eX=ef.create;t.pipeline=eX,t.ostring=()=>ev().optional(),t.onumber=()=>eb().optional(),t.oboolean=()=>eO().optional(),t.coerce={string:e=>A.create({...e,coerce:!0}),number:e=>N.create({...e,coerce:!0}),boolean:e=>Z.create({...e,coerce:!0}),bigint:e=>R.create({...e,coerce:!0}),date:e=>F.create({...e,coerce:!0})},t.NEVER=l.INVALID},84025:(e,t,r)=>{"use strict";let n;r.r(t),r.d(t,{AbortError:()=>H,FetchError:()=>f,Headers:()=>T,Request:()=>V,Response:()=>z,default:()=>J});var s=r(12781),i=r(13685),a=r(57310),o=r(93548),l=r(95687),u=r(59796);let d=s.Readable,c=Symbol("buffer"),h=Symbol("type");class p{constructor(){this[h]="";let e=arguments[0],t=arguments[1],r=[];if(e){let t=Number(e.length);for(let n=0;n<t;n++){let t;let s=e[n];s instanceof Buffer?t=s:t=ArrayBuffer.isView(s)?Buffer.from(s.buffer,s.byteOffset,s.byteLength):s instanceof ArrayBuffer?Buffer.from(s):s instanceof p?s[c]:Buffer.from("string"==typeof s?s:String(s)),t.length,r.push(t)}}this[c]=Buffer.concat(r);let n=t&&void 0!==t.type&&String(t.type).toLowerCase();n&&!/[^\u0020-\u007E]/.test(n)&&(this[h]=n)}get size(){return this[c].length}get type(){return this[h]}text(){return Promise.resolve(this[c].toString())}arrayBuffer(){let e=this[c];return Promise.resolve(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}stream(){let e=new d;return e._read=function(){},e.push(this[c]),e.push(null),e}toString(){return"[object Blob]"}slice(){let e;let t=this.size,r=arguments[0],n=arguments[1];e=void 0===r?0:r<0?Math.max(t+r,0):Math.min(r,t);let s=Math.max((void 0===n?t:n<0?Math.max(t+n,0):Math.min(n,t))-e,0),i=this[c].slice(e,e+s),a=new p([],{type:arguments[2]});return a[c]=i,a}}function f(e,t,r){Error.call(this,e),this.message=e,this.type=t,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}Object.defineProperties(p.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(p.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),f.prototype=Object.create(Error.prototype),f.prototype.constructor=f,f.prototype.name="FetchError";try{n=require("encoding").convert}catch(e){}let g=Symbol("Body internals"),y=s.PassThrough;function m(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.size,i=r.timeout;null==e?e=null:b(e)?e=Buffer.from(e.toString()):_(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof s||(e=Buffer.from(String(e)))),this[g]={body:e,disturbed:!1,error:null},this.size=void 0===n?0:n,this.timeout=void 0===i?0:i,e instanceof s&&e.on("error",function(e){let r="AbortError"===e.name?e:new f(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e);t[g].error=r})}function v(){var e=this;if(this[g].disturbed)return m.Promise.reject(TypeError(`body used already for: ${this.url}`));if(this[g].disturbed=!0,this[g].error)return m.Promise.reject(this[g].error);let t=this.body;if(null===t)return m.Promise.resolve(Buffer.alloc(0));if(_(t)&&(t=t.stream()),Buffer.isBuffer(t))return m.Promise.resolve(t);if(!(t instanceof s))return m.Promise.resolve(Buffer.alloc(0));let r=[],n=0,i=!1;return new m.Promise(function(s,a){let o;e.timeout&&(o=setTimeout(function(){i=!0,a(new f(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))},e.timeout)),t.on("error",function(t){"AbortError"===t.name?(i=!0,a(t)):a(new f(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))}),t.on("data",function(t){if(!i&&null!==t){if(e.size&&n+t.length>e.size){i=!0,a(new f(`content size at ${e.url} over limit: ${e.size}`,"max-size"));return}n+=t.length,r.push(t)}}),t.on("end",function(){if(!i){clearTimeout(o);try{s(Buffer.concat(r,n))}catch(t){a(new f(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}})})}function b(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function _(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function w(e){let t,r;let n=e.body;if(e.bodyUsed)throw Error("cannot clone body after it is used");return n instanceof s&&"function"!=typeof n.getBoundary&&(t=new y,r=new y,n.pipe(t),n.pipe(r),e[g].body=t,n=r),n}function O(e){if(null===e)return null;if("string"==typeof e)return"text/plain;charset=UTF-8";if(b(e))return"application/x-www-form-urlencoded;charset=UTF-8";if(_(e))return e.type||null;if(Buffer.isBuffer(e))return null;if("[object ArrayBuffer]"===Object.prototype.toString.call(e))return null;if(ArrayBuffer.isView(e))return null;else if("function"==typeof e.getBoundary)return`multipart/form-data;boundary=${e.getBoundary()}`;else if(e instanceof s)return null;else return"text/plain;charset=UTF-8"}function E(e){let t=e.body;return null===t?0:_(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}m.prototype={get body(){return this[g].body},get bodyUsed(){return this[g].disturbed},arrayBuffer(){return v.call(this).then(function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)})},blob(){let e=this.headers&&this.headers.get("content-type")||"";return v.call(this).then(function(t){return Object.assign(new p([],{type:e.toLowerCase()}),{[c]:t})})},json(){var e=this;return v.call(this).then(function(t){try{return JSON.parse(t.toString())}catch(t){return m.Promise.reject(new f(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}})},text(){return v.call(this).then(function(e){return e.toString()})},buffer(){return v.call(this)},textConverted(){var e=this;return v.call(this).then(function(t){return function(e,t){let r,s;if("function"!=typeof n)throw Error("The package `encoding` must be installed to use the textConverted() function");let i=t.get("content-type"),a="utf-8";return i&&(r=/charset=([^;]*)/i.exec(i)),s=e.slice(0,1024).toString(),!r&&s&&(r=/<meta.+?charset=(['"])(.+?)\1/i.exec(s)),!r&&s&&(!(r=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(s))&&(r=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(s))&&r.pop(),r&&(r=/charset=(.*)/i.exec(r.pop()))),!r&&s&&(r=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(s)),r&&("gb2312"===(a=r.pop())||"gbk"===a)&&(a="gb18030"),n(e,"UTF-8",a).toString()}(t,e.headers)})}},Object.defineProperties(m.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),m.mixIn=function(e){for(let t of Object.getOwnPropertyNames(m.prototype))if(!(t in e)){let r=Object.getOwnPropertyDescriptor(m.prototype,t);Object.defineProperty(e,t,r)}},m.Promise=global.Promise;let S=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,I=/[^\t\x20-\x7e\x80-\xff]/;function x(e){if(e=`${e}`,S.test(e)||""===e)throw TypeError(`${e} is not a legal HTTP header name`)}function k(e){if(e=`${e}`,I.test(e))throw TypeError(`${e} is not a legal HTTP header value`)}function j(e,t){for(let r in t=t.toLowerCase(),e)if(r.toLowerCase()===t)return r}let C=Symbol("map");class T{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[C]=Object.create(null),e instanceof T){let t=e.raw();for(let e of Object.keys(t))for(let r of t[e])this.append(e,r);return}if(null==e);else if("object"==typeof e){let t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw TypeError("Header pairs must be iterable");let r=[];for(let t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw TypeError("Each header pair must be iterable");r.push(Array.from(t))}for(let e of r){if(2!==e.length)throw TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(let t of Object.keys(e)){let r=e[t];this.append(t,r)}}else throw TypeError("Provided initializer must be an object")}get(e){x(e=`${e}`);let t=j(this[C],e);return void 0===t?null:this[C][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=P(this),n=0;for(;n<r.length;){var s=r[n];let i=s[0],a=s[1];e.call(t,a,i,this),r=P(this),n++}}set(e,t){e=`${e}`,t=`${t}`,x(e),k(t);let r=j(this[C],e);this[C][void 0!==r?r:e]=[t]}append(e,t){e=`${e}`,t=`${t}`,x(e),k(t);let r=j(this[C],e);void 0!==r?this[C][r].push(t):this[C][e]=[t]}has(e){return x(e=`${e}`),void 0!==j(this[C],e)}delete(e){x(e=`${e}`);let t=j(this[C],e);void 0!==t&&delete this[C][t]}raw(){return this[C]}keys(){return N(this,"key")}values(){return N(this,"value")}[Symbol.iterator](){return N(this,"key+value")}}function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";return Object.keys(e[C]).sort().map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[C][t].join(", ")}:function(t){return[t.toLowerCase(),e[C][t].join(", ")]})}T.prototype.entries=T.prototype[Symbol.iterator],Object.defineProperty(T.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(T.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});let A=Symbol("internal");function N(e,t){let r=Object.create(R);return r[A]={target:e,kind:t,index:0},r}let R=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==R)throw TypeError("Value of `this` is not a HeadersIterator");var e=this[A];let t=e.target,r=e.kind,n=e.index,s=P(t,r);return n>=s.length?{value:void 0,done:!0}:(this[A].index=n+1,{value:s[n],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));Object.defineProperty(R,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});let Z=Symbol("Response internals"),F=i.STATUS_CODES;class z{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};m.call(this,e,t);let r=t.status||200,n=new T(t.headers);if(null!=e&&!n.has("Content-Type")){let t=O(e);t&&n.append("Content-Type",t)}this[Z]={url:t.url,status:r,statusText:t.statusText||F[r],headers:n,counter:t.counter}}get url(){return this[Z].url||""}get status(){return this[Z].status}get ok(){return this[Z].status>=200&&this[Z].status<300}get redirected(){return this[Z].counter>0}get statusText(){return this[Z].statusText}get headers(){return this[Z].headers}clone(){return new z(w(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}m.mixIn(z.prototype),Object.defineProperties(z.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(z.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});let M=Symbol("Request internals"),K=a.URL||o.URL,U=a.parse,D=a.format;function B(e){return/^[a-zA-Z][a-zA-Z\d+\-.]*:/.exec(e)&&(e=new K(e).toString()),U(e)}let L="destroy"in s.Readable.prototype;function $(e){return"object"==typeof e&&"object"==typeof e[M]}class V{constructor(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$(e)?t=B(e.url):(t=e&&e.href?B(e.href):B(`${e}`),e={});let n=r.method||e.method||"GET";if(n=n.toUpperCase(),(null!=r.body||$(e)&&null!==e.body)&&("GET"===n||"HEAD"===n))throw TypeError("Request with GET/HEAD method cannot have body");let s=null!=r.body?r.body:$(e)&&null!==e.body?w(e):null;m.call(this,s,{timeout:r.timeout||e.timeout||0,size:r.size||e.size||0});let i=new T(r.headers||e.headers||{});if(null!=s&&!i.has("Content-Type")){let e=O(s);e&&i.append("Content-Type",e)}let a=$(e)?e.signal:null;if("signal"in r&&(a=r.signal),null!=a&&!function(e){let t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!!(t&&"AbortSignal"===t.constructor.name)}(a))throw TypeError("Expected signal to be an instanceof AbortSignal");this[M]={method:n,redirect:r.redirect||e.redirect||"follow",headers:i,parsedURL:t,signal:a},this.follow=void 0!==r.follow?r.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==r.compress?r.compress:void 0===e.compress||e.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent}get method(){return this[M].method}get url(){return D(this[M].parsedURL)}get headers(){return this[M].headers}get redirect(){return this[M].redirect}get signal(){return this[M].signal}clone(){return new V(this)}}function H(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}m.mixIn(V.prototype),Object.defineProperty(V.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(V.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),H.prototype=Object.create(Error.prototype),H.prototype.constructor=H,H.prototype.name="AbortError";let q=a.URL||o.URL,G=s.PassThrough,W=function(e,t){let r=new q(t).hostname,n=new q(e).hostname;return r===n||"."===r[r.length-n.length-1]&&r.endsWith(n)};function Y(e,t){if(!Y.Promise)throw Error("native promise missing, set fetch.Promise to your favorite alternative");return m.Promise=Y.Promise,new Y.Promise(function(r,n){var a;let o,d;let c=new V(e,t),h=function(e){let t=e[M].parsedURL,r=new T(e[M].headers);if(r.has("Accept")||r.set("Accept","*/*"),!t.protocol||!t.hostname)throw TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof s.Readable&&!L)throw Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let n=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(n="0"),null!=e.body){let t=E(e);"number"==typeof t&&(n=String(t))}n&&r.set("Content-Length",n),r.has("User-Agent")||r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate");let i=e.agent;return"function"==typeof i&&(i=i(t)),Object.assign({},t,{method:e.method,headers:function(e){let t=Object.assign({__proto__:null},e[C]),r=j(e[C],"Host");return void 0!==r&&(t[r]=t[r][0]),t}(r),agent:i})}(c),p=("https:"===h.protocol?l:i).request,g=c.signal,y=null,m=function(){let e=new H("The user aborted a request.");n(e),c.body&&c.body instanceof s.Readable&&X(c.body,e),y&&y.body&&y.body.emit("error",e)};if(g&&g.aborted){m();return}let v=function(){m(),w()},b=p(h);function w(){b.abort(),g&&g.removeEventListener("abort",v),clearTimeout(o)}g&&g.addEventListener("abort",v),c.timeout&&b.once("socket",function(e){o=setTimeout(function(){n(new f(`network timeout at: ${c.url}`,"request-timeout")),w()},c.timeout)}),b.on("error",function(e){n(new f(`request to ${c.url} failed, reason: ${e.message}`,"system",e)),y&&y.body&&X(y.body,e),w()}),a=function(e){(!g||!g.aborted)&&y&&y.body&&X(y.body,e)},b.on("socket",function(e){d=e}),b.on("response",function(e){let t=e.headers;"chunked"!==t["transfer-encoding"]||t["content-length"]||e.once("close",function(e){if(d&&d.listenerCount("data")>0&&!e){let e=Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",a(e)}})}),14>parseInt(process.version.substring(1))&&b.on("socket",function(e){e.addListener("close",function(t){let r=e.listenerCount("data")>0;if(y&&r&&!t&&!(g&&g.aborted)){let e=Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",y.body.emit("error",e)}})}),b.on("response",function(e){clearTimeout(o);let t=function(e){let t=new T;for(let r of Object.keys(e))if(!S.test(r)){if(Array.isArray(e[r]))for(let n of e[r])I.test(n)||(void 0===t[C][r]?t[C][r]=[n]:t[C][r].push(n));else I.test(e[r])||(t[C][r]=[e[r]])}return t}(e.headers);if(Y.isRedirect(e.statusCode)){let i=t.get("Location"),a=null;try{a=null===i?null:new q(i,c.url).toString()}catch(e){if("manual"!==c.redirect){n(new f(`uri requested responds with an invalid redirect URL: ${i}`,"invalid-redirect")),w();return}}switch(c.redirect){case"error":n(new f(`uri requested responds with a redirect, redirect mode is set to error: ${c.url}`,"no-redirect")),w();return;case"manual":if(null!==a)try{t.set("Location",a)}catch(e){n(e)}break;case"follow":var s;if(null===a)break;if(c.counter>=c.follow){n(new f(`maximum redirect reached at: ${c.url}`,"max-redirect")),w();return}let o={headers:new T(c.headers),follow:c.follow,counter:c.counter+1,agent:c.agent,compress:c.compress,method:c.method,body:c.body,signal:c.signal,timeout:c.timeout,size:c.size};if(!W(c.url,a)||(s=c.url,new q(a).protocol!==new q(s).protocol))for(let e of["authorization","www-authenticate","cookie","cookie2"])o.headers.delete(e);if(303!==e.statusCode&&c.body&&null===E(c)){n(new f("Cannot follow redirect with body being a readable stream","unsupported-redirect")),w();return}(303===e.statusCode||(301===e.statusCode||302===e.statusCode)&&"POST"===c.method)&&(o.method="GET",o.body=void 0,o.headers.delete("content-length")),r(Y(new V(a,o))),w();return}}e.once("end",function(){g&&g.removeEventListener("abort",v)});let i=e.pipe(new G),a={url:c.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:c.size,timeout:c.timeout,counter:c.counter},l=t.get("Content-Encoding");if(!c.compress||"HEAD"===c.method||null===l||204===e.statusCode||304===e.statusCode){r(y=new z(i,a));return}let d={flush:u.Z_SYNC_FLUSH,finishFlush:u.Z_SYNC_FLUSH};if("gzip"==l||"x-gzip"==l){r(y=new z(i=i.pipe(u.createGunzip(d)),a));return}if("deflate"==l||"x-deflate"==l){let t=e.pipe(new G);t.once("data",function(e){r(y=new z(i=(15&e[0])==8?i.pipe(u.createInflate()):i.pipe(u.createInflateRaw()),a))}),t.on("end",function(){y||r(y=new z(i,a))});return}if("br"==l&&"function"==typeof u.createBrotliDecompress){r(y=new z(i=i.pipe(u.createBrotliDecompress()),a));return}r(y=new z(i,a))}),function(e,t){let r=t.body;null===r?e.end():_(r)?r.stream().pipe(e):Buffer.isBuffer(r)?(e.write(r),e.end()):r.pipe(e)}(b,c)})}function X(e,t){e.destroy?e.destroy(t):(e.emit("error",t),e.end())}Y.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},Y.Promise=global.Promise;let J=Y}};
"use strict";(()=>{var e={};e.id=4003,e.ids=[4003],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},35034:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},15485:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>w,requestAsyncStorage:()=>v,routeModule:()=>c,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{DELETE:()=>l,GET:()=>u,PUT:()=>p});var n=r(63036),o=r(5736),i=r(15262),a=r(60942),d=r(53244);async function u(e,{params:t}){try{let e=(0,d.e)(),{data:{user:r},error:s}=await e.auth.getUser();if(s||!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{data:n,error:o}=await e.from("markets").select("owner_id").eq("id",t.id).single();if(o||!n)return a.NextResponse.json({error:"Market not found"},{status:404});let{data:i}=await e.from("profiles").select("id").eq("id",r.id).single();if(!i||n.owner_id!==i.id)return a.NextResponse.json({error:"Forbidden"},{status:403});let{data:u,error:p}=await e.from("events").select("*").eq("id",t.eventId).eq("market_id",t.id).single();if(p||!u)return a.NextResponse.json({error:"Event not found"},{status:404});return a.NextResponse.json(u)}catch(e){return console.error("Error in GET /api/markets/[id]/events/[eventId]:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e,{params:t}){try{let r=(0,d.e)(),{data:{user:s},error:n}=await r.auth.getUser();if(n||!s)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{data:o,error:i}=await r.from("markets").select("owner_id").eq("id",t.id).single();if(i||!o)return a.NextResponse.json({error:"Market not found"},{status:404});let{data:u}=await r.from("profiles").select("id").eq("id",s.id).single();if(!u||o.owner_id!==u.id)return a.NextResponse.json({error:"Forbidden"},{status:403});let{title:p,description:l,start_at:c,end_at:v,all_day:m,location:x,tags:f,visibility:w}=await e.json();if(c&&v){let e=new Date(c),t=new Date(v);if(isNaN(e.getTime())||isNaN(t.getTime()))return a.NextResponse.json({error:"Invalid date format"},{status:400});if(e>=t)return a.NextResponse.json({error:"End time must be after start time"},{status:400})}let g={};void 0!==p&&(g.title=p),void 0!==l&&(g.description=l),void 0!==c&&(g.start_at=new Date(c).toISOString()),void 0!==v&&(g.end_at=new Date(v).toISOString()),void 0!==m&&(g.all_day=m),void 0!==x&&(g.location=x),void 0!==f&&(g.tags=f),void 0!==w&&(g.visibility=w);let{data:I,error:N}=await r.from("events").update(g).eq("id",t.eventId).eq("market_id",t.id).select().single();if(N){if(console.error("Error updating event:",N),"PGRST116"===N.code)return a.NextResponse.json({error:"Event not found"},{status:404});return a.NextResponse.json({error:"Failed to update event"},{status:500})}return a.NextResponse.json(I)}catch(e){return console.error("Error in PUT /api/markets/[id]/events/[eventId]:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e,{params:t}){try{let e=(0,d.e)(),{data:{user:r},error:s}=await e.auth.getUser();if(s||!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{data:n,error:o}=await e.from("markets").select("owner_id").eq("id",t.id).single();if(o||!n)return a.NextResponse.json({error:"Market not found"},{status:404});let{data:i}=await e.from("profiles").select("id").eq("id",r.id).single();if(!i||n.owner_id!==i.id)return a.NextResponse.json({error:"Forbidden"},{status:403});let{error:u}=await e.from("events").delete().eq("id",t.eventId).eq("market_id",t.id);if(u)return console.error("Error deleting event:",u),a.NextResponse.json({error:"Failed to delete event"},{status:500});return new a.NextResponse(null,{status:204})}catch(e){return console.error("Error in DELETE /api/markets/[id]/events/[eventId]:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/markets/[id]/events/[eventId]/route",pathname:"/api/markets/[id]/events/[eventId]",filename:"route",bundlePath:"app/api/markets/[id]/events/[eventId]/route"},resolvedPagePath:"/Users/gwendolyn/Downloads/markethub/apps/web/app/api/markets/[id]/events/[eventId]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:m,serverHooks:x}=c,f="/api/markets/[id]/events/[eventId]/route";function w(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}},53244:(e,t,r)=>{r.d(t,{e:()=>o,m:()=>i});var s=r(76994),n=r(9362);function o(){let e=(0,n.cookies)();return(0,s.lx)("https://wpawqkvfcwbocliwbcaq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndwYXdxa3ZmY3dib2NsaXdiY2FxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MjE5NTcsImV4cCI6MjA3MTA5Nzk1N30.RNhc1X4blqoXbgUpeJV-A_hVgWYQIVa0wTk40j-FDgo",{cookies:{get:t=>e.get(t)?.value,set(t,r,s){e.set({name:t,value:r,...s})},remove(t,r){e.set({name:t,value:"",...r})}}})}function i(){return(0,s.lx)("https://wpawqkvfcwbocliwbcaq.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{cookies:{get(){},set(){},remove(){}}})}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4522,3515,942,7193],()=>r(15485));module.exports=s})();
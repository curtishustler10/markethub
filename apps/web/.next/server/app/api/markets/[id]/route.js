"use strict";(()=>{var e={};e.id=421,e.ids=[421],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},35034:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},82686:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>j,requestAsyncStorage:()=>w,routeModule:()=>x,serverHooks:()=>k,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{DELETE:()=>f,GET:()=>c,PUT:()=>m,dynamic:()=>l});var o=r(63036),n=r(5736),a=r(15262),i=r(60942),d=r(53244),u=r(78503),p=r(66456);let l="force-dynamic";async function c(e,{params:t}){try{let e=(0,d.e)(),{data:r,error:s}=await e.from("markets").select(`
        *,
        owner:profiles!owner_id (
          id,
          name,
          email,
          phone
        ),
        events (
          id,
          start_date,
          end_date,
          notes
        ),
        market_documents (
          id,
          type,
          verification_status,
          expiry_date
        )
      `).eq("id",t.id).single();if(s){if("PGRST116"===s.code)return i.NextResponse.json({error:"Market not found"},{status:404});throw s}let o=await (0,u.JQ)(),n=o?.id===r.owner_id||o?.role==="admin";if("live"!==r.status&&!n)return i.NextResponse.json({error:"Market not found"},{status:404});return i.NextResponse.json(r)}catch(e){return console.error("Error fetching market:",e),i.NextResponse.json({error:"Failed to fetch market"},{status:500})}}async function m(e,{params:t}){try{let r=await (0,u.JQ)();if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let s=(0,d.e)(),{data:o,error:n}=await s.from("markets").select("owner_id").eq("id",t.id).single();if(n){if("PGRST116"===n.code)return i.NextResponse.json({error:"Market not found"},{status:404});throw n}if(o.owner_id!==r.id&&"admin"!==r.role)return i.NextResponse.json({error:"Insufficient permissions"},{status:403});let a=await e.json(),l=p.oV.parse(a),{data:c,error:m}=await s.from("markets").update(l).eq("id",t.id).select().single();if(m)throw m;return i.NextResponse.json(c)}catch(e){return console.error("Error updating market:",e),i.NextResponse.json({error:"Failed to update market"},{status:500})}}async function f(e,{params:t}){try{let e=await (0,u.JQ)();if(!e)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=(0,d.e)(),{data:s,error:o}=await r.from("markets").select("owner_id").eq("id",t.id).single();if(o){if("PGRST116"===o.code)return i.NextResponse.json({error:"Market not found"},{status:404});throw o}if(s.owner_id!==e.id&&"admin"!==e.role)return i.NextResponse.json({error:"Insufficient permissions"},{status:403});let{error:n}=await r.from("markets").delete().eq("id",t.id);if(n)throw n;return i.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting market:",e),i.NextResponse.json({error:"Failed to delete market"},{status:500})}}let x=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/markets/[id]/route",pathname:"/api/markets/[id]",filename:"route",bundlePath:"app/api/markets/[id]/route"},resolvedPagePath:"/Users/gwendolyn/Downloads/markethub/apps/web/app/api/markets/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:w,staticGenerationAsyncStorage:h,serverHooks:k}=x,g="/api/markets/[id]/route";function j(){return(0,a.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:h})}},78503:(e,t,r)=>{r.d(t,{JQ:()=>o,xv:()=>n});var s=r(53244);async function o(){let e=(0,s.e)(),{data:{user:t}}=await e.auth.getUser();if(!t)return null;let{data:r}=await e.from("profiles").select("*").eq("id",t.id).single();return r}async function n(e,t,r,o){let n=(0,s.e)(),{data:a,error:i}=await n.from("profiles").insert({id:e,email:t,name:r,role:o}).select().single();if(i)throw i;return a}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[522,515,193,942,401,509],()=>r(82686));module.exports=s})();
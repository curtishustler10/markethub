"use strict";(()=>{var e={};e.id=820,e.ids=[820],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},35034:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},4706:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>k,requestAsyncStorage:()=>x,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{GET:()=>d,POST:()=>m,dynamic:()=>c});var s=r(63036),n=r(5736),i=r(15262),o=r(60942),l=r(53244),p=r(78503),u=r(66456);let c="force-dynamic";async function d(e){try{let{searchParams:t}=new URL(e.url),r=Object.fromEntries(t.entries()),{page:a=1,limit:s=20,search:n,lat:i,lng:p,radius:c=50,state:d,city:m}=u.og.parse({page:r.page?parseInt(r.page):1,limit:r.limit?parseInt(r.limit):20,search:r.search,lat:r.lat?parseFloat(r.lat):void 0,lng:r.lng?parseFloat(r.lng):void 0,radius:r.radius?parseInt(r.radius):50,state:r.state,city:r.city}),g=(0,l.e)().from("markets").select(`
        *,
        owner:profiles!owner_id (
          id,
          name,
          email,
          phone
        ),
        events (
          id,
          start_date,
          end_date,
          notes
        )
      `).eq("status","live");n&&(g=g.or(`name.ilike.%${n}%,description.ilike.%${n}%`)),d&&(g=g.eq("state",d)),m&&(g=g.eq("city",m));let{data:x,error:f,count:h}=await g.range((a-1)*s,a*s-1).order("created_at",{ascending:!1});if(f)throw f;let w=x||[];return i&&p&&(w=w.filter(e=>!!e.lat&&!!e.lng&&(0,u.MK)(i,p,e.lat,e.lng)<=c).map(e=>({...e,distance:(0,u.MK)(i,p,e.lat,e.lng)})).sort((e,t)=>e.distance-t.distance)),o.NextResponse.json({markets:w,total:h||0,page:a,limit:s})}catch(e){return console.error("Error fetching markets:",e),o.NextResponse.json({error:"Failed to fetch markets"},{status:500})}}async function m(e){try{let t=await (0,p.JQ)();if(!t||"market_organizer"!==t.role&&"admin"!==t.role)return o.NextResponse.json({error:"Insufficient permissions"},{status:403});let r=await e.json(),a=u.Bw.parse(r),s=(0,u.GD)(a.name),n=(0,l.e)(),{data:i}=await n.from("markets").select("slug").eq("slug",s).single();if(i)return o.NextResponse.json({error:"A market with this name already exists"},{status:400});let{data:c,error:d}=await n.from("markets").insert({...a,slug:s,owner_id:t.id}).select().single();if(d)throw d;return o.NextResponse.json(c,{status:201})}catch(e){return console.error("Error creating market:",e),o.NextResponse.json({error:"Failed to create market"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/markets/route",pathname:"/api/markets",filename:"route",bundlePath:"app/api/markets/route"},resolvedPagePath:"/Users/gwendolyn/Downloads/markethub/apps/web/app/api/markets/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:f,serverHooks:h}=g,w="/api/markets/route";function k(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},78503:(e,t,r)=>{r.d(t,{JQ:()=>s,xv:()=>n});var a=r(53244);async function s(){let e=(0,a.e)(),{data:{user:t}}=await e.auth.getUser();if(!t)return null;let{data:r}=await e.from("profiles").select("*").eq("id",t.id).single();return r}async function n(e,t,r,s){let n=(0,a.e)(),{data:i,error:o}=await n.from("profiles").insert({id:e,email:t,name:r,role:s}).select().single();if(o)throw o;return i}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[522,515,193,942,401,509],()=>r(4706));module.exports=a})();
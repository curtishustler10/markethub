"use strict";(()=>{var e={};e.id=6062,e.ids=[6062],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},35034:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},34436:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>q,requestAsyncStorage:()=>x,routeModule:()=>f,serverHooks:()=>v,staticGenerationAsyncStorage:()=>g});var o={};t.r(o),t.d(o,{POST:()=>m,dynamic:()=>c});var i=t(63036),n=t(5736),s=t(15262),a=t(60942),d=t(53244),u=t(78503),p=t(66456),l=t(79763);let c="force-dynamic";async function m(e){try{let r;let t=await (0,u.JQ)();if(!t)return a.NextResponse.json({error:"Unauthorized"},{status:401});let o=await e.json(),{type:i,region:n,marketId:s}=p.$U.extend({marketId:l.Z_().uuid().optional()}).parse(o),c=(0,d.e)(),m=!1;if(s){let{data:e}=await c.from("markets").select("owner_id").eq("id",s).single();if(!e||e.owner_id!==t.id&&"admin"!==t.role)return a.NextResponse.json({error:"Insufficient permissions"},{status:403});r=`market-docs/${s}/${i}-${Date.now()}`,m=!0;let{error:o}=await c.from("markets").update({is_verified:!0,verified_at:new Date().toISOString(),verified_by:t.id}).eq("id",s);o&&console.error("Error verifying market:",o)}else{if("vendor"!==t.role&&"admin"!==t.role)return a.NextResponse.json({error:"Insufficient permissions"},{status:403});r=`vendor-docs/${t.id}/${i}-${Date.now()}`;let{error:e}=await c.from("vendor_profiles").update({is_verified:!0,verified_at:new Date().toISOString(),verified_by:t.id}).or(`vendor_id.eq.${t.id},claimed_profile_id.eq.${t.id}`);e&&console.error("Error verifying vendor profile:",e)}let{data:f,error:x}=await c.storage.from("documents").createSignedUploadUrl(r);if(x)throw x;return a.NextResponse.json({signed_url:f.signedUrl,storage_path:r,type:i,region:n,is_market_document:m,market_id:s})}catch(e){return console.error("Error creating upload URL:",e),a.NextResponse.json({error:"Failed to create upload URL"},{status:500})}}let f=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/documents/upload/route",pathname:"/api/documents/upload",filename:"route",bundlePath:"app/api/documents/upload/route"},resolvedPagePath:"/Users/gwendolyn/Downloads/markethub/apps/web/app/api/documents/upload/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:x,staticGenerationAsyncStorage:g,serverHooks:v}=f,w="/api/documents/upload/route";function q(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:g})}},78503:(e,r,t)=>{t.d(r,{JQ:()=>i,xv:()=>n});var o=t(53244);async function i(){let e=(0,o.e)(),{data:{user:r}}=await e.auth.getUser();if(!r)return null;let{data:t}=await e.from("profiles").select("*").eq("id",r.id).single();return t}async function n(e,r,t,i){let n=(0,o.e)(),{data:s,error:a}=await n.from("profiles").insert({id:e,email:r,name:t,role:i}).select().single();if(a)throw a;return s}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[4522,3515,942,7193,2401,6509],()=>t(34436));module.exports=o})();
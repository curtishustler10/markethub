"use strict";(()=>{var e={};e.id=62,e.ids=[62],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},93363:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var o={};r.r(o),r.d(o,{POST:()=>l});var s=r(49303),n=r(88716),a=r(60670),i=r(87070),u=r(19692),d=r(90455),p=r(51709);async function l(e){try{let t;let r=await (0,d.JQ)();if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let o=await e.json(),{type:s,region:n,marketId:a}=p.$U.extend({marketId:z.string().uuid().optional()}).parse(o),l=(0,u.e)(),c=!1;if(a){let{data:e}=await l.from("markets").select("owner_id").eq("id",a).single();if(!e||e.owner_id!==r.id&&"admin"!==r.role)return i.NextResponse.json({error:"Insufficient permissions"},{status:403});t=`market-docs/${a}/${s}-${Date.now()}`,c=!0}else{if("vendor"!==r.role&&"admin"!==r.role)return i.NextResponse.json({error:"Insufficient permissions"},{status:403});t=`vendor-docs/${r.id}/${s}-${Date.now()}`}let{data:m,error:x}=await l.storage.from("documents").createSignedUploadUrl(t);if(x)throw x;return i.NextResponse.json({signed_url:m.signedUrl,storage_path:t,type:s,region:n,is_market_document:c,market_id:a})}catch(e){return console.error("Error creating upload URL:",e),i.NextResponse.json({error:"Failed to create upload URL"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/documents/upload/route",pathname:"/api/documents/upload",filename:"route",bundlePath:"app/api/documents/upload/route"},resolvedPagePath:"/Users/gwendolyn/Downloads/markethub/apps/web/app/api/documents/upload/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:x,serverHooks:f}=c,g="/api/documents/upload/route";function w(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}},90455:(e,t,r)=>{r.d(t,{JQ:()=>s,xv:()=>n});var o=r(19692);async function s(){let e=(0,o.e)(),{data:{user:t}}=await e.auth.getUser();if(!t)return null;let{data:r}=await e.from("profiles").select("*").eq("id",t.id).single();return r}async function n(e,t,r,s){let n=(0,o.e)(),{data:a,error:i}=await n.from("profiles").insert({id:e,email:t,name:r,role:s}).select().single();if(i)throw i;return a}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[948,265,775,70,20,238],()=>r(93363));module.exports=o})();
"use strict";(()=>{var e={};e.id=922,e.ids=[922],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},92761:e=>{e.exports=require("node:async_hooks")},22037:e=>{e.exports=require("os")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},38983:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>_,requestAsyncStorage:()=>v,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var n={};t.r(n),t.d(n,{POST:()=>c});var a=t(49303),o=t(88716),i=t(60670),s=t(87070),d=t(19692),p=t(90455),l=t(51709),u=t(93552);async function c(e){try{let r=await (0,p.JQ)();if(!r||"vendor"!==r.role&&"admin"!==r.role)return s.NextResponse.json({error:"Insufficient permissions"},{status:403});let t=await e.json(),n=l.zD.parse(t),a=(0,d.e)(),{data:o}=await a.from("vendor_profiles").select("vendor_id").eq("vendor_id",r.id).single();if(!o)return s.NextResponse.json({error:"Please complete your vendor profile before applying"},{status:400});let{data:i,error:c}=await a.from("markets").select("id, name, status, owner_id").eq("id",n.market_id).single();if(c||!i||"live"!==i.status)return s.NextResponse.json({error:"Market not found or not accepting applications"},{status:400});let{data:m}=await a.from("vendor_applications").select("id").eq("market_id",n.market_id).eq("vendor_id",r.id).single();if(m)return s.NextResponse.json({error:"You have already applied to this market"},{status:400});let{data:v,error:x}=await a.from("vendor_applications").insert({...n,vendor_id:r.id}).select(`
        *,
        market:markets!market_id (
          id,
          name,
          owner_id
        ),
        vendor:profiles!vendor_id (
          id,
          name,
          email
        ),
        vendor_profile:vendor_profiles!vendor_id (
          business_name,
          category
        )
      `).single();if(x)throw x;try{await u.inngest.send({name:"email/send",data:{template:"new-application",to_email:i.owner_id,data:{vendor_name:r.name||"Unknown Vendor",market_name:i.name,application_id:v.id,vendor_business_name:v.vendor_profile?.business_name,vendor_category:v.vendor_profile?.category,message:v.message}}})}catch(e){console.error("Error sending notification email:",e)}return s.NextResponse.json(v,{status:201})}catch(e){return console.error("Error creating vendor application:",e),s.NextResponse.json({error:"Failed to create application"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/vendor/apply/route",pathname:"/api/vendor/apply",filename:"route",bundlePath:"app/api/vendor/apply/route"},resolvedPagePath:"/Users/gwendolyn/Downloads/markethub/apps/web/app/api/vendor/apply/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:v,staticGenerationAsyncStorage:x,serverHooks:f}=m,g="/api/vendor/apply/route";function _(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}},90455:(e,r,t)=>{t.d(r,{JQ:()=>a,xv:()=>o});var n=t(19692);async function a(){let e=(0,n.e)(),{data:{user:r}}=await e.auth.getUser();if(!r)return null;let{data:t}=await e.from("profiles").select("*").eq("id",r.id).single();return t}async function o(e,r,t,a){let o=(0,n.e)(),{data:i,error:s}=await o.from("profiles").insert({id:e,email:r,name:t,role:a}).select().single();if(s)throw s;return i}},93552:(e,r,t)=>{t.r(r),t.d(r,{inngest:()=>n});let n=new(t(19641)).Inngest({id:"markethub",name:"MarketHub",signingKey:process.env.INNGEST_SIGNING_KEY||"build-time-dummy-key"})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[948,265,775,70,20,641,238],()=>t(38983));module.exports=n})();
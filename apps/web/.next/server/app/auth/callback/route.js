"use strict";(()=>{var e={};e.id=936,e.ids=[936],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},35034:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},93907:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var o={};t.r(o),t.d(o,{GET:()=>c});var a=t(63036),s=t(5736),l=t(15262),i=t(53244),n=t(60942),u=t(78503);async function c(e){let{searchParams:r,origin:t}=new URL(e.url),o=r.get("code"),a=r.get("next")??"/";if(console.log("\uD83D\uDD10 Auth callback hit:",{hasCode:!!o,next:a,origin:t,fullUrl:e.url,timestamp:new Date().toISOString()}),o){let e=(0,i.e)(),{data:r,error:s}=await e.auth.exchangeCodeForSession(o);if(console.log("Code exchange result:",{user:!!r?.user,error:s?.message}),!s&&r.user){let{data:o,error:s}=await e.from("profiles").select("id, role").eq("id",r.user.id).maybeSingle();if(console.log("\uD83D\uDD0D Profile check:",{exists:!!o,role:o?.role,profileId:o?.id,userId:r.user.id,error:s?.message,errorCode:s?.code}),!o){let o=r.user.user_metadata||{};console.log("\uD83D\uDC64 Creating profile with metadata:",{name:o.name,role:o.role,userId:r.user.id,userEmail:r.user.email,fullMetadata:o});try{await (0,u.xv)(r.user.id,r.user.email,o.name||r.user.email.split("@")[0],o.role||"vendor");let{data:t}=await e.from("profiles").select("role").eq("id",r.user.id).maybeSingle();console.log("âœ… Profile created with role:",{role:t?.role,profileId:t?.id||r.user.id,success:!!t})}catch(e){return console.error("Error creating profile:",e),n.NextResponse.redirect(`${t}/auth/auth-code-error`)}}let{data:l,error:i}=await e.from("profiles").select("role").eq("id",r.user.id).maybeSingle();if(console.log("\uD83C\uDFAF Final profile for redirect:",{role:l?.role,profileExists:!!l,error:i?.message,errorCode:i?.code,nextParam:a}),l){let e=a;return("/"===a||"/auth/login"===a)&&(e="market_organizer"===l.role||"admin"===l.role?"/organizer/dashboard":"/vendor/browse"),console.log("\uD83D\uDE80 Redirecting to:",{originalNext:a,calculatedPath:e,userRole:l.role,fullRedirectUrl:`${t}${e}`}),n.NextResponse.redirect(`${t}${e}`)}console.error("No profile found after creation attempt")}else console.error("Auth exchange failed:",s?.message)}else console.log("No code provided in callback");return console.log("Redirecting to error page"),n.NextResponse.redirect(`${t}/auth/auth-code-error`)}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/auth/callback/route",pathname:"/auth/callback",filename:"route",bundlePath:"app/auth/callback/route"},resolvedPagePath:"/Users/gwendolyn/Downloads/markethub/apps/web/app/auth/callback/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:m}=d,f="/auth/callback/route";function x(){return(0,l.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},78503:(e,r,t)=>{t.d(r,{JQ:()=>a,xv:()=>s});var o=t(53244);async function a(){let e=(0,o.e)(),{data:{user:r}}=await e.auth.getUser();if(!r)return null;let{data:t}=await e.from("profiles").select("*").eq("id",r.id).single();return t}async function s(e,r,t,a){let s=(0,o.e)(),{data:l,error:i}=await s.from("profiles").insert({id:e,email:r,name:t,role:a}).select().single();if(i)throw i;return l}},53244:(e,r,t)=>{t.d(r,{e:()=>s,m:()=>l});var o=t(76994),a=t(9362);function s(){let e=(0,a.cookies)();return(0,o.lx)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:r=>e.get(r)?.value,set(r,t,o){e.set({name:r,value:t,...o})},remove(r,t){e.set({name:r,value:"",...t})}}})}function l(){return(0,o.lx)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{cookies:{get(){},set(){},remove(){}}})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[522,515,193,942],()=>t(93907));module.exports=o})();